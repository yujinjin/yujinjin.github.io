{"version":3,"sources":["webpack:///./src/js/lib/summernote/summernote-zh-CN.js","webpack:///./src/js/lib/summernote/summernote.js"],"names":["$","extend","summernote","lang","font","bold","italic","underline","clear","height","name","strikethrough","subscript","superscript","size","image","insert","resizeFull","resizeHalf","resizeQuarter","floatLeft","floatRight","floatNone","shapeRounded","shapeCircle","shapeThumbnail","shapeNone","dragImageHere","selectFromFiles","maximumFileSize","maximumFileSizeError","url","remove","video","videoLink","providers","link","unlink","edit","textToDisplay","openInNewWindow","table","hr","style","normal","blockquote","pre","h1","h2","h3","h4","h5","h6","lists","unordered","ordered","options","help","fullscreen","codeview","paragraph","outdent","indent","left","center","right","justify","color","recent","more","background","foreground","transparent","setTransparent","reset","resetToDefault","shortcut","shortcuts","close","textFormatting","action","paragraphFormatting","documentStyle","extraKeys","history","undo","redo","jQuery","factory","define","browserVersion","func","eq","itemA","itemB","eq2","peq2","propName","ok","fail","not","f","apply","arguments","and","fA","fB","item","self","a","invoke","obj","method","idCounter","uniqueId","prefix","id","rect2bnd","rect","$document","document","top","scrollTop","scrollLeft","width","bottom","invertObject","inverted","key","hasOwnProperty","namespaceToCamel","namespace","split","map","substring","toUpperCase","join","list","head","array","last","length","initial","slice","tail","find","pred","idx","len","all","indexOf","inArray","contains","sum","fn","reduce","memo","v","from","collection","result","isEmpty","clusterBy","aTail","aLast","compact","aResult","push","unique","results","next","prev","isSupportAmd","isFontInstalled","fontName","testFontName","$tester","css","position","fontSize","text","appendTo","body","originalWidth","userAgent","navigator","isMSIE","test","matches","exec","parseFloat","isEdge","hasCodeMirror","window","CodeMirror","agent","isMac","appVersion","isFF","isPhantom","isWebkit","isChrome","isSafari","jqueryVersion","jquery","isW3CRangeSupport","createRange","NBSP_CHAR","String","fromCharCode","ZERO_WIDTH_NBSP_CHAR","dom","isEditable","node","hasClass","isControlSizing","makePredByNodeName","nodeName","isText","nodeType","isElement","isVoid","isPara","isHeading","isPre","isLi","isPurePara","isTable","isInline","isBodyContainer","isList","isHr","isBlockquote","isCell","isAnchor","isParaInline","ancestor","isBodyInline","isBody","isClosestSibling","nodeA","nodeB","nextSibling","previousSibling","withClosestSiblings","siblings","blankHTML","nodeLength","nodeValue","childNodes","innerHTML","paddingBlankHTML","parentNode","singleChildAncestor","listAncestor","ancestors","el","lastAncestor","filter","commonAncestor","n","listPrev","nodes","listNext","listDescendant","descendants","fnWalk","current","wrap","wrapperName","parent","wrapper","insertBefore","appendChild","insertAfter","preceding","appendChildNodes","aChild","each","child","isLeftEdgePoint","point","offset","isRightEdgePoint","isEdgePoint","isLeftEdgeOf","isRightEdgeOf","isLeftEdgePointOf","isRightEdgePointOf","hasChildren","prevPoint","isSkipInnerOffset","nextPoint","isSamePoint","pointA","pointB","isVisiblePoint","leftNode","rightNode","prevPointUntil","nextPointUntil","isCharPoint","ch","charAt","walkPoint","startPoint","endPoint","handler","isSkipOffset","makeOffsetPath","reverse","fromOffsetPath","offsets","i","splitNode","isSkipPaddingBlankHTML","isNotSplitEdgePoint","splitText","childNode","clone","cloneNode","splitTree","root","splitPoint","splitRoot","container","topAncestor","pivot","create","createElement","createText","createTextNode","isRemoveChild","removeNode","removeChild","removeWhile","replace","newNode","cssText","isTextarea","value","$node","stripLinebreaks","val","html","isNewlineOnBlock","markup","regexTag","match","endSlash","isEndOfInlineContainer","isBlockNode","trim","posFromPlaceholder","placeholder","$placeholder","pos","outerHeight","attachEvents","events","Object","keys","forEach","on","detachEvents","off","blank","emptyPara","isBlock","isDiv","isBR","isSpan","isB","isU","isS","isI","isImg","isEmptyAnchor","Context","$note","this","ui","memos","modules","layoutInfo","initialize","createLayout","_initialize","hide","destroy","_destroy","removeData","removeLayout","disabled","isDisabled","code","disable","buttons","plugins","module","initializeModule","removeModule","removeMemo","isActivated","undefined","codable","editable","triggerEvent","attr","enable","args","callback","callbacks","trigger","shouldInitialize","ModuleClass","withoutIntialize","createInvokeHandler","event","preventDefault","target","closest","data","splits","hasSeparator","moduleName","methodName","type","isExternalAPICalled","hasInitOptions","langInfo","note","context","first","focus","Renderer","children","render","$parent","contents","className","addClass","k","click","$container","append","renderer","isArray","TooltipUI","Tooltip","init","title","placement","$tooltip","eventName","show","toggle","nodeWidth","outerWidth","nodeHeight","tooltipWidth","tooltipHeight","removeClass","DropdownUI","Dropdown","$button","setEvent","$dropdown","windowWidth","bodyMarginRight","isOpened","e","ModalUI","Modal","$modal","$backdrop","editor","toolbar","editingArea","statusbar","airEditor","airEditable","buttonGroup","button","tooltip","dropdown","items","content","template","$temp","$a","itemClick","dropdownCheck","icon","checkClassName","dropdownButton","opt","dropdownCheckButton","paragraphDropdownButton","tableMoveHandler","col","row","posOffset","PX_PER_EM","$picker","$dimensionDisplay","$catcher","$highlighted","$unhighlighted","offsetX","posCatcher","x","pageX","y","pageY","offsetY","dim","c","Math","ceil","r","tableDropdownButton","mousedown","mousemove","palette","rowSize","colors","colSize","colorDropdownButton","currentClick","$recentColor","$holder","$color","$currentButton","dialog","fade","footer","videoDialog","imageDialog","imageLimitation","disableLinkTarget","linkDialog","linkImgDialog","popover","direction","hideArrow","iconClassName","tagName","toggleBtn","$btn","isEnable","toggleClass","toggleBtnActive","isActive","check","$dom","onDialogShown","$dialog","one","onDialogHidden","showDialog","hideDialog","getPopoverContent","$popover","getDialogBody","$editor","airMode","dropImage","specialChar","select","keyMap","isEdit","keyCode","BACKSPACE","TAB","ENTER","SPACE","isMove","LEFT","UP","RIGHT","DOWN","nameFromCode","range","textRangeToPoint","textRange","isStart","prevContainer","parentElement","tester","createTextRange","moveToElementText","compareEndPoints","textRangeStart","curTextNode","collapse","firstChild","pointTester","duplicate","setEndPoint","textCount","cont","pointToTextRange","textRangeInfo","isCollapseToStart","prevTextNodes","collapseToStart","info","moveStart","WrappedRange","sc","so","ec","eo","nativeRange","w3cRange","setStart","setEnd","getPoints","getStartPoint","getEndPoint","nativeRng","selection","getSelection","rangeCount","removeAllRanges","addRange","scrollIntoView","offsetTop","abs","normalize","getVisiblePoint","isLeftToRight","block","isCollapsed","includeAncestor","fullyContains","leftEdgeNodes","expand","startAncestor","endAncestor","boundaryPoints","isSameContainer","deleteContents","rng","emptyParents","makeIsOn","isOnEditable","isOnList","isOnAnchor","isOnCell","wrapBodyInlineWithPara","inlineSiblings","concat","para","insertNode","pasteHTML","contentsContainer","toString","getWordRange","findAfter","bookmark","s","path","paraBookmark","paras","getClientRects","wrappedRange","createFromSelection","createFromNode","anchorNode","getRangeAt","startContainer","startOffset","endContainer","endOffset","textRangeEnd","isTextNode","createFromNodeBefore","createFromNodeAfter","createFromBookmark","createFromParaBookmark","async","readFileAsDataURL","file","Deferred","deferred","FileReader","onload","dataURL","resolve","onerror","reject","readAsDataURL","promise","createImage","$img","detach","display","History","$editable","stack","stackOffset","makeSnapshot","emptyBookmark","applySnapshot","snapshot","rewind","recordUndo","Style","jQueryCSS","$obj","propertyNames","propertyName","call","fromNode","properties","styleInfo","parseInt","stylePara","styleNodes","expandClosestSibling","onlyPartialContains","nodesInRange","tails","elem","$cont","queryCommandState","orderedTypes","isUnordered","lineHeight","toFixed","anchor","Bullet","insertOrderedList","toggleList","insertUnorderedList","clustereds","wrapList","releaseList","listName","wrappedParas","diffLists","listNode","prevList","nextList","isEscapseToBody","releasedParas","headList","lastList","middleList","rootLists","rootList","listNodes","Typing","bullet","insertTab","tabsize","tab","Array","insertParagraph","nextPara","emptyAnchors","Table","isShift","cell","cells","nextCell","createTable","colCount","rowCount","tdHTML","tds","idxCol","trHTML","trs","idxRow","$table","tableClassName","KEY_BOGUS","Editor","lastRange","typing","isDefaultPrevented","handleKeyMap","changeEventName","maxHeight","minHeight","metaKey","ctrlKey","altKey","shiftKey","keyName","afterCommand","saveRange","thenCollapse","restoreRange","saveTarget","clearTarget","restoreTarget","currentStyle","styleFromNode","beforeCommand","isPreventTrigger","commands","sCmd","execCommand","tabSize","untab","wrapCommand","insertImage","src","param","linkInfo","then","$image","min","sNewWindow","insertImages","files","filename","maximumImageFileSize","insertImagesOrCallback","onImageUpload","insertText","textNode","getSelectedText","formatBlock","formatPara","spans","firstSpan","insertHorizontalRule","hrNode","removeBogus","bogusNode","bogusCharIdx","deleteData","createLink","linkUrl","linkText","isNewWindow","isTextChanged","onCreateLink","anchors","removeAttr","startRange","endRange","createLinkImg","linkImgInfo","is","getLinkInfo","$anchor","getLinkImgInfo","colorInfo","foreColor","backColor","insertTable","dimension","floatMe","$target","resize","resizeTo","bKeepRatio","imageSize","newRatio","ratio","removeMedia","hasFocus","empty","Clipboard","we","needKeydownHook","V","$paste","setTimeout","pasteByHook","opacity","before","pasteByEvent","dataURI","decodedData","atob","Uint8Array","charCodeAt","blob","Blob","pasteContent","clipboardData","originalEvent","kind","getAsFile","Dropzone","$dropzone","prependTo","disableDragAndDrop","attachDragAndDropEvent","$dropzoneMessage","isCodeview","hasEditorSize","add","dataTransfer","types","getData","toLowerCase","Codeview","$codable","textAreaChangFun","prettifyHtml","sync","save","deactivate","activate","cmEditor","fromTextArea","codemirror","tern","server","TernServer","ternServer","cm","updateArgHints","setSize","getValue","toTextArea","unbind","isChange","EDITABLE_PADDING","Statusbar","$statusbar","disableResizeEditor","stopPropagation","editableTop","clientY","minheight","max","Fullscreen","$toolbar","$window","$scrollbar","h","setsize","isFullscreen","Handle","$editingArea","update","$handle","disableResizeImage","posStart","clientX","isImage","$selection","w","sizingText","AutoLink","defaultScheme","linkPattern","handleKeyup","handleKeydown","lastWordRange","keyword","wordRange","AutoSync","Placeholder","isShow","Buttons","invertedKeyMap","representShortcut","editorMethod","addToolbarButtons","addImagePopoverButtons","addLinkPopoverButtons","fontInstalledMap","fontNamesIgnoreCheck","icons","magic","styleTags","tag","eraser","menuCheck","fontNames","fontSizes","createColorButton","currentTarget","unorderedlist","orderedlist","justifyLeft","alignLeft","justifyCenter","alignCenter","justifyRight","alignRight","justifyFull","alignJustify","textHeight","lineHeights","insertTableMaxSize","picture","minus","arrowsAlt","question","trash","build","groups","groupIdx","groupLen","group","groupName","$group","buttonObject","updateCurrentStyle","updateBtnStates","infos","selector","Toolbar","changeContainer","toolbarContainer","updateFullscreen","updateCodeview","isIncludeCodeview","LinkDialog","dialogsInBody","dialogsFade","bindEnterKey","$input","showLinkDialog","$linkText","$linkUrl","$linkBtn","$openInNewWindow","prop","state","LinkPopover","$content","prepend","href","LinkImgDialog","showLinkImgDialog","ImageDialog","unit","floor","log","readableSize","pow","showImageDialog","$imageInput","$imageLinkUrl","$imageUrl","$imageBtn","replaceWith","ImagePopover","VideoDialog","createVideoNode","$video","ytRegExp","ytMatch","igRegExp","igMatch","vRegExp","vMatch","vimRegExp","vimMatch","dmRegExp","dmMatch","youkuRegExp","youkuMatch","mp4RegExp","mp4Match","oggRegExp","oggMatch","webmRegExp","webmMatch","youtubeId","showVideoDialog","$videoUrl","$videoBtn","HelpDialog","createShortCutList","command","$row","showHelpDialog","AirPopover","AIR_MODE_POPOVER_X_OFFSET","relatedTarget","air","bnd","HintPopover","POPOVER_DIST","hint","hintDirection","hints","selectItem","$item","innerHeight","moveDown","$current","$next","$nextGroup","moveUp","$prev","$prevGroup","nodeFromItem","createItemTemplates","hintIdx","searchKeyword","index","search","createGroup","version","styleWithSpan","textareaAutoSync","onInit","onFocus","onBlur","onEnter","onKeyup","onKeydown","onSubmit","onImageUploadError","mode","htmlMode","lineNumbers","pc","mac"],"mappings":"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","file":"build/js/chunk-217f2f09.aa85f772.js","sourcesContent":["(function ($) {\n  $.extend($.summernote.lang, {\n    'zh-CN': {\n      font: {\n        bold: '粗体',\n        italic: '斜体',\n        underline: '下划线',\n        clear: '清除格式',\n        height: '行高',\n        name: '字体',\n        strikethrough: '删除线',\n        subscript: '下标',\n        superscript: '上标',\n        size: '字号'\n      },\n      image: {\n        image: '图片',\n        insert: '插入图片',\n        resizeFull: '缩放至 100%',\n        resizeHalf: '缩放至 50%',\n        resizeQuarter: '缩放至 25%',\n        floatLeft: '靠左浮动',\n        floatRight: '靠右浮动',\n        floatNone: '取消浮动',\n        shapeRounded: '形状: 圆角',\n        shapeCircle: '形状: 圆',\n        shapeThumbnail: '形状: 缩略图',\n        shapeNone: '形状: 无',\n        dragImageHere: '将图片拖拽至此处',\n        selectFromFiles: '从本地上传',\n        maximumFileSize: '文件大小最大值',\n        maximumFileSizeError: '文件大小超出最大值。',\n        url: '图片地址',\n        remove: '移除图片'\n      },\n      video: {\n        video: '视频',\n        videoLink: '视频链接',\n        insert: '插入视频',\n        url: '视频地址',\n        providers: '(优酷, Instagram, DailyMotion, Youtube等)'\n      },\n      link: {\n        link: '链接',\n        insert: '插入链接',\n        unlink: '去除链接',\n        edit: '编辑链接',\n        textToDisplay: '显示文本',\n        url: '链接地址',\n        openInNewWindow: '在新窗口打开'\n      },\n      table: {\n        table: '表格'\n      },\n      hr: {\n        insert: '水平线'\n      },\n      style: {\n        style: '样式',\n        normal: '普通',\n        blockquote: '引用',\n        pre: '代码',\n        h1: '标题 1',\n        h2: '标题 2',\n        h3: '标题 3',\n        h4: '标题 4',\n        h5: '标题 5',\n        h6: '标题 6'\n      },\n      lists: {\n        unordered: '无序列表',\n        ordered: '有序列表'\n      },\n      options: {\n        help: '帮助',\n        fullscreen: '全屏',\n        codeview: '源代码'\n      },\n      paragraph: {\n        paragraph: '段落',\n        outdent: '减少缩进',\n        indent: '增加缩进',\n        left: '左对齐',\n        center: '居中对齐',\n        right: '右对齐',\n        justify: '两端对齐'\n      },\n      color: {\n        recent: '最近使用',\n        more: '更多',\n        background: '背景',\n        foreground: '前景',\n        transparent: '透明',\n        setTransparent: '透明',\n        reset: '重置',\n        resetToDefault: '默认'\n      },\n      shortcut: {\n        shortcuts: '快捷键',\n        close: '关闭',\n        textFormatting: '文本格式',\n        action: '动作',\n        paragraphFormatting: '段落格式',\n        documentStyle: '文档样式',\n        extraKeys: '额外按键'\n      },\n      history: {\n        undo: '撤销',\n        redo: '重做'\n      }\n    }\n  });\n})(jQuery);\n","/**\n * Super simple wysiwyg editor v0.8.1\n * http://summernote.org/\n *\n * summernote.js\n * Copyright 2013-2016 Alan Hong. and other contributors\n * summernote may be freely distributed under the MIT license./\n *\n * Date: 2017-07-01T07:48Z\n */\n(function(factory) {\n\t/* global define */\n\tif(typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine(['jquery'], factory);\n\t} else if(typeof module === 'object' && module.exports) {\n\t\t// Node/CommonJS\n\t\tmodule.exports = factory(require('jquery'));\n\t} else {\n\t\t// Browser globals\n\t\tfactory(window.jQuery);\n\t}\n}(function($) {\n\t'use strict';\n\n\t/**\n\t * @class core.func\n\t *\n\t * func utils (for high-order func's arg)\n\t *\n\t * @singleton\n\t * @alternateClassName func\n\t */\n\tvar func = (function() {\n\t\tvar eq = function(itemA) {\n\t\t\treturn function(itemB) {\n\t\t\t\treturn itemA === itemB;\n\t\t\t};\n\t\t};\n\n\t\tvar eq2 = function(itemA, itemB) {\n\t\t\treturn itemA === itemB;\n\t\t};\n\n\t\tvar peq2 = function(propName) {\n\t\t\treturn function(itemA, itemB) {\n\t\t\t\treturn itemA[propName] === itemB[propName];\n\t\t\t};\n\t\t};\n\n\t\tvar ok = function() {\n\t\t\treturn true;\n\t\t};\n\n\t\tvar fail = function() {\n\t\t\treturn false;\n\t\t};\n\n\t\tvar not = function(f) {\n\t\t\treturn function() {\n\t\t\t\treturn !f.apply(f, arguments);\n\t\t\t};\n\t\t};\n\n\t\tvar and = function(fA, fB) {\n\t\t\treturn function(item) {\n\t\t\t\treturn fA(item) && fB(item);\n\t\t\t};\n\t\t};\n\n\t\tvar self = function(a) {\n\t\t\treturn a;\n\t\t};\n\n\t\tvar invoke = function(obj, method) {\n\t\t\treturn function() {\n\t\t\t\treturn obj[method].apply(obj, arguments);\n\t\t\t};\n\t\t};\n\n\t\tvar idCounter = 0;\n\n\t\t/**\n\t\t * generate a globally-unique id\n\t\t *\n\t\t * @param {String} [prefix]\n\t\t */\n\t\tvar uniqueId = function(prefix) {\n\t\t\tvar id = ++idCounter + '';\n\t\t\treturn prefix ? prefix + id : id;\n\t\t};\n\n\t\t/**\n\t\t * returns bnd (bounds) from rect\n\t\t *\n\t\t * - IE Compatibility Issue: http://goo.gl/sRLOAo\n\t\t * - Scroll Issue: http://goo.gl/sNjUc\n\t\t *\n\t\t * @param {Rect} rect\n\t\t * @return {Object} bounds\n\t\t * @return {Number} bounds.top\n\t\t * @return {Number} bounds.left\n\t\t * @return {Number} bounds.width\n\t\t * @return {Number} bounds.height\n\t\t */\n\t\tvar rect2bnd = function(rect) {\n\t\t\tvar $document = $(document);\n\t\t\treturn {\n\t\t\t\ttop: rect.top + $document.scrollTop(),\n\t\t\t\tleft: rect.left + $document.scrollLeft(),\n\t\t\t\twidth: rect.right - rect.left,\n\t\t\t\theight: rect.bottom - rect.top\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * returns a copy of the object where the keys have become the values and the values the keys.\n\t\t * @param {Object} obj\n\t\t * @return {Object}\n\t\t */\n\t\tvar invertObject = function(obj) {\n\t\t\tvar inverted = {};\n\t\t\tfor(var key in obj) {\n\t\t\t\tif(obj.hasOwnProperty(key)) {\n\t\t\t\t\tinverted[obj[key]] = key;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn inverted;\n\t\t};\n\n\t\t/**\n\t\t * @param {String} namespace\n\t\t * @param {String} [prefix]\n\t\t * @return {String}\n\t\t */\n\t\tvar namespaceToCamel = function(namespace, prefix) {\n\t\t\tprefix = prefix || '';\n\t\t\treturn prefix + namespace.split('.').map(function(name) {\n\t\t\t\treturn name.substring(0, 1).toUpperCase() + name.substring(1);\n\t\t\t}).join('');\n\t\t};\n\n\t\treturn {\n\t\t\teq: eq,\n\t\t\teq2: eq2,\n\t\t\tpeq2: peq2,\n\t\t\tok: ok,\n\t\t\tfail: fail,\n\t\t\tself: self,\n\t\t\tnot: not,\n\t\t\tand: and,\n\t\t\tinvoke: invoke,\n\t\t\tuniqueId: uniqueId,\n\t\t\trect2bnd: rect2bnd,\n\t\t\tinvertObject: invertObject,\n\t\t\tnamespaceToCamel: namespaceToCamel\n\t\t};\n\t})();\n\n\t/**\n\t * @class core.list\n\t *\n\t * list utils\n\t *\n\t * @singleton\n\t * @alternateClassName list\n\t */\n\tvar list = (function() {\n\t\t/**\n\t\t * returns the first item of an array.\n\t\t *\n\t\t * @param {Array} array\n\t\t */\n\t\tvar head = function(array) {\n\t\t\treturn array[0];\n\t\t};\n\n\t\t/**\n\t\t * returns the last item of an array.\n\t\t *\n\t\t * @param {Array} array\n\t\t */\n\t\tvar last = function(array) {\n\t\t\treturn array[array.length - 1];\n\t\t};\n\n\t\t/**\n\t\t * returns everything but the last entry of the array.\n\t\t *\n\t\t * @param {Array} array\n\t\t */\n\t\tvar initial = function(array) {\n\t\t\treturn array.slice(0, array.length - 1);\n\t\t};\n\n\t\t/**\n\t\t * returns the rest of the items in an array.\n\t\t *\n\t\t * @param {Array} array\n\t\t */\n\t\tvar tail = function(array) {\n\t\t\treturn array.slice(1);\n\t\t};\n\n\t\t/**\n\t\t * returns item of array\n\t\t */\n\t\tvar find = function(array, pred) {\n\t\t\tfor(var idx = 0, len = array.length; idx < len; idx++) {\n\t\t\t\tvar item = array[idx];\n\t\t\t\tif(pred(item)) {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * returns true if all of the values in the array pass the predicate truth test.\n\t\t */\n\t\tvar all = function(array, pred) {\n\t\t\tfor(var idx = 0, len = array.length; idx < len; idx++) {\n\t\t\t\tif(!pred(array[idx])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * returns index of item\n\t\t */\n\t\tvar indexOf = function(array, item) {\n\t\t\treturn $.inArray(item, array);\n\t\t};\n\n\t\t/**\n\t\t * returns true if the value is present in the list.\n\t\t */\n\t\tvar contains = function(array, item) {\n\t\t\treturn indexOf(array, item) !== -1;\n\t\t};\n\n\t\t/**\n\t\t * get sum from a list\n\t\t *\n\t\t * @param {Array} array - array\n\t\t * @param {Function} fn - iterator\n\t\t */\n\t\tvar sum = function(array, fn) {\n\t\t\tfn = fn || func.self;\n\t\t\treturn array.reduce(function(memo, v) {\n\t\t\t\treturn memo + fn(v);\n\t\t\t}, 0);\n\t\t};\n\n\t\t/**\n\t\t * returns a copy of the collection with array type.\n\t\t * @param {Collection} collection - collection eg) node.childNodes, ...\n\t\t */\n\t\tvar from = function(collection) {\n\t\t\tvar result = [],\n\t\t\t\tidx = -1,\n\t\t\t\tlength = collection.length;\n\t\t\twhile(++idx < length) {\n\t\t\t\tresult[idx] = collection[idx];\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * returns whether list is empty or not\n\t\t */\n\t\tvar isEmpty = function(array) {\n\t\t\treturn !array || !array.length;\n\t\t};\n\n\t\t/**\n\t\t * cluster elements by predicate function.\n\t\t *\n\t\t * @param {Array} array - array\n\t\t * @param {Function} fn - predicate function for cluster rule\n\t\t * @param {Array[]}\n\t\t */\n\t\tvar clusterBy = function(array, fn) {\n\t\t\tif(!array.length) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tvar aTail = tail(array);\n\t\t\treturn aTail.reduce(function(memo, v) {\n\t\t\t\tvar aLast = last(memo);\n\t\t\t\tif(fn(last(aLast), v)) {\n\t\t\t\t\taLast[aLast.length] = v;\n\t\t\t\t} else {\n\t\t\t\t\tmemo[memo.length] = [v];\n\t\t\t\t}\n\t\t\t\treturn memo;\n\t\t\t}, [\n\t\t\t\t[head(array)]\n\t\t\t]);\n\t\t};\n\n\t\t/**\n\t\t * returns a copy of the array with all falsy values removed\n\t\t *\n\t\t * @param {Array} array - array\n\t\t * @param {Function} fn - predicate function for cluster rule\n\t\t */\n\t\tvar compact = function(array) {\n\t\t\tvar aResult = [];\n\t\t\tfor(var idx = 0, len = array.length; idx < len; idx++) {\n\t\t\t\tif(array[idx]) {\n\t\t\t\t\taResult.push(array[idx]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn aResult;\n\t\t};\n\n\t\t/**\n\t\t * produces a duplicate-free version of the array\n\t\t *\n\t\t * @param {Array} array\n\t\t */\n\t\tvar unique = function(array) {\n\t\t\tvar results = [];\n\n\t\t\tfor(var idx = 0, len = array.length; idx < len; idx++) {\n\t\t\t\tif(!contains(results, array[idx])) {\n\t\t\t\t\tresults.push(array[idx]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn results;\n\t\t};\n\n\t\t/**\n\t\t * returns next item.\n\t\t * @param {Array} array\n\t\t */\n\t\tvar next = function(array, item) {\n\t\t\tvar idx = indexOf(array, item);\n\t\t\tif(idx === -1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn array[idx + 1];\n\t\t};\n\n\t\t/**\n\t\t * returns prev item.\n\t\t * @param {Array} array\n\t\t */\n\t\tvar prev = function(array, item) {\n\t\t\tvar idx = indexOf(array, item);\n\t\t\tif(idx === -1) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn array[idx - 1];\n\t\t};\n\n\t\treturn {\n\t\t\thead: head,\n\t\t\tlast: last,\n\t\t\tinitial: initial,\n\t\t\ttail: tail,\n\t\t\tprev: prev,\n\t\t\tnext: next,\n\t\t\tfind: find,\n\t\t\tcontains: contains,\n\t\t\tall: all,\n\t\t\tsum: sum,\n\t\t\tfrom: from,\n\t\t\tisEmpty: isEmpty,\n\t\t\tclusterBy: clusterBy,\n\t\t\tcompact: compact,\n\t\t\tunique: unique\n\t\t};\n\t})();\n\n\tvar isSupportAmd = typeof define === 'function' && define.amd;\n\n\t/**\n\t * returns whether font is installed or not.\n\t *\n\t * @param {String} fontName\n\t * @return {Boolean}\n\t */\n\tvar isFontInstalled = function(fontName) {\n\t\tvar testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';\n\t\tvar $tester = $('<div>').css({\n\t\t\tposition: 'absolute',\n\t\t\tleft: '-9999px',\n\t\t\ttop: '-9999px',\n\t\t\tfontSize: '200px'\n\t\t}).text('mmmmmmmmmwwwwwww').appendTo(document.body);\n\n\t\tvar originalWidth = $tester.css('fontFamily', testFontName).width();\n\t\tvar width = $tester.css('fontFamily', fontName + ',' + testFontName).width();\n\n\t\t$tester.remove();\n\n\t\treturn originalWidth !== width;\n\t};\n\n\tvar userAgent = navigator.userAgent;\n\tvar isMSIE = /MSIE|Trident/i.test(userAgent);\n\tvar browserVersion;\n\tif(isMSIE) {\n\t\tvar matches = /MSIE (\\d+[.]\\d+)/.exec(userAgent);\n\t\tif(matches) {\n\t\t\tbrowserVersion = parseFloat(matches[1]);\n\t\t}\n\t\tmatches = /Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(userAgent);\n\t\tif(matches) {\n\t\t\tbrowserVersion = parseFloat(matches[1]);\n\t\t}\n\t}\n\n\tvar isEdge = /Edge\\/\\d+/.test(userAgent);\n\n\tvar hasCodeMirror = !!window.CodeMirror;\n\n\t/**\n\t * @class core.agent\n\t *\n\t * Object which check platform and agent\n\t *\n\t * @singleton\n\t * @alternateClassName agent\n\t */\n\tvar agent = {\n\t\tisMac: navigator.appVersion.indexOf('Mac') > -1,\n\t\tisMSIE: isMSIE,\n\t\tisEdge: isEdge,\n\t\tisFF: !isEdge && /firefox/i.test(userAgent),\n\t\tisPhantom: /PhantomJS/i.test(userAgent),\n\t\tisWebkit: !isEdge && /webkit/i.test(userAgent),\n\t\tisChrome: !isEdge && /chrome/i.test(userAgent),\n\t\tisSafari: !isEdge && /safari/i.test(userAgent),\n\t\tbrowserVersion: browserVersion,\n\t\tjqueryVersion: parseFloat($.fn.jquery),\n\t\tisSupportAmd: isSupportAmd,\n\t\thasCodeMirror: hasCodeMirror,\n\t\tisFontInstalled: isFontInstalled,\n\t\tisW3CRangeSupport: !!document.createRange\n\t};\n\n\tvar NBSP_CHAR = String.fromCharCode(160);\n\tvar ZERO_WIDTH_NBSP_CHAR = '\\ufeff';\n\n\t/**\n\t * @class core.dom\n\t *\n\t * Dom functions\n\t *\n\t * @singleton\n\t * @alternateClassName dom\n\t */\n\tvar dom = (function() {\n\t\t/**\n\t\t * @method isEditable\n\t\t *\n\t\t * returns whether node is `note-editable` or not.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isEditable = function(node) {\n\t\t\treturn node && $(node).hasClass('note-editable');\n\t\t};\n\n\t\t/**\n\t\t * @method isControlSizing\n\t\t *\n\t\t * returns whether node is `note-control-sizing` or not.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isControlSizing = function(node) {\n\t\t\treturn node && $(node).hasClass('note-control-sizing');\n\t\t};\n\n\t\t/**\n\t\t * @method makePredByNodeName\n\t\t *\n\t\t * returns predicate which judge whether nodeName is same\n\t\t *\n\t\t * @param {String} nodeName\n\t\t * @return {Function}\n\t\t */\n\t\tvar makePredByNodeName = function(nodeName) {\n\t\t\tnodeName = nodeName.toUpperCase();\n\t\t\treturn function(node) {\n\t\t\t\treturn node && node.nodeName.toUpperCase() === nodeName;\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * @method isText\n\t\t *\n\t\t *\n\t\t *\n\t\t * @param {Node} node\n\t\t * @return {Boolean} true if node's type is text(3)\n\t\t */\n\t\tvar isText = function(node) {\n\t\t\treturn node && node.nodeType === 3;\n\t\t};\n\n\t\t/**\n\t\t * @method isElement\n\t\t *\n\t\t *\n\t\t *\n\t\t * @param {Node} node\n\t\t * @return {Boolean} true if node's type is element(1)\n\t\t */\n\t\tvar isElement = function(node) {\n\t\t\treturn node && node.nodeType === 1;\n\t\t};\n\n\t\t/**\n\t\t * ex) br, col, embed, hr, img, input, ...\n\t\t * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\n\t\t */\n\t\tvar isVoid = function(node) {\n\t\t\treturn node && /^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase());\n\t\t};\n\n\t\tvar isPara = function(node) {\n\t\t\tif(isEditable(node)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\n\t\t\treturn node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());\n\t\t};\n\n\t\tvar isHeading = function(node) {\n\t\t\treturn node && /^H[1-7]/.test(node.nodeName.toUpperCase());\n\t\t};\n\n\t\tvar isPre = makePredByNodeName('PRE');\n\n\t\tvar isLi = makePredByNodeName('LI');\n\n\t\tvar isPurePara = function(node) {\n\t\t\treturn isPara(node) && !isLi(node);\n\t\t};\n\n\t\tvar isTable = makePredByNodeName('TABLE');\n\n\t\tvar isInline = function(node) {\n\t\t\treturn !isBodyContainer(node) &&\n\t\t\t\t!isList(node) &&\n\t\t\t\t!isHr(node) &&\n\t\t\t\t!isPara(node) &&\n\t\t\t\t!isTable(node) &&\n\t\t\t\t!isBlockquote(node);\n\t\t};\n\n\t\tvar isList = function(node) {\n\t\t\treturn node && /^UL|^OL/.test(node.nodeName.toUpperCase());\n\t\t};\n\n\t\tvar isHr = makePredByNodeName('HR');\n\n\t\tvar isCell = function(node) {\n\t\t\treturn node && /^TD|^TH/.test(node.nodeName.toUpperCase());\n\t\t};\n\n\t\tvar isBlockquote = makePredByNodeName('BLOCKQUOTE');\n\n\t\tvar isBodyContainer = function(node) {\n\t\t\treturn isCell(node) || isBlockquote(node) || isEditable(node);\n\t\t};\n\n\t\tvar isAnchor = makePredByNodeName('A');\n\n\t\tvar isParaInline = function(node) {\n\t\t\treturn isInline(node) && !!ancestor(node, isPara);\n\t\t};\n\n\t\tvar isBodyInline = function(node) {\n\t\t\treturn isInline(node) && !ancestor(node, isPara);\n\t\t};\n\n\t\tvar isBody = makePredByNodeName('BODY');\n\n\t\t/**\n\t\t * returns whether nodeB is closest sibling of nodeA\n\t\t *\n\t\t * @param {Node} nodeA\n\t\t * @param {Node} nodeB\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isClosestSibling = function(nodeA, nodeB) {\n\t\t\treturn nodeA.nextSibling === nodeB ||\n\t\t\t\tnodeA.previousSibling === nodeB;\n\t\t};\n\n\t\t/**\n\t\t * returns array of closest siblings with node\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {function} [pred] - predicate function\n\t\t * @return {Node[]}\n\t\t */\n\t\tvar withClosestSiblings = function(node, pred) {\n\t\t\tpred = pred || func.ok;\n\n\t\t\tvar siblings = [];\n\t\t\tif(node.previousSibling && pred(node.previousSibling)) {\n\t\t\t\tsiblings.push(node.previousSibling);\n\t\t\t}\n\t\t\tsiblings.push(node);\n\t\t\tif(node.nextSibling && pred(node.nextSibling)) {\n\t\t\t\tsiblings.push(node.nextSibling);\n\t\t\t}\n\t\t\treturn siblings;\n\t\t};\n\n\t\t/**\n\t\t * blank HTML for cursor position\n\t\t * - [workaround] old IE only works with &nbsp;\n\t\t * - [workaround] IE11 and other browser works with bogus br\n\t\t */\n\t\tvar blankHTML = agent.isMSIE && agent.browserVersion < 11 ? '&nbsp;' : '<br>';\n\n\t\t/**\n\t\t * @method nodeLength\n\t\t *\n\t\t * returns #text's text size or element's childNodes size\n\t\t *\n\t\t * @param {Node} node\n\t\t */\n\t\tvar nodeLength = function(node) {\n\t\t\tif(isText(node)) {\n\t\t\t\treturn node.nodeValue.length;\n\t\t\t}\n\n\t\t\treturn node.childNodes.length;\n\t\t};\n\n\t\t/**\n\t\t * returns whether node is empty or not.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isEmpty = function(node) {\n\t\t\tvar len = nodeLength(node);\n\n\t\t\tif(len === 0) {\n\t\t\t\treturn true;\n\t\t\t} else if(!isText(node) && len === 1 && node.innerHTML === blankHTML) {\n\t\t\t\t// ex) <p><br></p>, <span><br></span>\n\t\t\t\treturn true;\n\t\t\t} else if(list.all(node.childNodes, isText) && node.innerHTML === '') {\n\t\t\t\t// ex) <p></p>, <span></span>\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * padding blankHTML if node is empty (for cursor position)\n\t\t */\n\t\tvar paddingBlankHTML = function(node) {\n\t\t\tif(!isVoid(node) && !nodeLength(node)) {\n\t\t\t\tnode.innerHTML = blankHTML;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * find nearest ancestor predicate hit\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} pred - predicate function\n\t\t */\n\t\tvar ancestor = function(node, pred) {\n\t\t\twhile(node) {\n\t\t\t\tif(pred(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\tif(isEditable(node)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\n\t\t/**\n\t\t * find nearest ancestor only single child blood line and predicate hit\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} pred - predicate function\n\t\t */\n\t\tvar singleChildAncestor = function(node, pred) {\n\t\t\tnode = node.parentNode;\n\n\t\t\twhile(node) {\n\t\t\t\tif(nodeLength(node) !== 1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(pred(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\tif(isEditable(node)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\n\t\t/**\n\t\t * returns new array of ancestor nodes (until predicate hit).\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} [optional] pred - predicate function\n\t\t */\n\t\tvar listAncestor = function(node, pred) {\n\t\t\tpred = pred || func.fail;\n\n\t\t\tvar ancestors = [];\n\t\t\tancestor(node, function(el) {\n\t\t\t\tif(!isEditable(el)) {\n\t\t\t\t\tancestors.push(el);\n\t\t\t\t}\n\n\t\t\t\treturn pred(el);\n\t\t\t});\n\t\t\treturn ancestors;\n\t\t};\n\n\t\t/**\n\t\t * find farthest ancestor predicate hit\n\t\t */\n\t\tvar lastAncestor = function(node, pred) {\n\t\t\tvar ancestors = listAncestor(node);\n\t\t\treturn list.last(ancestors.filter(pred));\n\t\t};\n\n\t\t/**\n\t\t * returns common ancestor node between two nodes.\n\t\t *\n\t\t * @param {Node} nodeA\n\t\t * @param {Node} nodeB\n\t\t */\n\t\tvar commonAncestor = function(nodeA, nodeB) {\n\t\t\tvar ancestors = listAncestor(nodeA);\n\t\t\tfor(var n = nodeB; n; n = n.parentNode) {\n\t\t\t\tif($.inArray(n, ancestors) > -1) {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null; // difference document area\n\t\t};\n\n\t\t/**\n\t\t * listing all previous siblings (until predicate hit).\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} [optional] pred - predicate function\n\t\t */\n\t\tvar listPrev = function(node, pred) {\n\t\t\tpred = pred || func.fail;\n\n\t\t\tvar nodes = [];\n\t\t\twhile(node) {\n\t\t\t\tif(pred(node)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tnodes.push(node);\n\t\t\t\tnode = node.previousSibling;\n\t\t\t}\n\t\t\treturn nodes;\n\t\t};\n\n\t\t/**\n\t\t * listing next siblings (until predicate hit).\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} [pred] - predicate function\n\t\t */\n\t\tvar listNext = function(node, pred) {\n\t\t\tpred = pred || func.fail;\n\n\t\t\tvar nodes = [];\n\t\t\twhile(node) {\n\t\t\t\tif(pred(node)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tnodes.push(node);\n\t\t\t\tnode = node.nextSibling;\n\t\t\t}\n\t\t\treturn nodes;\n\t\t};\n\n\t\t/**\n\t\t * listing descendant nodes\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} [pred] - predicate function\n\t\t */\n\t\tvar listDescendant = function(node, pred) {\n\t\t\tvar descendants = [];\n\t\t\tpred = pred || func.ok;\n\n\t\t\t// start DFS(depth first search) with node\n\t\t\t(function fnWalk(current) {\n\t\t\t\tif(node !== current && pred(current)) {\n\t\t\t\t\tdescendants.push(current);\n\t\t\t\t}\n\t\t\t\tfor(var idx = 0, len = current.childNodes.length; idx < len; idx++) {\n\t\t\t\t\tfnWalk(current.childNodes[idx]);\n\t\t\t\t}\n\t\t\t})(node);\n\n\t\t\treturn descendants;\n\t\t};\n\n\t\t/**\n\t\t * wrap node with new tag.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} tagName of wrapper\n\t\t * @return {Node} - wrapper\n\t\t */\n\t\tvar wrap = function(node, wrapperName) {\n\t\t\tvar parent = node.parentNode;\n\t\t\tvar wrapper = $('<' + wrapperName + '>')[0];\n\n\t\t\tparent.insertBefore(wrapper, node);\n\t\t\twrapper.appendChild(node);\n\n\t\t\treturn wrapper;\n\t\t};\n\n\t\t/**\n\t\t * insert node after preceding\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} preceding - predicate function\n\t\t */\n\t\tvar insertAfter = function(node, preceding) {\n\t\t\tvar next = preceding.nextSibling,\n\t\t\t\tparent = preceding.parentNode;\n\t\t\tif(next) {\n\t\t\t\tparent.insertBefore(node, next);\n\t\t\t} else {\n\t\t\t\tparent.appendChild(node);\n\t\t\t}\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * append elements.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Collection} aChild\n\t\t */\n\t\tvar appendChildNodes = function(node, aChild) {\n\t\t\t$.each(aChild, function(idx, child) {\n\t\t\t\tnode.appendChild(child);\n\t\t\t});\n\t\t\treturn node;\n\t\t};\n\n\t\t/**\n\t\t * returns whether boundaryPoint is left edge or not.\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isLeftEdgePoint = function(point) {\n\t\t\treturn point.offset === 0;\n\t\t};\n\n\t\t/**\n\t\t * returns whether boundaryPoint is right edge or not.\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isRightEdgePoint = function(point) {\n\t\t\treturn point.offset === nodeLength(point.node);\n\t\t};\n\n\t\t/**\n\t\t * returns whether boundaryPoint is edge or not.\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isEdgePoint = function(point) {\n\t\t\treturn isLeftEdgePoint(point) || isRightEdgePoint(point);\n\t\t};\n\n\t\t/**\n\t\t * returns whether node is left edge of ancestor or not.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} ancestor\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isLeftEdgeOf = function(node, ancestor) {\n\t\t\twhile(node && node !== ancestor) {\n\t\t\t\tif(position(node) !== 0) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * returns whether node is right edge of ancestor or not.\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Node} ancestor\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isRightEdgeOf = function(node, ancestor) {\n\t\t\twhile(node && node !== ancestor) {\n\t\t\t\tif(position(node) !== nodeLength(node.parentNode) - 1) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * returns whether point is left edge of ancestor or not.\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Node} ancestor\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isLeftEdgePointOf = function(point, ancestor) {\n\t\t\treturn isLeftEdgePoint(point) && isLeftEdgeOf(point.node, ancestor);\n\t\t};\n\n\t\t/**\n\t\t * returns whether point is right edge of ancestor or not.\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Node} ancestor\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isRightEdgePointOf = function(point, ancestor) {\n\t\t\treturn isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);\n\t\t};\n\n\t\t/**\n\t\t * returns offset from parent.\n\t\t *\n\t\t * @param {Node} node\n\t\t */\n\t\tvar position = function(node) {\n\t\t\tvar offset = 0;\n\t\t\twhile((node = node.previousSibling)) {\n\t\t\t\toffset += 1;\n\t\t\t}\n\t\t\treturn offset;\n\t\t};\n\n\t\tvar hasChildren = function(node) {\n\t\t\treturn !!(node && node.childNodes && node.childNodes.length);\n\t\t};\n\n\t\t/**\n\t\t * returns previous boundaryPoint\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Boolean} isSkipInnerOffset\n\t\t * @return {BoundaryPoint}\n\t\t */\n\t\tvar prevPoint = function(point, isSkipInnerOffset) {\n\t\t\tvar node, offset;\n\n\t\t\tif(point.offset === 0) {\n\t\t\t\tif(isEditable(point.node)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tnode = point.node.parentNode;\n\t\t\t\toffset = position(point.node);\n\t\t\t} else if(hasChildren(point.node)) {\n\t\t\t\tnode = point.node.childNodes[point.offset - 1];\n\t\t\t\toffset = nodeLength(node);\n\t\t\t} else {\n\t\t\t\tnode = point.node;\n\t\t\t\toffset = isSkipInnerOffset ? 0 : point.offset - 1;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tnode: node,\n\t\t\t\toffset: offset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * returns next boundaryPoint\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Boolean} isSkipInnerOffset\n\t\t * @return {BoundaryPoint}\n\t\t */\n\t\tvar nextPoint = function(point, isSkipInnerOffset) {\n\t\t\tvar node, offset;\n\n\t\t\tif(nodeLength(point.node) === point.offset) {\n\t\t\t\tif(isEditable(point.node)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tnode = point.node.parentNode;\n\t\t\t\toffset = position(point.node) + 1;\n\t\t\t} else if(hasChildren(point.node)) {\n\t\t\t\tnode = point.node.childNodes[point.offset];\n\t\t\t\toffset = 0;\n\t\t\t} else {\n\t\t\t\tnode = point.node;\n\t\t\t\toffset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tnode: node,\n\t\t\t\toffset: offset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * returns whether pointA and pointB is same or not.\n\t\t *\n\t\t * @param {BoundaryPoint} pointA\n\t\t * @param {BoundaryPoint} pointB\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isSamePoint = function(pointA, pointB) {\n\t\t\treturn pointA.node === pointB.node && pointA.offset === pointB.offset;\n\t\t};\n\n\t\t/**\n\t\t * returns whether point is visible (can set cursor) or not.\n\t\t * \n\t\t * @param {BoundaryPoint} point\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isVisiblePoint = function(point) {\n\t\t\tif(isText(point.node) || !hasChildren(point.node) || isEmpty(point.node)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar leftNode = point.node.childNodes[point.offset - 1];\n\t\t\tvar rightNode = point.node.childNodes[point.offset];\n\t\t\tif((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\t/**\n\t\t * @method prevPointUtil\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Function} pred\n\t\t * @return {BoundaryPoint}\n\t\t */\n\t\tvar prevPointUntil = function(point, pred) {\n\t\t\twhile(point) {\n\t\t\t\tif(pred(point)) {\n\t\t\t\t\treturn point;\n\t\t\t\t}\n\n\t\t\t\tpoint = prevPoint(point);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\t/**\n\t\t * @method nextPointUntil\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Function} pred\n\t\t * @return {BoundaryPoint}\n\t\t */\n\t\tvar nextPointUntil = function(point, pred) {\n\t\t\twhile(point) {\n\t\t\t\tif(pred(point)) {\n\t\t\t\t\treturn point;\n\t\t\t\t}\n\n\t\t\t\tpoint = nextPoint(point);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\t/**\n\t\t * returns whether point has character or not.\n\t\t *\n\t\t * @param {Point} point\n\t\t * @return {Boolean}\n\t\t */\n\t\tvar isCharPoint = function(point) {\n\t\t\tif(!isText(point.node)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar ch = point.node.nodeValue.charAt(point.offset - 1);\n\t\t\treturn ch && (ch !== ' ' && ch !== NBSP_CHAR);\n\t\t};\n\n\t\t/**\n\t\t * @method walkPoint\n\t\t *\n\t\t * @param {BoundaryPoint} startPoint\n\t\t * @param {BoundaryPoint} endPoint\n\t\t * @param {Function} handler\n\t\t * @param {Boolean} isSkipInnerOffset\n\t\t */\n\t\tvar walkPoint = function(startPoint, endPoint, handler, isSkipInnerOffset) {\n\t\t\tvar point = startPoint;\n\n\t\t\twhile(point) {\n\t\t\t\thandler(point);\n\n\t\t\t\tif(isSamePoint(point, endPoint)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar isSkipOffset = isSkipInnerOffset &&\n\t\t\t\t\tstartPoint.node !== point.node &&\n\t\t\t\t\tendPoint.node !== point.node;\n\t\t\t\tpoint = nextPoint(point, isSkipOffset);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @method makeOffsetPath\n\t\t *\n\t\t * return offsetPath(array of offset) from ancestor\n\t\t *\n\t\t * @param {Node} ancestor - ancestor node\n\t\t * @param {Node} node\n\t\t */\n\t\tvar makeOffsetPath = function(ancestor, node) {\n\t\t\tvar ancestors = listAncestor(node, func.eq(ancestor));\n\t\t\treturn ancestors.map(position).reverse();\n\t\t};\n\n\t\t/**\n\t\t * @method fromOffsetPath\n\t\t *\n\t\t * return element from offsetPath(array of offset)\n\t\t *\n\t\t * @param {Node} ancestor - ancestor node\n\t\t * @param {array} offsets - offsetPath\n\t\t */\n\t\tvar fromOffsetPath = function(ancestor, offsets) {\n\t\t\tvar current = ancestor;\n\t\t\tfor(var i = 0, len = offsets.length; i < len; i++) {\n\t\t\t\tif(current.childNodes.length <= offsets[i]) {\n\t\t\t\t\tcurrent = current.childNodes[current.childNodes.length - 1];\n\t\t\t\t} else {\n\t\t\t\t\tcurrent = current.childNodes[offsets[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn current;\n\t\t};\n\n\t\t/**\n\t\t * @method splitNode\n\t\t *\n\t\t * split element or #text\n\t\t *\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Object} [options]\n\t\t * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n\t\t * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n\t\t * @return {Node} right node of boundaryPoint\n\t\t */\n\t\tvar splitNode = function(point, options) {\n\t\t\tvar isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;\n\t\t\tvar isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;\n\n\t\t\t// edge case\n\t\t\tif(isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {\n\t\t\t\tif(isLeftEdgePoint(point)) {\n\t\t\t\t\treturn point.node;\n\t\t\t\t} else if(isRightEdgePoint(point)) {\n\t\t\t\t\treturn point.node.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// split #text\n\t\t\tif(isText(point.node)) {\n\t\t\t\treturn point.node.splitText(point.offset);\n\t\t\t} else {\n\t\t\t\tvar childNode = point.node.childNodes[point.offset];\n\t\t\t\tvar clone = insertAfter(point.node.cloneNode(false), point.node);\n\t\t\t\tappendChildNodes(clone, listNext(childNode));\n\n\t\t\t\tif(!isSkipPaddingBlankHTML) {\n\t\t\t\t\tpaddingBlankHTML(point.node);\n\t\t\t\t\tpaddingBlankHTML(clone);\n\t\t\t\t}\n\n\t\t\t\treturn clone;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @method splitTree\n\t\t *\n\t\t * split tree by point\n\t\t *\n\t\t * @param {Node} root - split root\n\t\t * @param {BoundaryPoint} point\n\t\t * @param {Object} [options]\n\t\t * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n\t\t * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n\t\t * @return {Node} right node of boundaryPoint\n\t\t */\n\t\tvar splitTree = function(root, point, options) {\n\t\t\t// ex) [#text, <span>, <p>]\n\t\t\tvar ancestors = listAncestor(point.node, func.eq(root));\n\n\t\t\tif(!ancestors.length) {\n\t\t\t\treturn null;\n\t\t\t} else if(ancestors.length === 1) {\n\t\t\t\treturn splitNode(point, options);\n\t\t\t}\n\n\t\t\treturn ancestors.reduce(function(node, parent) {\n\t\t\t\tif(node === point.node) {\n\t\t\t\t\tnode = splitNode(point, options);\n\t\t\t\t}\n\n\t\t\t\treturn splitNode({\n\t\t\t\t\tnode: parent,\n\t\t\t\t\toffset: node ? dom.position(node) : nodeLength(parent)\n\t\t\t\t}, options);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * split point\n\t\t *\n\t\t * @param {Point} point\n\t\t * @param {Boolean} isInline\n\t\t * @return {Object}\n\t\t */\n\t\tvar splitPoint = function(point, isInline) {\n\t\t\t// find splitRoot, container\n\t\t\t//  - inline: splitRoot is a child of paragraph\n\t\t\t//  - block: splitRoot is a child of bodyContainer\n\t\t\tvar pred = isInline ? isPara : isBodyContainer;\n\t\t\tvar ancestors = listAncestor(point.node, pred);\n\t\t\tvar topAncestor = list.last(ancestors) || point.node;\n\n\t\t\tvar splitRoot, container;\n\t\t\tif(pred(topAncestor)) {\n\t\t\t\tsplitRoot = ancestors[ancestors.length - 2];\n\t\t\t\tcontainer = topAncestor;\n\t\t\t} else {\n\t\t\t\tsplitRoot = topAncestor;\n\t\t\t\tcontainer = splitRoot.parentNode;\n\t\t\t}\n\n\t\t\t// if splitRoot is exists, split with splitTree\n\t\t\tvar pivot = splitRoot && splitTree(splitRoot, point, {\n\t\t\t\tisSkipPaddingBlankHTML: isInline,\n\t\t\t\tisNotSplitEdgePoint: isInline\n\t\t\t});\n\n\t\t\t// if container is point.node, find pivot with point.offset\n\t\t\tif(!pivot && container === point.node) {\n\t\t\t\tpivot = point.node.childNodes[point.offset];\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trightNode: pivot,\n\t\t\t\tcontainer: container\n\t\t\t};\n\t\t};\n\n\t\tvar create = function(nodeName) {\n\t\t\treturn document.createElement(nodeName);\n\t\t};\n\n\t\tvar createText = function(text) {\n\t\t\treturn document.createTextNode(text);\n\t\t};\n\n\t\t/**\n\t\t * @method remove\n\t\t *\n\t\t * remove node, (isRemoveChild: remove child or not)\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Boolean} isRemoveChild\n\t\t */\n\t\tvar remove = function(node, isRemoveChild) {\n\t\t\tif(!node || !node.parentNode) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(node.removeNode) {\n\t\t\t\treturn node.removeNode(isRemoveChild);\n\t\t\t}\n\n\t\t\tvar parent = node.parentNode;\n\t\t\tif(!isRemoveChild) {\n\t\t\t\tvar nodes = [];\n\t\t\t\tvar i, len;\n\t\t\t\tfor(i = 0, len = node.childNodes.length; i < len; i++) {\n\t\t\t\t\tnodes.push(node.childNodes[i]);\n\t\t\t\t}\n\n\t\t\t\tfor(i = 0, len = nodes.length; i < len; i++) {\n\t\t\t\t\tparent.insertBefore(nodes[i], node);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparent.removeChild(node);\n\t\t};\n\n\t\t/**\n\t\t * @method removeWhile\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {Function} pred\n\t\t */\n\t\tvar removeWhile = function(node, pred) {\n\t\t\twhile(node) {\n\t\t\t\tif(isEditable(node) || !pred(node)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvar parent = node.parentNode;\n\t\t\t\tremove(node);\n\t\t\t\tnode = parent;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @method replace\n\t\t *\n\t\t * replace node with provided nodeName\n\t\t *\n\t\t * @param {Node} node\n\t\t * @param {String} nodeName\n\t\t * @return {Node} - new node\n\t\t */\n\t\tvar replace = function(node, nodeName) {\n\t\t\tif(node.nodeName.toUpperCase() === nodeName.toUpperCase()) {\n\t\t\t\treturn node;\n\t\t\t}\n\n\t\t\tvar newNode = create(nodeName);\n\n\t\t\tif(node.style.cssText) {\n\t\t\t\tnewNode.style.cssText = node.style.cssText;\n\t\t\t}\n\n\t\t\tappendChildNodes(newNode, list.from(node.childNodes));\n\t\t\tinsertAfter(newNode, node);\n\t\t\tremove(node);\n\n\t\t\treturn newNode;\n\t\t};\n\n\t\tvar isTextarea = makePredByNodeName('TEXTAREA');\n\n\t\t/**\n\t\t * @param {jQuery} $node\n\t\t * @param {Boolean} [stripLinebreaks] - default: false\n\t\t */\n\t\tvar value = function($node, stripLinebreaks) {\n\t\t\tvar val = isTextarea($node[0]) ? $node.val() : $node.html();\n\t\t\tif(stripLinebreaks) {\n\t\t\t\treturn val.replace(/[\\n\\r]/g, '');\n\t\t\t}\n\t\t\treturn val;\n\t\t};\n\n\t\t/**\n\t\t * @method html\n\t\t *\n\t\t * get the HTML contents of node\n\t\t *\n\t\t * @param {jQuery} $node\n\t\t * @param {Boolean} [isNewlineOnBlock]\n\t\t */\n\t\tvar html = function($node, isNewlineOnBlock) {\n\t\t\tvar markup = value($node);\n\n\t\t\tif(isNewlineOnBlock) {\n\t\t\t\tvar regexTag = /<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;\n\t\t\t\tmarkup = markup.replace(regexTag, function(match, endSlash, name) {\n\t\t\t\t\tname = name.toUpperCase();\n\t\t\t\t\tvar isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) &&\n\t\t\t\t\t\t!!endSlash;\n\t\t\t\t\tvar isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);\n\n\t\t\t\t\treturn match + ((isEndOfInlineContainer || isBlockNode) ? '\\n' : '');\n\t\t\t\t});\n\t\t\t\tmarkup = $.trim(markup);\n\t\t\t}\n\n\t\t\treturn markup;\n\t\t};\n\n\t\tvar posFromPlaceholder = function(placeholder) {\n\t\t\tvar $placeholder = $(placeholder);\n\t\t\tvar pos = $placeholder.offset();\n\t\t\tvar height = $placeholder.outerHeight(true); // include margin\n\n\t\t\treturn {\n\t\t\t\tleft: pos.left,\n\t\t\t\ttop: pos.top + height\n\t\t\t};\n\t\t};\n\n\t\tvar attachEvents = function($node, events) {\n\t\t\tObject.keys(events).forEach(function(key) {\n\t\t\t\t$node.on(key, events[key]);\n\t\t\t});\n\t\t};\n\n\t\tvar detachEvents = function($node, events) {\n\t\t\tObject.keys(events).forEach(function(key) {\n\t\t\t\t$node.off(key, events[key]);\n\t\t\t});\n\t\t};\n\n\t\treturn {\n\t\t\t/** @property {String} NBSP_CHAR */\n\t\t\tNBSP_CHAR: NBSP_CHAR,\n\t\t\t/** @property {String} ZERO_WIDTH_NBSP_CHAR */\n\t\t\tZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,\n\t\t\t/** @property {String} blank */\n\t\t\tblank: blankHTML,\n\t\t\t/** @property {String} emptyPara */\n\t\t\temptyPara: '<p>' + blankHTML + '</p>',\n\t\t\tmakePredByNodeName: makePredByNodeName,\n\t\t\tisEditable: isEditable,\n\t\t\tisControlSizing: isControlSizing,\n\t\t\tisText: isText,\n\t\t\tisElement: isElement,\n\t\t\tisVoid: isVoid,\n\t\t\tisPara: isPara,\n\t\t\tisPurePara: isPurePara,\n\t\t\tisHeading: isHeading,\n\t\t\tisInline: isInline,\n\t\t\tisBlock: func.not(isInline),\n\t\t\tisBodyInline: isBodyInline,\n\t\t\tisBody: isBody,\n\t\t\tisParaInline: isParaInline,\n\t\t\tisPre: isPre,\n\t\t\tisList: isList,\n\t\t\tisTable: isTable,\n\t\t\tisCell: isCell,\n\t\t\tisBlockquote: isBlockquote,\n\t\t\tisBodyContainer: isBodyContainer,\n\t\t\tisAnchor: isAnchor,\n\t\t\tisDiv: makePredByNodeName('DIV'),\n\t\t\tisLi: isLi,\n\t\t\tisBR: makePredByNodeName('BR'),\n\t\t\tisSpan: makePredByNodeName('SPAN'),\n\t\t\tisB: makePredByNodeName('B'),\n\t\t\tisU: makePredByNodeName('U'),\n\t\t\tisS: makePredByNodeName('S'),\n\t\t\tisI: makePredByNodeName('I'),\n\t\t\tisImg: makePredByNodeName('IMG'),\n\t\t\tisTextarea: isTextarea,\n\t\t\tisEmpty: isEmpty,\n\t\t\tisEmptyAnchor: func.and(isAnchor, isEmpty),\n\t\t\tisClosestSibling: isClosestSibling,\n\t\t\twithClosestSiblings: withClosestSiblings,\n\t\t\tnodeLength: nodeLength,\n\t\t\tisLeftEdgePoint: isLeftEdgePoint,\n\t\t\tisRightEdgePoint: isRightEdgePoint,\n\t\t\tisEdgePoint: isEdgePoint,\n\t\t\tisLeftEdgeOf: isLeftEdgeOf,\n\t\t\tisRightEdgeOf: isRightEdgeOf,\n\t\t\tisLeftEdgePointOf: isLeftEdgePointOf,\n\t\t\tisRightEdgePointOf: isRightEdgePointOf,\n\t\t\tprevPoint: prevPoint,\n\t\t\tnextPoint: nextPoint,\n\t\t\tisSamePoint: isSamePoint,\n\t\t\tisVisiblePoint: isVisiblePoint,\n\t\t\tprevPointUntil: prevPointUntil,\n\t\t\tnextPointUntil: nextPointUntil,\n\t\t\tisCharPoint: isCharPoint,\n\t\t\twalkPoint: walkPoint,\n\t\t\tancestor: ancestor,\n\t\t\tsingleChildAncestor: singleChildAncestor,\n\t\t\tlistAncestor: listAncestor,\n\t\t\tlastAncestor: lastAncestor,\n\t\t\tlistNext: listNext,\n\t\t\tlistPrev: listPrev,\n\t\t\tlistDescendant: listDescendant,\n\t\t\tcommonAncestor: commonAncestor,\n\t\t\twrap: wrap,\n\t\t\tinsertAfter: insertAfter,\n\t\t\tappendChildNodes: appendChildNodes,\n\t\t\tposition: position,\n\t\t\thasChildren: hasChildren,\n\t\t\tmakeOffsetPath: makeOffsetPath,\n\t\t\tfromOffsetPath: fromOffsetPath,\n\t\t\tsplitTree: splitTree,\n\t\t\tsplitPoint: splitPoint,\n\t\t\tcreate: create,\n\t\t\tcreateText: createText,\n\t\t\tremove: remove,\n\t\t\tremoveWhile: removeWhile,\n\t\t\treplace: replace,\n\t\t\thtml: html,\n\t\t\tvalue: value,\n\t\t\tposFromPlaceholder: posFromPlaceholder,\n\t\t\tattachEvents: attachEvents,\n\t\t\tdetachEvents: detachEvents\n\t\t};\n\t})();\n\n\t/**\n\t * @param {jQuery} $note\n\t * @param {Object} options\n\t * @return {Context}\n\t */\n\tvar Context = function($note, options) {\n\t\tvar self = this;\n\n\t\tvar ui = $.summernote.ui;\n\t\tthis.memos = {};\n\t\tthis.modules = {};\n\t\tthis.layoutInfo = {};\n\t\tthis.options = options;\n\n\t\t/**\n\t\t * create layout and initialize modules and other resources\n\t\t */\n\t\tthis.initialize = function() {\n\t\t\tthis.layoutInfo = ui.createLayout($note, options);\n\t\t\tthis._initialize();\n\t\t\t$note.hide();\n\t\t\treturn this;\n\t\t};\n\n\t\t/**\n\t\t * destroy modules and other resources and remove layout\n\t\t */\n\t\tthis.destroy = function() {\n\t\t\tthis._destroy();\n\t\t\t$note.removeData('summernote');\n\t\t\tui.removeLayout($note, this.layoutInfo);\n\t\t};\n\n\t\t/**\n\t\t * destory modules and other resources and initialize it again\n\t\t */\n\t\tthis.reset = function() {\n\t\t\tvar disabled = self.isDisabled();\n\t\t\tthis.code(dom.emptyPara);\n\t\t\tthis._destroy();\n\t\t\tthis._initialize();\n\n\t\t\tif(disabled) {\n\t\t\t\tself.disable();\n\t\t\t}\n\t\t};\n\n\t\tthis._initialize = function() {\n\t\t\t// add optional buttons\n\t\t\tvar buttons = $.extend({}, this.options.buttons);\n\t\t\tObject.keys(buttons).forEach(function(key) {\n\t\t\t\tself.memo('button.' + key, buttons[key]);\n\t\t\t});\n\n\t\t\tvar modules = $.extend({}, this.options.modules, $.summernote.plugins || {});\n\n\t\t\t// add and initialize modules\n\t\t\tObject.keys(modules).forEach(function(key) {\n\t\t\t\tself.module(key, modules[key], true);\n\t\t\t});\n\n\t\t\tObject.keys(this.modules).forEach(function(key) {\n\t\t\t\tself.initializeModule(key);\n\t\t\t});\n\t\t};\n\n\t\tthis._destroy = function() {\n\t\t\t// destroy modules with reversed order\n\t\t\tObject.keys(this.modules).reverse().forEach(function(key) {\n\t\t\t\tself.removeModule(key);\n\t\t\t});\n\n\t\t\tObject.keys(this.memos).forEach(function(key) {\n\t\t\t\tself.removeMemo(key);\n\t\t\t});\n\t\t};\n\n\t\tthis.code = function(html) {\n\t\t\tvar isActivated = this.invoke('codeview.isActivated');\n\n\t\t\tif(html === undefined) {\n\t\t\t\tthis.invoke('codeview.sync');\n\t\t\t\treturn isActivated ? this.layoutInfo.codable.val() : this.layoutInfo.editable.html();\n\t\t\t} else {\n\t\t\t\tif(isActivated) {\n\t\t\t\t\tthis.layoutInfo.codable.val(html);\n\t\t\t\t} else {\n\t\t\t\t\tthis.layoutInfo.editable.html(html);\n\t\t\t\t}\n\t\t\t\t$note.val(html);\n\t\t\t\tthis.triggerEvent('change', html);\n\t\t\t}\n\t\t};\n\n\t\tthis.isDisabled = function() {\n\t\t\treturn this.layoutInfo.editable.attr('contenteditable') === 'false';\n\t\t};\n\n\t\tthis.enable = function() {\n\t\t\tthis.layoutInfo.editable.attr('contenteditable', true);\n\t\t\tthis.invoke('toolbar.activate', true);\n\t\t};\n\n\t\tthis.disable = function() {\n\t\t\t// close codeview if codeview is opend\n\t\t\tif(this.invoke('codeview.isActivated')) {\n\t\t\t\tthis.invoke('codeview.deactivate');\n\t\t\t}\n\t\t\tthis.layoutInfo.editable.attr('contenteditable', false);\n\t\t\tthis.invoke('toolbar.deactivate', true);\n\t\t};\n\n\t\tthis.triggerEvent = function() {\n\t\t\tvar namespace = list.head(arguments);\n\t\t\tvar args = list.tail(list.from(arguments));\n\n\t\t\tvar callback = this.options.callbacks[func.namespaceToCamel(namespace, 'on')];\n\t\t\tif(callback) {\n\t\t\t\tcallback.apply($note[0], args);\n\t\t\t}\n\t\t\t$note.trigger('summernote.' + namespace, args);\n\t\t};\n\n\t\tthis.initializeModule = function(key) {\n\t\t\tvar module = this.modules[key];\n\t\t\tmodule.shouldInitialize = module.shouldInitialize || func.ok;\n\t\t\tif(!module.shouldInitialize()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// initialize module\n\t\t\tif(module.initialize) {\n\t\t\t\tmodule.initialize();\n\t\t\t}\n\n\t\t\t// attach events\n\t\t\tif(module.events) {\n\t\t\t\tdom.attachEvents($note, module.events);\n\t\t\t}\n\t\t};\n\n\t\tthis.module = function(key, ModuleClass, withoutIntialize) {\n\t\t\tif(arguments.length === 1) {\n\t\t\t\treturn this.modules[key];\n\t\t\t}\n\n\t\t\tthis.modules[key] = new ModuleClass(this);\n\n\t\t\tif(!withoutIntialize) {\n\t\t\t\tthis.initializeModule(key);\n\t\t\t}\n\t\t};\n\n\t\tthis.removeModule = function(key) {\n\t\t\tvar module = this.modules[key];\n\t\t\tif(module.shouldInitialize()) {\n\t\t\t\tif(module.events) {\n\t\t\t\t\tdom.detachEvents($note, module.events);\n\t\t\t\t}\n\n\t\t\t\tif(module.destroy) {\n\t\t\t\t\tmodule.destroy();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelete this.modules[key];\n\t\t};\n\n\t\tthis.memo = function(key, obj) {\n\t\t\tif(arguments.length === 1) {\n\t\t\t\treturn this.memos[key];\n\t\t\t}\n\t\t\tthis.memos[key] = obj;\n\t\t};\n\n\t\tthis.removeMemo = function(key) {\n\t\t\tif(this.memos[key] && this.memos[key].destroy) {\n\t\t\t\tthis.memos[key].destroy();\n\t\t\t}\n\n\t\t\tdelete this.memos[key];\n\t\t};\n\n\t\tthis.createInvokeHandler = function(namespace, value) {\n\t\t\treturn function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tself.invoke(namespace, value || $(event.target).closest('[data-value]').data('value'));\n\t\t\t};\n\t\t};\n\n\t\tthis.invoke = function() {\n\t\t\tvar namespace = list.head(arguments);\n\t\t\tvar args = list.tail(list.from(arguments));\n\n\t\t\tvar splits = namespace.split('.');\n\t\t\tvar hasSeparator = splits.length > 1;\n\t\t\tvar moduleName = hasSeparator && list.head(splits);\n\t\t\tvar methodName = hasSeparator ? list.last(splits) : list.head(splits);\n\n\t\t\tvar module = this.modules[moduleName || 'editor'];\n\t\t\tif(!moduleName && this[methodName]) {\n\t\t\t\treturn this[methodName].apply(this, args);\n\t\t\t} else if(module && module[methodName] && module.shouldInitialize()) {\n\t\t\t\treturn module[methodName].apply(module, args);\n\t\t\t}\n\t\t};\n\n\t\treturn this.initialize();\n\t};\n\n\t$.fn.extend({\n\t\t/**\n\t\t * Summernote API\n\t\t *\n\t\t * @param {Object|String}\n\t\t * @return {this}\n\t\t */\n\t\tsummernote: function() {\n\t\t\tvar type = $.type(list.head(arguments));\n\t\t\tvar isExternalAPICalled = type === 'string';\n\t\t\tvar hasInitOptions = type === 'object';\n\n\t\t\tvar options = hasInitOptions ? list.head(arguments) : {};\n\n\t\t\toptions = $.extend({}, $.summernote.options, options);\n\t\t\toptions.langInfo = $.extend(true, {}, $.summernote.lang['en-US'], $.summernote.lang[options.lang]);\n\n\t\t\tthis.each(function(idx, note) {\n\t\t\t\tvar $note = $(note);\n\t\t\t\tif(!$note.data('summernote')) {\n\t\t\t\t\tvar context = new Context($note, options);\n\t\t\t\t\t$note.data('summernote', context);\n\t\t\t\t\t$note.data('summernote').triggerEvent('init', context.layoutInfo);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar $note = this.first();\n\t\t\tif($note.length) {\n\t\t\t\tvar context = $note.data('summernote');\n\t\t\t\tif(isExternalAPICalled) {\n\t\t\t\t\treturn context.invoke.apply(context, list.from(arguments));\n\t\t\t\t} else if(options.focus) {\n\t\t\t\t\tcontext.invoke('editor.focus');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t});\n\n\tvar Renderer = function(markup, children, options, callback) {\n\t\tthis.render = function($parent) {\n\t\t\tvar $node = $(markup);\n\n\t\t\tif(options && options.contents) {\n\t\t\t\t$node.html(options.contents);\n\t\t\t}\n\n\t\t\tif(options && options.className) {\n\t\t\t\t$node.addClass(options.className);\n\t\t\t}\n\n\t\t\tif(options && options.data) {\n\t\t\t\t$.each(options.data, function(k, v) {\n\t\t\t\t\t$node.attr('data-' + k, v);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif(options && options.click) {\n\t\t\t\t$node.on('click', options.click);\n\t\t\t}\n\n\t\t\tif(children) {\n\t\t\t\tvar $container = $node.find('.note-children-container');\n\t\t\t\tchildren.forEach(function(child) {\n\t\t\t\t\tchild.render($container.length ? $container : $node);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif(callback) {\n\t\t\t\tcallback($node, options);\n\t\t\t}\n\n\t\t\tif(options && options.callback) {\n\t\t\t\toptions.callback($node);\n\t\t\t}\n\n\t\t\tif($parent) {\n\t\t\t\t$parent.append($node);\n\t\t\t}\n\n\t\t\treturn $node;\n\t\t};\n\t};\n\n\tvar renderer = {\n\t\tcreate: function(markup, callback) {\n\t\t\treturn function() {\n\t\t\t\tvar children = $.isArray(arguments[0]) ? arguments[0] : [];\n\t\t\t\tvar options = typeof arguments[1] === 'object' ? arguments[1] : arguments[0];\n\t\t\t\tif(options && options.children) {\n\t\t\t\t\tchildren = options.children;\n\t\t\t\t}\n\t\t\t\treturn new Renderer(markup, children, options, callback);\n\t\t\t};\n\t\t}\n\t};\n\n\tvar TooltipUI = (function() {\n\t\tvar Tooltip = function($node, options) {\n\t\t\tvar self = this;\n\n\t\t\tthis.init = function(options) {\n\t\t\t\tthis.options = $.extend({}, {\n\t\t\t\t\ttitle: '',\n\t\t\t\t\ttarget: 'body',\n\t\t\t\t\ttrigger: 'hover focus',\n\t\t\t\t\tplacement: 'bottom'\n\t\t\t\t}, options);\n\n\t\t\t\t// create tooltip node\n\t\t\t\tthis.$tooltip = $([\n\t\t\t\t\t'<div class=\"note-tooltip in\">',\n\t\t\t\t\t'  <div class=\"note-tooltip-arrow\"/>',\n\t\t\t\t\t'  <div class=\"note-tooltip-content\"/>',\n\t\t\t\t\t'</div>'\n\t\t\t\t].join(''));\n\n\t\t\t\t// define event\n\t\t\t\tif(this.options.trigger !== 'manual') {\n\t\t\t\t\tthis.options.trigger.split(' ').forEach(function(eventName) {\n\t\t\t\t\t\tif(eventName === 'hover') {\n\t\t\t\t\t\t\t$node.off('mouseenter mouseleave');\n\n\t\t\t\t\t\t\t$node.on('mouseenter', function() {\n\t\t\t\t\t\t\t\tself.show($node);\n\t\t\t\t\t\t\t}).on('mouseleave', function() {\n\t\t\t\t\t\t\t\tself.hide($node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if(eventName === 'click') {\n\t\t\t\t\t\t\t$node.on('click', function() {\n\t\t\t\t\t\t\t\tself.toggle($node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if(eventName === 'focus') {\n\t\t\t\t\t\t\t$node.on('focus', function() {\n\t\t\t\t\t\t\t\tself.show($node);\n\t\t\t\t\t\t\t}).on('blur', function() {\n\t\t\t\t\t\t\t\tself.hide($node);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.show = function() {\n\t\t\t\tvar offset = $node.offset();\n\n\t\t\t\tvar $tooltip = this.$tooltip;\n\t\t\t\tvar title = this.options.title || $node.attr('title') || $node.data('title');\n\t\t\t\tvar placement = this.options.placement || $node.data('placement');\n\n\t\t\t\t$tooltip.addClass(placement);\n\t\t\t\t$tooltip.addClass('in');\n\t\t\t\t$tooltip.find('.note-tooltip-content').text(title);\n\t\t\t\t$tooltip.appendTo(this.options.target);\n\n\t\t\t\tvar nodeWidth = $node.outerWidth();\n\t\t\t\tvar nodeHeight = $node.outerHeight();\n\t\t\t\tvar tooltipWidth = $tooltip.outerWidth();\n\t\t\t\tvar tooltipHeight = $tooltip.outerHeight();\n\n\t\t\t\tif(placement === 'bottom') {\n\t\t\t\t\t$tooltip.css({\n\t\t\t\t\t\ttop: offset.top + nodeHeight,\n\t\t\t\t\t\tleft: offset.left + (nodeWidth / 2 - tooltipWidth / 2)\n\t\t\t\t\t});\n\t\t\t\t} else if(placement === 'top') {\n\t\t\t\t\t$tooltip.css({\n\t\t\t\t\t\ttop: offset.top - tooltipHeight,\n\t\t\t\t\t\tleft: offset.left + (nodeWidth / 2 - tooltipWidth / 2)\n\t\t\t\t\t});\n\t\t\t\t} else if(placement === 'left') {\n\t\t\t\t\t$tooltip.css({\n\t\t\t\t\t\ttop: offset.top + (nodeHeight / 2 - tooltipHeight / 2),\n\t\t\t\t\t\tleft: offset.left - tooltipWidth\n\t\t\t\t\t});\n\t\t\t\t} else if(placement === 'right') {\n\t\t\t\t\t$tooltip.css({\n\t\t\t\t\t\ttop: offset.top + (nodeHeight / 2 - tooltipHeight / 2),\n\t\t\t\t\t\tleft: offset.left + nodeWidth\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.hide = function() {\n\t\t\t\tthis.$tooltip.removeClass('in');\n\t\t\t\tthis.$tooltip.remove();\n\t\t\t};\n\n\t\t\tthis.toggle = function() {\n\t\t\t\tif(this.$tooltip.hasClass('in')) {\n\t\t\t\t\tthis.hide();\n\t\t\t\t} else {\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.init(options);\n\t\t};\n\n\t\treturn {\n\t\t\tcreate: function($node, options) {\n\t\t\t\treturn new Tooltip($node, options);\n\t\t\t}\n\t\t};\n\t})();\n\n\tvar DropdownUI = (function() {\n\n\t\tvar Dropdown = function($node, options) {\n\t\t\tvar self = this;\n\n\t\t\tthis.init = function() {\n\t\t\t\tthis.$button = $node;\n\t\t\t\tthis.setEvent();\n\t\t\t};\n\n\t\t\tthis.setEvent = function() {\n\t\t\t\tthis.$button.on('click', function() {\n\t\t\t\t\tself.toggle();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis.clear = function() {\n\t\t\t\tvar $parent = $('.note-btn-group.open');\n\t\t\t\t$parent.find('.note-btn.active').removeClass('active');\n\t\t\t\t$parent.removeClass('open');\n\t\t\t};\n\n\t\t\tthis.show = function() {\n\t\t\t\tthis.$button.addClass('active');\n\t\t\t\tthis.$button.parent().addClass('open');\n\n\t\t\t\tvar $dropdown = this.$button.next();\n\t\t\t\tvar offset = $dropdown.offset();\n\t\t\t\tvar width = $dropdown.outerWidth();\n\t\t\t\tvar windowWidth = $(window).width();\n\t\t\t\tvar bodyMarginRight = parseFloat($('body').css('margin-right'));\n\n\t\t\t\tif(offset.left + width > windowWidth - bodyMarginRight) {\n\t\t\t\t\t$dropdown.css('margin-left', windowWidth - bodyMarginRight - (offset.left + width));\n\t\t\t\t} else {\n\t\t\t\t\t$dropdown.css('margin-left', '');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.hide = function() {\n\t\t\t\tthis.$button.removeClass('active');\n\t\t\t\tthis.$button.parent().removeClass('open');\n\t\t\t};\n\n\t\t\tthis.toggle = function() {\n\t\t\t\tvar isOpened = this.$button.parent().hasClass('open');\n\n\t\t\t\tthis.clear();\n\n\t\t\t\tif(isOpened) {\n\t\t\t\t\tthis.hide();\n\t\t\t\t} else {\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.init(options);\n\t\t};\n\n\t\treturn {\n\t\t\tcreate: function($node, options) {\n\t\t\t\treturn new Dropdown($node, options);\n\t\t\t}\n\t\t};\n\t})();\n\n\t$(document).on('click', function(e) {\n\t\tif(!$(e.target).closest('.note-btn-group').length) {\n\t\t\t$('.note-btn-group.open').removeClass('open');\n\t\t}\n\t});\n\n\t$(document).on('click.note-dropdown-menu', function(e) {\n\t\t$(e.target).closest('.note-dropdown-menu').parent().removeClass('open');\n\t});\n\n\tvar ModalUI = (function() {\n\t\tvar Modal = function($node, options) {\n\t\t\tvar self = this;\n\n\t\t\tthis.init = function(options) {\n\t\t\t\tthis.options = $.extend({}, {\n\t\t\t\t\ttarget: 'body'\n\t\t\t\t}, options);\n\n\t\t\t\tthis.$modal = $node;\n\t\t\t\tthis.$backdrop = $('<div class=\"note-modal-backdrop\" />');\n\n\t\t\t};\n\n\t\t\tthis.show = function() {\n\t\t\t\tif(this.options.target === 'body') {\n\t\t\t\t\tthis.$backdrop.css('position', 'fixed');\n\t\t\t\t\tthis.$modal.css('position', 'fixed');\n\t\t\t\t} else {\n\t\t\t\t\tthis.$backdrop.css('position', 'absolute');\n\t\t\t\t\tthis.$modal.css('position', 'absolute');\n\t\t\t\t}\n\n\t\t\t\tthis.$backdrop.appendTo(this.options.target).show();\n\t\t\t\tthis.$modal.appendTo(this.options.target).addClass('open').show();\n\n\t\t\t\tthis.$modal.trigger('note.modal.show');\n\t\t\t\tthis.$modal.off('click', '.close').on('click', '.close', function() {\n\t\t\t\t\tself.hide();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tthis.hide = function() {\n\t\t\t\tthis.$modal.removeClass('open').hide();\n\t\t\t\tthis.$backdrop.hide();\n\t\t\t\tthis.$modal.trigger('note.modal.hide');\n\t\t\t};\n\n\t\t\tthis.init(options);\n\t\t};\n\n\t\treturn {\n\t\t\tcreate: function($node, options) {\n\t\t\t\treturn new Modal($node, options);\n\t\t\t}\n\t\t};\n\t})();\n\n\tvar editor = renderer.create('<div class=\"note-editor note-frame\"/>');\n\tvar toolbar = renderer.create('<div class=\"note-toolbar\"/>');\n\tvar editingArea = renderer.create('<div class=\"note-editing-area\"/>');\n\tvar codable = renderer.create('<textarea class=\"note-codable\"/>');\n\tvar editable = renderer.create('<div class=\"note-editable\" contentEditable=\"true\"/>');\n\tvar statusbar = renderer.create([\n\t\t'<div class=\"note-statusbar\">',\n\t\t'  <div class=\"note-resizebar\">',\n\t\t'    <div class=\"note-icon-bar\"/>',\n\t\t'    <div class=\"note-icon-bar\"/>',\n\t\t'    <div class=\"note-icon-bar\"/>',\n\t\t'  </div>',\n\t\t'</div>'\n\t].join(''));\n\n\tvar airEditor = renderer.create('<div class=\"note-editor\"/>');\n\tvar airEditable = renderer.create('<div class=\"note-editable\" contentEditable=\"true\"/>');\n\n\tvar buttonGroup = renderer.create('<div class=\"note-btn-group\">');\n\tvar button = renderer.create('<button type=\"button\" class=\"note-btn\">', function($node, options) {\n\t\t// set button type\n\t\tif(options && options.tooltip) {\n\t\t\tTooltipUI.create($node, {\n\t\t\t\ttitle: options.tooltip\n\t\t\t});\n\t\t}\n\n\t\tif(options && options.data && options.data.toggle === 'dropdown') {\n\t\t\tDropdownUI.create($node);\n\t\t}\n\t});\n\n\tvar dropdown = renderer.create('<div class=\"note-dropdown-menu\">', function($node, options) {\n\t\tvar markup = $.isArray(options.items) ? options.items.map(function(item) {\n\t\t\tvar value = (typeof item === 'string') ? item : (item.value || '');\n\t\t\tvar content = options.template ? options.template(item) : item;\n\t\t\tvar $temp = $('<a class=\"note-dropdown-item\" href=\"#\" data-value=\"' + value + '\"></a>');\n\n\t\t\t$temp.html(content).data('item', item);\n\n\t\t\treturn $temp;\n\t\t}) : options.items;\n\n\t\t$node.html(markup);\n\n\t\t$node.on('click', '> .note-dropdown-item', function(e) {\n\t\t\tvar $a = $(this);\n\n\t\t\tvar item = $a.data('item');\n\t\t\tvar value = $a.data('value');\n\n\t\t\tif(item.click) {\n\t\t\t\titem.click($a);\n\t\t\t} else if(options.itemClick) {\n\t\t\t\toptions.itemClick(e, item, value);\n\t\t\t}\n\n\t\t});\n\t});\n\n\tvar dropdownCheck = renderer.create('<div class=\"note-dropdown-menu note-check\">', function($node, options) {\n\t\tvar markup = $.isArray(options.items) ? options.items.map(function(item) {\n\t\t\tvar value = (typeof item === 'string') ? item : (item.value || '');\n\t\t\tvar content = options.template ? options.template(item) : item;\n\n\t\t\tvar $temp = $('<a class=\"note-dropdown-item\" href=\"#\" data-value=\"' + value + '\"></a>');\n\t\t\t$temp.html([icon(options.checkClassName), ' ', content]).data('item', item);\n\t\t\treturn $temp;\n\t\t}) : options.items;\n\n\t\t$node.html(markup);\n\n\t\t$node.on('click', '> .note-dropdown-item', function(e) {\n\t\t\tvar $a = $(this);\n\t\t\tvar item = $a.data('item');\n\t\t\tvar value = $a.data('value');\n\n\t\t\tif(item.click) {\n\t\t\t\titem.click($a);\n\t\t\t} else if(options.itemClick) {\n\t\t\t\toptions.itemClick(e, item, value);\n\t\t\t}\n\t\t});\n\t});\n\n\tvar dropdownButton = function(opt, callback) {\n\t\treturn buttonGroup([\n\t\t\tbutton({\n\t\t\t\tclassName: 'dropdown-toggle',\n\t\t\t\tcontents: opt.title + ' ' + icon('note-icon-caret'),\n\t\t\t\ttooltip: opt.tooltip,\n\t\t\t\tdata: {\n\t\t\t\t\ttoggle: 'dropdown'\n\t\t\t\t}\n\t\t\t}),\n\t\t\tdropdown({\n\t\t\t\tclassName: opt.className,\n\t\t\t\titems: opt.items,\n\t\t\t\ttemplate: opt.template,\n\t\t\t\titemClick: opt.itemClick\n\t\t\t})\n\t\t], {\n\t\t\tcallback: callback\n\t\t}).render();\n\t};\n\n\tvar dropdownCheckButton = function(opt, callback) {\n\t\treturn buttonGroup([\n\t\t\tbutton({\n\t\t\t\tclassName: 'dropdown-toggle',\n\t\t\t\tcontents: opt.title + ' ' + icon('note-icon-caret'),\n\t\t\t\ttooltip: opt.tooltip,\n\t\t\t\tdata: {\n\t\t\t\t\ttoggle: 'dropdown'\n\t\t\t\t}\n\t\t\t}),\n\t\t\tdropdownCheck({\n\t\t\t\tclassName: opt.className,\n\t\t\t\tcheckClassName: opt.checkClassName,\n\t\t\t\titems: opt.items,\n\t\t\t\ttemplate: opt.template,\n\t\t\t\titemClick: opt.itemClick\n\t\t\t})\n\t\t], {\n\t\t\tcallback: callback\n\t\t}).render();\n\t};\n\n\tvar paragraphDropdownButton = function(opt) {\n\n\t\treturn buttonGroup([\n\t\t\tbutton({\n\t\t\t\tclassName: 'dropdown-toggle',\n\t\t\t\tcontents: opt.title + ' ' + icon('note-icon-caret'),\n\t\t\t\ttooltip: opt.tooltip,\n\t\t\t\tdata: {\n\t\t\t\t\ttoggle: 'dropdown'\n\t\t\t\t}\n\t\t\t}),\n\t\t\tdropdown([\n\t\t\t\tbuttonGroup({\n\t\t\t\t\tclassName: 'note-align',\n\t\t\t\t\tchildren: opt.items[0]\n\t\t\t\t}),\n\t\t\t\tbuttonGroup({\n\t\t\t\t\tclassName: 'note-list',\n\t\t\t\t\tchildren: opt.items[1]\n\t\t\t\t})\n\t\t\t])\n\t\t]).render();\n\t};\n\n\tvar tableMoveHandler = function(event, col, row) {\n\t\tvar PX_PER_EM = 18;\n\t\tvar $picker = $(event.target.parentNode); // target is mousecatcher\n\t\tvar $dimensionDisplay = $picker.next();\n\t\tvar $catcher = $picker.find('.note-dimension-picker-mousecatcher');\n\t\tvar $highlighted = $picker.find('.note-dimension-picker-highlighted');\n\t\tvar $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');\n\n\t\tvar posOffset;\n\t\t// HTML5 with jQuery - e.offsetX is undefined in Firefox\n\t\tif(event.offsetX === undefined) {\n\t\t\tvar posCatcher = $(event.target).offset();\n\t\t\tposOffset = {\n\t\t\t\tx: event.pageX - posCatcher.left,\n\t\t\t\ty: event.pageY - posCatcher.top\n\t\t\t};\n\t\t} else {\n\t\t\tposOffset = {\n\t\t\t\tx: event.offsetX,\n\t\t\t\ty: event.offsetY\n\t\t\t};\n\t\t}\n\n\t\tvar dim = {\n\t\t\tc: Math.ceil(posOffset.x / PX_PER_EM) || 1,\n\t\t\tr: Math.ceil(posOffset.y / PX_PER_EM) || 1\n\t\t};\n\n\t\t$highlighted.css({\n\t\t\twidth: dim.c + 'em',\n\t\t\theight: dim.r + 'em'\n\t\t});\n\t\t$catcher.data('value', dim.c + 'x' + dim.r);\n\n\t\tif(3 < dim.c && dim.c < col) {\n\t\t\t$unhighlighted.css({\n\t\t\t\twidth: dim.c + 1 + 'em'\n\t\t\t});\n\t\t}\n\n\t\tif(3 < dim.r && dim.r < row) {\n\t\t\t$unhighlighted.css({\n\t\t\t\theight: dim.r + 1 + 'em'\n\t\t\t});\n\t\t}\n\n\t\t$dimensionDisplay.html(dim.c + ' x ' + dim.r);\n\t};\n\n\tvar tableDropdownButton = function(opt) {\n\n\t\treturn buttonGroup([\n\t\t\tbutton({\n\t\t\t\tclassName: 'dropdown-toggle',\n\t\t\t\tcontents: opt.title + ' ' + icon('note-icon-caret'),\n\t\t\t\ttooltip: opt.tooltip,\n\t\t\t\tdata: {\n\t\t\t\t\ttoggle: 'dropdown'\n\t\t\t\t}\n\t\t\t}),\n\t\t\tdropdown({\n\t\t\t\tclassName: 'note-table',\n\t\t\t\titems: [\n\t\t\t\t\t'<div class=\"note-dimension-picker\">',\n\t\t\t\t\t'  <div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"/>',\n\t\t\t\t\t'  <div class=\"note-dimension-picker-highlighted\"/>',\n\t\t\t\t\t'  <div class=\"note-dimension-picker-unhighlighted\"/>',\n\t\t\t\t\t'</div>',\n\t\t\t\t\t'<div class=\"note-dimension-display\">1 x 1</div>'\n\t\t\t\t].join('')\n\t\t\t})\n\t\t], {\n\t\t\tcallback: function($node) {\n\t\t\t\tvar $catcher = $node.find('.note-dimension-picker-mousecatcher');\n\t\t\t\t$catcher.css({\n\t\t\t\t\t\twidth: opt.col + 'em',\n\t\t\t\t\t\theight: opt.row + 'em'\n\t\t\t\t\t})\n\t\t\t\t\t.mousedown(opt.itemClick)\n\t\t\t\t\t.mousemove(function(e) {\n\t\t\t\t\t\ttableMoveHandler(e, opt.col, opt.row);\n\t\t\t\t\t});\n\t\t\t}\n\t\t}).render();\n\t};\n\n\tvar palette = renderer.create('<div class=\"note-color-palette\"/>', function($node, options) {\n\t\tvar contents = [];\n\t\tfor(var row = 0, rowSize = options.colors.length; row < rowSize; row++) {\n\t\t\tvar eventName = options.eventName;\n\t\t\tvar colors = options.colors[row];\n\t\t\tvar buttons = [];\n\t\t\tfor(var col = 0, colSize = colors.length; col < colSize; col++) {\n\t\t\t\tvar color = colors[col];\n\t\t\t\tbuttons.push([\n\t\t\t\t\t'<button type=\"button\" class=\"note-btn note-color-btn\"',\n\t\t\t\t\t'style=\"background-color:', color, '\" ',\n\t\t\t\t\t'data-event=\"', eventName, '\" ',\n\t\t\t\t\t'data-value=\"', color, '\" ',\n\t\t\t\t\t'title=\"', color, '\" ',\n\t\t\t\t\t'data-toggle=\"button\" tabindex=\"-1\"></button>'\n\t\t\t\t].join(''));\n\t\t\t}\n\t\t\tcontents.push('<div class=\"note-color-row\">' + buttons.join('') + '</div>');\n\t\t}\n\t\t$node.html(contents.join(''));\n\n\t\t$node.find('.note-color-btn').each(function() {\n\t\t\tTooltipUI.create($(this));\n\t\t});\n\n\t});\n\n\tvar colorDropdownButton = function(opt, type) {\n\n\t\treturn buttonGroup({\n\t\t\tclassName: 'note-color',\n\t\t\tchildren: [\n\t\t\t\tbutton({\n\t\t\t\t\tclassName: 'note-current-color-button',\n\t\t\t\t\tcontents: opt.title,\n\t\t\t\t\ttooltip: opt.lang.color.recent,\n\t\t\t\t\tclick: opt.currentClick,\n\t\t\t\t\tcallback: function($button) {\n\t\t\t\t\t\tvar $recentColor = $button.find('.note-recent-color');\n\n\t\t\t\t\t\tif(type !== 'foreColor') {\n\t\t\t\t\t\t\t$recentColor.css('background-color', '#FFFF00');\n\t\t\t\t\t\t\t$button.attr('data-backColor', '#FFFF00');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tbutton({\n\t\t\t\t\tclassName: 'dropdown-toggle',\n\t\t\t\t\tcontents: icon('note-icon-caret'),\n\t\t\t\t\ttooltip: opt.lang.color.more,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\ttoggle: 'dropdown'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tdropdown({\n\t\t\t\t\titems: [\n\t\t\t\t\t\t'<div>',\n\t\t\t\t\t\t'<div class=\"note-btn-group btn-background-color\">',\n\t\t\t\t\t\t'  <div class=\"note-palette-title\">' + opt.lang.color.background + '</div>',\n\t\t\t\t\t\t'  <div>',\n\t\t\t\t\t\t'<button type=\"button\" class=\"note-color-reset note-btn note-btn-block\" ' +\n\t\t\t\t\t\t' data-event=\"backColor\" data-value=\"inherit\">',\n\t\t\t\t\t\topt.lang.color.transparent,\n\t\t\t\t\t\t'    </button>',\n\t\t\t\t\t\t'  </div>',\n\t\t\t\t\t\t'  <div class=\"note-holder\" data-event=\"backColor\"/>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'<div class=\"note-btn-group btn-foreground-color\">',\n\t\t\t\t\t\t'  <div class=\"note-palette-title\">' + opt.lang.color.foreground + '</div>',\n\t\t\t\t\t\t'  <div>',\n\t\t\t\t\t\t'<button type=\"button\" class=\"note-color-reset note-btn note-btn-block\" ' +\n\t\t\t\t\t\t' data-event=\"removeFormat\" data-value=\"foreColor\">',\n\t\t\t\t\t\topt.lang.color.resetToDefault,\n\t\t\t\t\t\t'    </button>',\n\t\t\t\t\t\t'  </div>',\n\t\t\t\t\t\t'  <div class=\"note-holder\" data-event=\"foreColor\"/>',\n\t\t\t\t\t\t'</div>',\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t].join(''),\n\t\t\t\t\tcallback: function($dropdown) {\n\t\t\t\t\t\t$dropdown.find('.note-holder').each(function() {\n\t\t\t\t\t\t\tvar $holder = $(this);\n\t\t\t\t\t\t\t$holder.append(palette({\n\t\t\t\t\t\t\t\tcolors: opt.colors,\n\t\t\t\t\t\t\t\teventName: $holder.data('event')\n\t\t\t\t\t\t\t}).render());\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif(type === 'fore') {\n\t\t\t\t\t\t\t$dropdown.find('.btn-background-color').hide();\n\t\t\t\t\t\t\t$dropdown.css({\n\t\t\t\t\t\t\t\t'min-width': '210px'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if(type === 'back') {\n\t\t\t\t\t\t\t$dropdown.find('.btn-foreground-color').hide();\n\t\t\t\t\t\t\t$dropdown.css({\n\t\t\t\t\t\t\t\t'min-width': '210px'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tclick: function(event) {\n\t\t\t\t\t\tvar $button = $(event.target);\n\t\t\t\t\t\tvar eventName = $button.data('event');\n\t\t\t\t\t\tvar value = $button.data('value');\n\n\t\t\t\t\t\tif(eventName && value) {\n\t\t\t\t\t\t\tvar key = eventName === 'backColor' ? 'background-color' : 'color';\n\t\t\t\t\t\t\tvar $color = $button.closest('.note-color').find('.note-recent-color');\n\t\t\t\t\t\t\tvar $currentButton = $button.closest('.note-color').find('.note-current-color-button');\n\n\t\t\t\t\t\t\t$color.css(key, value);\n\t\t\t\t\t\t\t$currentButton.attr('data-' + eventName, value);\n\n\t\t\t\t\t\t\tif(type === 'fore') {\n\t\t\t\t\t\t\t\topt.itemClick('foreColor', value);\n\t\t\t\t\t\t\t} else if(type === 'back') {\n\t\t\t\t\t\t\t\topt.itemClick('backColor', value);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\topt.itemClick(eventName, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t}).render();\n\t};\n\n\tvar dialog = renderer.create('<div class=\"note-modal\" tabindex=\"-1\"/>', function($node, options) {\n\t\tif(options.fade) {\n\t\t\t$node.addClass('fade');\n\t\t}\n\t\t$node.html([\n\t\t\t'  <div class=\"note-modal-content\">',\n\t\t\t(options.title ?\n\t\t\t\t'    <div class=\"note-modal-header\">' +\n\t\t\t\t'      <button type=\"button\" class=\"close\"><i class=\"note-icon-close\"></i></button>' +\n\t\t\t\t'      <h4 class=\"note-modal-title\">' + options.title + '</h4>' +\n\t\t\t\t'    </div>' : ''\n\t\t\t),\n\t\t\t'    <div class=\"note-modal-body\">' + options.body + '</div>',\n\t\t\t(options.footer ?\n\t\t\t\t'    <div class=\"note-modal-footer\">' + options.footer + '</div>' : ''\n\t\t\t),\n\t\t\t'  </div>'\n\t\t].join(''));\n\n\t\t$node.data('modal', ModalUI.create($node, options));\n\t});\n\n\tvar videoDialog = function(opt) {\n\n\t\tvar body = '<div class=\"note-form-group\">' +\n\t\t\t'<label class=\"note-form-label\">' +\n\t\t\topt.lang.video.url + ' <small class=\"text-muted\">' +\n\t\t\topt.lang.video.providers + '</small>' +\n\t\t\t'</label>' +\n\t\t\t'<input class=\"note-video-url note-input\" type=\"text\" />' +\n\t\t\t'</div>';\n\t\tvar footer = [\n\t\t\t'<button type=\"button\" href=\"#\" class=\"note-btn note-btn-primary note-video-btn disabled\" disabled>',\n\t\t\topt.lang.video.insert,\n\t\t\t'</button>'\n\t\t].join('');\n\n\t\treturn dialog({\n\t\t\ttitle: opt.lang.video.insert,\n\t\t\tfade: opt.fade,\n\t\t\tbody: body,\n\t\t\tfooter: footer\n\t\t}).render();\n\t};\n\n\t// 图片上传加入链接地址， update by yujinjin TODO: yujinjin 需要优化，\n\tvar imageDialog = function(opt) {\n\t\tvar body = '<div class=\"note-form-group\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.link.url + '</label>' +\n\t\t\t'<input class=\"note-link-url note-input\" type=\"text\" value=\"http://\" />' +\n\t\t\t'</div>' + '<div class=\"note-form-group note-group-select-from-files\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.image.selectFromFiles + '</label>' +\n\t\t\t'<span style=\"color: red; font-size: 12px; font-weight: 600;\">如果需要加入图片链接请先输入图片链接地址</span>' +\n\t\t\t'<input class=\"note-image-input note-input\" type=\"file\" name=\"files\" accept=\"image/gif, image/jpeg, image/png\" multiple=\"multiple\" />' +\n\t\t\topt.imageLimitation +\n\t\t\t'</div>' +\n\t\t\t'<div class=\"note-form-group\" style=\"overflow:auto;\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.image.url + '</label>' +\n\t\t\t'<input class=\"note-image-url note-input\" type=\"text\" />' +\n\t\t\t(!opt.disableLinkTarget ?\n\t\t\t\t'<div class=\"checkbox\">' +\n\t\t\t\t'<label>' + '<input type=\"checkbox\"> ' + opt.lang.link.openInNewWindow + '</label>' +\n\t\t\t\t'</div>' : ''\n\t\t\t);\n\t\tvar footer = [\n\t\t\t'<button href=\"#\" type=\"button\" class=\"note-btn note-btn-primary note-btn-large note-image-btn disabled\" disabled>',\n\t\t\topt.lang.image.insert,\n\t\t\t'</button>'\n\t\t].join('');\n\n\t\treturn dialog({\n\t\t\ttitle: opt.lang.image.insert,\n\t\t\tfade: opt.fade,\n\t\t\tbody: body,\n\t\t\tfooter: footer\n\t\t}).render();\n\t};\n\n\tvar linkDialog = function(opt) {\n\t\tvar body = '<div class=\"note-form-group\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.link.textToDisplay + '</label>' +\n\t\t\t'<input class=\"note-link-text note-input\" type=\"text\" />' +\n\t\t\t'</div>' +\n\t\t\t'<div class=\"note-form-group\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.link.url + '</label>' +\n\t\t\t'<input class=\"note-link-url note-input\" type=\"text\" value=\"http://\" />' +\n\t\t\t'</div>' +\n\t\t\t(!opt.disableLinkTarget ?\n\t\t\t\t'<div class=\"checkbox\">' +\n\t\t\t\t'<label>' + '<input type=\"checkbox\" checked> ' + opt.lang.link.openInNewWindow + '</label>' +\n\t\t\t\t'</div>' : ''\n\t\t\t);\n\t\tvar footer = [\n\t\t\t'<button href=\"#\" type=\"button\" class=\"note-btn note-btn-primary note-link-btn disabled\" disabled>',\n\t\t\topt.lang.link.insert,\n\t\t\t'</button>'\n\t\t].join('');\n\n\t\treturn dialog({\n\t\t\tclassName: 'link-dialog',\n\t\t\ttitle: opt.lang.link.insert,\n\t\t\tfade: opt.fade,\n\t\t\tbody: body,\n\t\t\tfooter: footer\n\t\t}).render();\n\t};\n\t\n\t// update by yujinjin 图片链接Dialog\n\tvar linkImgDialog = function(opt) {\n\t\tvar body = '<div class=\"note-form-group\">' +\n\t\t\t'<label class=\"note-form-label\">' + opt.lang.link.url + '</label>' +\n\t\t\t'<input class=\"note-link-url note-input\" type=\"text\" value=\"http://\" />' +\n\t\t\t'</div>' +\n\t\t\t(!opt.disableLinkTarget ?\n\t\t\t\t'<div class=\"checkbox\">' +\n\t\t\t\t'<label>' + '<input type=\"checkbox\" checked> ' + opt.lang.link.openInNewWindow + '</label>' +\n\t\t\t\t'</div>' : ''\n\t\t\t);\n\t\tvar footer = [\n\t\t\t'<button href=\"#\" type=\"button\" class=\"note-btn note-btn-primary note-link-btn disabled\" disabled>',\n\t\t\topt.lang.link.insert,\n\t\t\t'</button>'\n\t\t].join('');\n\n\t\treturn dialog({\n\t\t\tclassName: 'link-dialog',\n\t\t\ttitle: opt.lang.link.insert,\n\t\t\tfade: opt.fade,\n\t\t\tbody: body,\n\t\t\tfooter: footer\n\t\t}).render();\n\t}\n\n\tvar popover = renderer.create([\n\t\t'<div class=\"note-popover bottom\">',\n\t\t'  <div class=\"note-popover-arrow\"/>',\n\t\t'  <div class=\"note-popover-content note-children-container\"/>',\n\t\t'</div>'\n\t].join(''), function($node, options) {\n\t\tvar direction = typeof options.direction !== 'undefined' ? options.direction : 'bottom';\n\n\t\t$node.addClass(direction).hide();\n\n\t\tif(options.hideArrow) {\n\t\t\t$node.find('.note-popover-arrow').hide();\n\t\t}\n\t});\n\n\tvar icon = function(iconClassName, tagName) {\n\t\ttagName = tagName || 'i';\n\t\treturn '<' + tagName + ' class=\"' + iconClassName + '\"/>';\n\t};\n\n\tvar ui = {\n\t\teditor: editor,\n\t\ttoolbar: toolbar,\n\t\teditingArea: editingArea,\n\t\tcodable: codable,\n\t\teditable: editable,\n\t\tstatusbar: statusbar,\n\t\tairEditor: airEditor,\n\t\tairEditable: airEditable,\n\t\tbuttonGroup: buttonGroup,\n\t\tbutton: button,\n\t\tdropdown: dropdown,\n\t\tdropdownCheck: dropdownCheck,\n\t\tdropdownButton: dropdownButton,\n\t\tdropdownCheckButton: dropdownCheckButton,\n\t\tparagraphDropdownButton: paragraphDropdownButton,\n\t\ttableDropdownButton: tableDropdownButton,\n\t\tcolorDropdownButton: colorDropdownButton,\n\t\tpalette: palette,\n\t\tdialog: dialog,\n\t\tvideoDialog: videoDialog,\n\t\timageDialog: imageDialog,\n\t\tlinkDialog: linkDialog,\n\t\tlinkImgDialog: linkImgDialog, // update by yujinjin 图片链接Dialog UI\n\t\tpopover: popover,\n\t\ticon: icon,\n\n\t\ttoggleBtn: function($btn, isEnable) {\n\t\t\t$btn.toggleClass('disabled', !isEnable);\n\t\t\t$btn.attr('disabled', !isEnable);\n\t\t},\n\n\t\ttoggleBtnActive: function($btn, isActive) {\n\t\t\t$btn.toggleClass('active', isActive);\n\t\t},\n\n\t\tcheck: function($dom, value) {\n\t\t\t$dom.find('.checked').removeClass('checked');\n\t\t\t$dom.find('[data-value=\"' + value + '\"]').addClass('checked');\n\t\t},\n\n\t\tonDialogShown: function($dialog, handler) {\n\t\t\t$dialog.one('note.modal.show', handler);\n\t\t},\n\n\t\tonDialogHidden: function($dialog, handler) {\n\t\t\t$dialog.one('note.modal.hide', handler);\n\t\t},\n\n\t\tshowDialog: function($dialog) {\n\t\t\t$dialog.data('modal').show();\n\t\t},\n\n\t\thideDialog: function($dialog) {\n\t\t\t$dialog.data('modal').hide();\n\t\t},\n\n\t\t/**\n\t\t * get popover content area\n\t\t *\n\t\t * @param $popover\n\t\t * @returns {*}\n\t\t */\n\t\tgetPopoverContent: function($popover) {\n\t\t\treturn $popover.find('.note-popover-content');\n\t\t},\n\n\t\t/**\n\t\t * get dialog's body area\n\t\t *\n\t\t * @param $dialog\n\t\t * @returns {*}\n\t\t */\n\t\tgetDialogBody: function($dialog) {\n\t\t\treturn $dialog.find('.note-modal-body');\n\t\t},\n\n\t\tcreateLayout: function($note, options) {\n\t\t\tvar $editor = (options.airMode ? ui.airEditor([\n\t\t\t\tui.editingArea([\n\t\t\t\t\tui.airEditable()\n\t\t\t\t])\n\t\t\t]) : ui.editor([\n\t\t\t\tui.toolbar(),\n\t\t\t\tui.editingArea([\n\t\t\t\t\tui.codable(),\n\t\t\t\t\tui.editable()\n\t\t\t\t]),\n\t\t\t\tui.statusbar()\n\t\t\t])).render();\n\n\t\t\t$editor.insertAfter($note);\n\n\t\t\treturn {\n\t\t\t\tnote: $note,\n\t\t\t\teditor: $editor,\n\t\t\t\ttoolbar: $editor.find('.note-toolbar'),\n\t\t\t\teditingArea: $editor.find('.note-editing-area'),\n\t\t\t\teditable: $editor.find('.note-editable'),\n\t\t\t\tcodable: $editor.find('.note-codable'),\n\t\t\t\tstatusbar: $editor.find('.note-statusbar')\n\t\t\t};\n\t\t},\n\n\t\tremoveLayout: function($note, layoutInfo) {\n\t\t\t$note.html(layoutInfo.editable.html());\n\t\t\tlayoutInfo.editor.remove();\n\t\t\t$note.off('summernote'); // remove summernote custom event\n\t\t\t$note.show();\n\t\t}\n\t};\n\n\t$.summernote = $.summernote || {\n\t\tlang: {}\n\t};\n\n\t$.extend($.summernote.lang, {\n\t\t'en-US': {\n\t\t\tfont: {\n\t\t\t\tbold: 'Bold',\n\t\t\t\titalic: 'Italic',\n\t\t\t\tunderline: 'Underline',\n\t\t\t\tclear: 'Remove Font Style',\n\t\t\t\theight: 'Line Height',\n\t\t\t\tname: 'Font Family',\n\t\t\t\tstrikethrough: 'Strikethrough',\n\t\t\t\tsubscript: 'Subscript',\n\t\t\t\tsuperscript: 'Superscript',\n\t\t\t\tsize: 'Font Size'\n\t\t\t},\n\t\t\timage: {\n\t\t\t\timage: 'Picture',\n\t\t\t\tinsert: 'Insert Image',\n\t\t\t\tresizeFull: 'Resize Full',\n\t\t\t\tresizeHalf: 'Resize Half',\n\t\t\t\tresizeQuarter: 'Resize Quarter',\n\t\t\t\tfloatLeft: 'Float Left',\n\t\t\t\tfloatRight: 'Float Right',\n\t\t\t\tfloatNone: 'Float None',\n\t\t\t\tshapeRounded: 'Shape: Rounded',\n\t\t\t\tshapeCircle: 'Shape: Circle',\n\t\t\t\tshapeThumbnail: 'Shape: Thumbnail',\n\t\t\t\tshapeNone: 'Shape: None',\n\t\t\t\tdragImageHere: 'Drag image or text here',\n\t\t\t\tdropImage: 'Drop image or Text',\n\t\t\t\tselectFromFiles: 'Select from files',\n\t\t\t\tmaximumFileSize: 'Maximum file size',\n\t\t\t\tmaximumFileSizeError: 'Maximum file size exceeded.',\n\t\t\t\turl: 'Image URL',\n\t\t\t\tremove: 'Remove Image'\n\t\t\t},\n\t\t\tvideo: {\n\t\t\t\tvideo: 'Video',\n\t\t\t\tvideoLink: 'Video Link',\n\t\t\t\tinsert: 'Insert Video',\n\t\t\t\turl: 'Video URL?',\n\t\t\t\tproviders: '(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)'\n\t\t\t},\n\t\t\tlink: {\n\t\t\t\tlink: 'Link',\n\t\t\t\tinsert: 'Insert Link',\n\t\t\t\tunlink: 'Unlink',\n\t\t\t\tedit: 'Edit',\n\t\t\t\ttextToDisplay: 'Text to display',\n\t\t\t\turl: 'To what URL should this link go?',\n\t\t\t\topenInNewWindow: 'Open in new window'\n\t\t\t},\n\t\t\ttable: {\n\t\t\t\ttable: 'Table'\n\t\t\t},\n\t\t\thr: {\n\t\t\t\tinsert: 'Insert Horizontal Rule'\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tstyle: 'Style',\n\t\t\t\tnormal: 'Normal',\n\t\t\t\tblockquote: 'Quote',\n\t\t\t\tpre: 'Code',\n\t\t\t\th1: 'Header 1',\n\t\t\t\th2: 'Header 2',\n\t\t\t\th3: 'Header 3',\n\t\t\t\th4: 'Header 4',\n\t\t\t\th5: 'Header 5',\n\t\t\t\th6: 'Header 6'\n\t\t\t},\n\t\t\tlists: {\n\t\t\t\tunordered: 'Unordered list',\n\t\t\t\tordered: 'Ordered list'\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\thelp: 'Help',\n\t\t\t\tfullscreen: 'Full Screen',\n\t\t\t\tcodeview: 'Code View'\n\t\t\t},\n\t\t\tparagraph: {\n\t\t\t\tparagraph: 'Paragraph',\n\t\t\t\toutdent: 'Outdent',\n\t\t\t\tindent: 'Indent',\n\t\t\t\tleft: 'Align left',\n\t\t\t\tcenter: 'Align center',\n\t\t\t\tright: 'Align right',\n\t\t\t\tjustify: 'Justify full'\n\t\t\t},\n\t\t\tcolor: {\n\t\t\t\trecent: 'Recent Color',\n\t\t\t\tmore: 'More Color',\n\t\t\t\tbackground: 'Background Color',\n\t\t\t\tforeground: 'Foreground Color',\n\t\t\t\ttransparent: 'Transparent',\n\t\t\t\tsetTransparent: 'Set transparent',\n\t\t\t\treset: 'Reset',\n\t\t\t\tresetToDefault: 'Reset to default'\n\t\t\t},\n\t\t\tshortcut: {\n\t\t\t\tshortcuts: 'Keyboard shortcuts',\n\t\t\t\tclose: 'Close',\n\t\t\t\ttextFormatting: 'Text formatting',\n\t\t\t\taction: 'Action',\n\t\t\t\tparagraphFormatting: 'Paragraph formatting',\n\t\t\t\tdocumentStyle: 'Document Style',\n\t\t\t\textraKeys: 'Extra keys'\n\t\t\t},\n\t\t\thelp: {\n\t\t\t\t'insertParagraph': 'Insert Paragraph',\n\t\t\t\t'undo': 'Undoes the last command',\n\t\t\t\t'redo': 'Redoes the last command',\n\t\t\t\t'tab': 'Tab',\n\t\t\t\t'untab': 'Untab',\n\t\t\t\t'bold': 'Set a bold style',\n\t\t\t\t'italic': 'Set a italic style',\n\t\t\t\t'underline': 'Set a underline style',\n\t\t\t\t'strikethrough': 'Set a strikethrough style',\n\t\t\t\t'removeFormat': 'Clean a style',\n\t\t\t\t'justifyLeft': 'Set left align',\n\t\t\t\t'justifyCenter': 'Set center align',\n\t\t\t\t'justifyRight': 'Set right align',\n\t\t\t\t'justifyFull': 'Set full align',\n\t\t\t\t'insertUnorderedList': 'Toggle unordered list',\n\t\t\t\t'insertOrderedList': 'Toggle ordered list',\n\t\t\t\t'outdent': 'Outdent on current paragraph',\n\t\t\t\t'indent': 'Indent on current paragraph',\n\t\t\t\t'formatPara': 'Change current block\\'s format as a paragraph(P tag)',\n\t\t\t\t'formatH1': 'Change current block\\'s format as H1',\n\t\t\t\t'formatH2': 'Change current block\\'s format as H2',\n\t\t\t\t'formatH3': 'Change current block\\'s format as H3',\n\t\t\t\t'formatH4': 'Change current block\\'s format as H4',\n\t\t\t\t'formatH5': 'Change current block\\'s format as H5',\n\t\t\t\t'formatH6': 'Change current block\\'s format as H6',\n\t\t\t\t'insertHorizontalRule': 'Insert horizontal rule',\n\t\t\t\t'linkDialog.show': 'Show Link Dialog'\n\t\t\t},\n\t\t\thistory: {\n\t\t\t\tundo: 'Undo',\n\t\t\t\tredo: 'Redo'\n\t\t\t},\n\t\t\tspecialChar: {\n\t\t\t\tspecialChar: 'SPECIAL CHARACTERS',\n\t\t\t\tselect: 'Select Special characters'\n\t\t\t}\n\t\t}\n\t});\n\n\t/**\n\t * @class core.key\n\t *\n\t * Object for keycodes.\n\t *\n\t * @singleton\n\t * @alternateClassName key\n\t */\n\tvar key = (function() {\n\t\tvar keyMap = {\n\t\t\t'BACKSPACE': 8,\n\t\t\t'TAB': 9,\n\t\t\t'ENTER': 13,\n\t\t\t'SPACE': 32,\n\n\t\t\t// Arrow\n\t\t\t'LEFT': 37,\n\t\t\t'UP': 38,\n\t\t\t'RIGHT': 39,\n\t\t\t'DOWN': 40,\n\n\t\t\t// Number: 0-9\n\t\t\t'NUM0': 48,\n\t\t\t'NUM1': 49,\n\t\t\t'NUM2': 50,\n\t\t\t'NUM3': 51,\n\t\t\t'NUM4': 52,\n\t\t\t'NUM5': 53,\n\t\t\t'NUM6': 54,\n\t\t\t'NUM7': 55,\n\t\t\t'NUM8': 56,\n\n\t\t\t// Alphabet: a-z\n\t\t\t'B': 66,\n\t\t\t'E': 69,\n\t\t\t'I': 73,\n\t\t\t'J': 74,\n\t\t\t'K': 75,\n\t\t\t'L': 76,\n\t\t\t'R': 82,\n\t\t\t'S': 83,\n\t\t\t'U': 85,\n\t\t\t'V': 86,\n\t\t\t'Y': 89,\n\t\t\t'Z': 90,\n\n\t\t\t'SLASH': 191,\n\t\t\t'LEFTBRACKET': 219,\n\t\t\t'BACKSLASH': 220,\n\t\t\t'RIGHTBRACKET': 221\n\t\t};\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * @method isEdit\n\t\t\t *\n\t\t\t * @param {Number} keyCode\n\t\t\t * @return {Boolean}\n\t\t\t */\n\t\t\tisEdit: function(keyCode) {\n\t\t\t\treturn list.contains([\n\t\t\t\t\tkeyMap.BACKSPACE,\n\t\t\t\t\tkeyMap.TAB,\n\t\t\t\t\tkeyMap.ENTER,\n\t\t\t\t\tkeyMap.SPACE\n\t\t\t\t], keyCode);\n\t\t\t},\n\t\t\t/**\n\t\t\t * @method isMove\n\t\t\t *\n\t\t\t * @param {Number} keyCode\n\t\t\t * @return {Boolean}\n\t\t\t */\n\t\t\tisMove: function(keyCode) {\n\t\t\t\treturn list.contains([\n\t\t\t\t\tkeyMap.LEFT,\n\t\t\t\t\tkeyMap.UP,\n\t\t\t\t\tkeyMap.RIGHT,\n\t\t\t\t\tkeyMap.DOWN\n\t\t\t\t], keyCode);\n\t\t\t},\n\t\t\t/**\n\t\t\t * @property {Object} nameFromCode\n\t\t\t * @property {String} nameFromCode.8 \"BACKSPACE\"\n\t\t\t */\n\t\t\tnameFromCode: func.invertObject(keyMap),\n\t\t\tcode: keyMap\n\t\t};\n\t})();\n\n\tvar range = (function() {\n\n\t\t/**\n\t\t * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\n\t\t *\n\t\t * @param {TextRange} textRange\n\t\t * @param {Boolean} isStart\n\t\t * @return {BoundaryPoint}\n\t\t *\n\t\t * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\n\t\t */\n\t\tvar textRangeToPoint = function(textRange, isStart) {\n\t\t\tvar container = textRange.parentElement(),\n\t\t\t\toffset;\n\n\t\t\tvar tester = document.body.createTextRange(),\n\t\t\t\tprevContainer;\n\t\t\tvar childNodes = list.from(container.childNodes);\n\t\t\tfor(offset = 0; offset < childNodes.length; offset++) {\n\t\t\t\tif(dom.isText(childNodes[offset])) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttester.moveToElementText(childNodes[offset]);\n\t\t\t\tif(tester.compareEndPoints('StartToStart', textRange) >= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tprevContainer = childNodes[offset];\n\t\t\t}\n\n\t\t\tif(offset !== 0 && dom.isText(childNodes[offset - 1])) {\n\t\t\t\tvar textRangeStart = document.body.createTextRange(),\n\t\t\t\t\tcurTextNode = null;\n\t\t\t\ttextRangeStart.moveToElementText(prevContainer || container);\n\t\t\t\ttextRangeStart.collapse(!prevContainer);\n\t\t\t\tcurTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;\n\n\t\t\t\tvar pointTester = textRange.duplicate();\n\t\t\t\tpointTester.setEndPoint('StartToStart', textRangeStart);\n\t\t\t\tvar textCount = pointTester.text.replace(/[\\r\\n]/g, '').length;\n\n\t\t\t\twhile(textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {\n\t\t\t\t\ttextCount -= curTextNode.nodeValue.length;\n\t\t\t\t\tcurTextNode = curTextNode.nextSibling;\n\t\t\t\t}\n\n\t\t\t\t/* jshint ignore:start */\n\t\t\t\tvar dummy = curTextNode.nodeValue; // enforce IE to re-reference curTextNode, hack\n\t\t\t\t/* jshint ignore:end */\n\n\t\t\t\tif(isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) &&\n\t\t\t\t\ttextCount === curTextNode.nodeValue.length) {\n\t\t\t\t\ttextCount -= curTextNode.nodeValue.length;\n\t\t\t\t\tcurTextNode = curTextNode.nextSibling;\n\t\t\t\t}\n\n\t\t\t\tcontainer = curTextNode;\n\t\t\t\toffset = textCount;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcont: container,\n\t\t\t\toffset: offset\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * return TextRange from boundary point (inspired by google closure-library)\n\t\t * @param {BoundaryPoint} point\n\t\t * @return {TextRange}\n\t\t */\n\t\tvar pointToTextRange = function(point) {\n\t\t\tvar textRangeInfo = function(container, offset) {\n\t\t\t\tvar node, isCollapseToStart;\n\n\t\t\t\tif(dom.isText(container)) {\n\t\t\t\t\tvar prevTextNodes = dom.listPrev(container, func.not(dom.isText));\n\t\t\t\t\tvar prevContainer = list.last(prevTextNodes).previousSibling;\n\t\t\t\t\tnode = prevContainer || container.parentNode;\n\t\t\t\t\toffset += list.sum(list.tail(prevTextNodes), dom.nodeLength);\n\t\t\t\t\tisCollapseToStart = !prevContainer;\n\t\t\t\t} else {\n\t\t\t\t\tnode = container.childNodes[offset] || container;\n\t\t\t\t\tif(dom.isText(node)) {\n\t\t\t\t\t\treturn textRangeInfo(node, 0);\n\t\t\t\t\t}\n\n\t\t\t\t\toffset = 0;\n\t\t\t\t\tisCollapseToStart = false;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tnode: node,\n\t\t\t\t\tcollapseToStart: isCollapseToStart,\n\t\t\t\t\toffset: offset\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tvar textRange = document.body.createTextRange();\n\t\t\tvar info = textRangeInfo(point.node, point.offset);\n\n\t\t\ttextRange.moveToElementText(info.node);\n\t\t\ttextRange.collapse(info.collapseToStart);\n\t\t\ttextRange.moveStart('character', info.offset);\n\t\t\treturn textRange;\n\t\t};\n\n\t\t/**\n\t\t * Wrapped Range\n\t\t *\n\t\t * @constructor\n\t\t * @param {Node} sc - start container\n\t\t * @param {Number} so - start offset\n\t\t * @param {Node} ec - end container\n\t\t * @param {Number} eo - end offset\n\t\t */\n\t\tvar WrappedRange = function(sc, so, ec, eo) {\n\t\t\tthis.sc = sc;\n\t\t\tthis.so = so;\n\t\t\tthis.ec = ec;\n\t\t\tthis.eo = eo;\n\n\t\t\t// nativeRange: get nativeRange from sc, so, ec, eo\n\t\t\tvar nativeRange = function() {\n\t\t\t\tif(agent.isW3CRangeSupport) {\n\t\t\t\t\tvar w3cRange = document.createRange();\n\t\t\t\t\tw3cRange.setStart(sc, so);\n\t\t\t\t\tw3cRange.setEnd(ec, eo);\n\n\t\t\t\t\treturn w3cRange;\n\t\t\t\t} else {\n\t\t\t\t\tvar textRange = pointToTextRange({\n\t\t\t\t\t\tnode: sc,\n\t\t\t\t\t\toffset: so\n\t\t\t\t\t});\n\n\t\t\t\t\ttextRange.setEndPoint('EndToEnd', pointToTextRange({\n\t\t\t\t\t\tnode: ec,\n\t\t\t\t\t\toffset: eo\n\t\t\t\t\t}));\n\n\t\t\t\t\treturn textRange;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.getPoints = function() {\n\t\t\t\treturn {\n\t\t\t\t\tsc: sc,\n\t\t\t\t\tso: so,\n\t\t\t\t\tec: ec,\n\t\t\t\t\teo: eo\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tthis.getStartPoint = function() {\n\t\t\t\treturn {\n\t\t\t\t\tnode: sc,\n\t\t\t\t\toffset: so\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tthis.getEndPoint = function() {\n\t\t\t\treturn {\n\t\t\t\t\tnode: ec,\n\t\t\t\t\toffset: eo\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * select update visible range\n\t\t\t */\n\t\t\tthis.select = function() {\n\t\t\t\tvar nativeRng = nativeRange();\n\t\t\t\tif(agent.isW3CRangeSupport) {\n\t\t\t\t\tvar selection = document.getSelection();\n\t\t\t\t\tif(selection.rangeCount > 0) {\n\t\t\t\t\t\tselection.removeAllRanges();\n\t\t\t\t\t}\n\t\t\t\t\tselection.addRange(nativeRng);\n\t\t\t\t} else {\n\t\t\t\t\tnativeRng.select();\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Moves the scrollbar to start container(sc) of current range\n\t\t\t *\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.scrollIntoView = function(container) {\n\t\t\t\tvar height = $(container).height();\n\t\t\t\tif(container.scrollTop + height < this.sc.offsetTop) {\n\t\t\t\t\tcontainer.scrollTop += Math.abs(container.scrollTop + height - this.sc.offsetTop);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.normalize = function() {\n\n\t\t\t\t/**\n\t\t\t\t * @param {BoundaryPoint} point\n\t\t\t\t * @param {Boolean} isLeftToRight\n\t\t\t\t * @return {BoundaryPoint}\n\t\t\t\t */\n\t\t\t\tvar getVisiblePoint = function(point, isLeftToRight) {\n\t\t\t\t\tif((dom.isVisiblePoint(point) && !dom.isEdgePoint(point)) ||\n\t\t\t\t\t\t(dom.isVisiblePoint(point) && dom.isRightEdgePoint(point) && !isLeftToRight) ||\n\t\t\t\t\t\t(dom.isVisiblePoint(point) && dom.isLeftEdgePoint(point) && isLeftToRight) ||\n\t\t\t\t\t\t(dom.isVisiblePoint(point) && dom.isBlock(point.node) && dom.isEmpty(point.node))) {\n\t\t\t\t\t\treturn point;\n\t\t\t\t\t}\n\n\t\t\t\t\t// point on block's edge\n\t\t\t\t\tvar block = dom.ancestor(point.node, dom.isBlock);\n\t\t\t\t\tif(((dom.isLeftEdgePointOf(point, block) || dom.isVoid(dom.prevPoint(point).node)) && !isLeftToRight) ||\n\t\t\t\t\t\t((dom.isRightEdgePointOf(point, block) || dom.isVoid(dom.nextPoint(point).node)) && isLeftToRight)) {\n\n\t\t\t\t\t\t// returns point already on visible point\n\t\t\t\t\t\tif(dom.isVisiblePoint(point)) {\n\t\t\t\t\t\t\treturn point;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// reverse direction \n\t\t\t\t\t\tisLeftToRight = !isLeftToRight;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint) :\n\t\t\t\t\t\tdom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);\n\t\t\t\t\treturn nextPoint || point;\n\t\t\t\t};\n\n\t\t\t\tvar endPoint = getVisiblePoint(this.getEndPoint(), false);\n\t\t\t\tvar startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);\n\n\t\t\t\treturn new WrappedRange(\n\t\t\t\t\tstartPoint.node,\n\t\t\t\t\tstartPoint.offset,\n\t\t\t\t\tendPoint.node,\n\t\t\t\t\tendPoint.offset\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns matched nodes on range\n\t\t\t *\n\t\t\t * @param {Function} [pred] - predicate function\n\t\t\t * @param {Object} [options]\n\t\t\t * @param {Boolean} [options.includeAncestor]\n\t\t\t * @param {Boolean} [options.fullyContains]\n\t\t\t * @return {Node[]}\n\t\t\t */\n\t\t\tthis.nodes = function(pred, options) {\n\t\t\t\tpred = pred || func.ok;\n\n\t\t\t\tvar includeAncestor = options && options.includeAncestor;\n\t\t\t\tvar fullyContains = options && options.fullyContains;\n\n\t\t\t\t// TODO compare points and sort\n\t\t\t\tvar startPoint = this.getStartPoint();\n\t\t\t\tvar endPoint = this.getEndPoint();\n\n\t\t\t\tvar nodes = [];\n\t\t\t\tvar leftEdgeNodes = [];\n\n\t\t\t\tdom.walkPoint(startPoint, endPoint, function(point) {\n\t\t\t\t\tif(dom.isEditable(point.node)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar node;\n\t\t\t\t\tif(fullyContains) {\n\t\t\t\t\t\tif(dom.isLeftEdgePoint(point)) {\n\t\t\t\t\t\t\tleftEdgeNodes.push(point.node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(dom.isRightEdgePoint(point) && list.contains(leftEdgeNodes, point.node)) {\n\t\t\t\t\t\t\tnode = point.node;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if(includeAncestor) {\n\t\t\t\t\t\tnode = dom.ancestor(point.node, pred);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnode = point.node;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(node && pred(node)) {\n\t\t\t\t\t\tnodes.push(node);\n\t\t\t\t\t}\n\t\t\t\t}, true);\n\n\t\t\t\treturn list.unique(nodes);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns commonAncestor of range\n\t\t\t * @return {Element} - commonAncestor\n\t\t\t */\n\t\t\tthis.commonAncestor = function() {\n\t\t\t\treturn dom.commonAncestor(sc, ec);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns expanded range by pred\n\t\t\t *\n\t\t\t * @param {Function} pred - predicate function\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.expand = function(pred) {\n\t\t\t\tvar startAncestor = dom.ancestor(sc, pred);\n\t\t\t\tvar endAncestor = dom.ancestor(ec, pred);\n\n\t\t\t\tif(!startAncestor && !endAncestor) {\n\t\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t\t}\n\n\t\t\t\tvar boundaryPoints = this.getPoints();\n\n\t\t\t\tif(startAncestor) {\n\t\t\t\t\tboundaryPoints.sc = startAncestor;\n\t\t\t\t\tboundaryPoints.so = 0;\n\t\t\t\t}\n\n\t\t\t\tif(endAncestor) {\n\t\t\t\t\tboundaryPoints.ec = endAncestor;\n\t\t\t\t\tboundaryPoints.eo = dom.nodeLength(endAncestor);\n\t\t\t\t}\n\n\t\t\t\treturn new WrappedRange(\n\t\t\t\t\tboundaryPoints.sc,\n\t\t\t\t\tboundaryPoints.so,\n\t\t\t\t\tboundaryPoints.ec,\n\t\t\t\t\tboundaryPoints.eo\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * @param {Boolean} isCollapseToStart\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.collapse = function(isCollapseToStart) {\n\t\t\t\tif(isCollapseToStart) {\n\t\t\t\t\treturn new WrappedRange(sc, so, sc, so);\n\t\t\t\t} else {\n\t\t\t\t\treturn new WrappedRange(ec, eo, ec, eo);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * splitText on range\n\t\t\t */\n\t\t\tthis.splitText = function() {\n\t\t\t\tvar isSameContainer = sc === ec;\n\t\t\t\tvar boundaryPoints = this.getPoints();\n\n\t\t\t\tif(dom.isText(ec) && !dom.isEdgePoint(this.getEndPoint())) {\n\t\t\t\t\tec.splitText(eo);\n\t\t\t\t}\n\n\t\t\t\tif(dom.isText(sc) && !dom.isEdgePoint(this.getStartPoint())) {\n\t\t\t\t\tboundaryPoints.sc = sc.splitText(so);\n\t\t\t\t\tboundaryPoints.so = 0;\n\n\t\t\t\t\tif(isSameContainer) {\n\t\t\t\t\t\tboundaryPoints.ec = boundaryPoints.sc;\n\t\t\t\t\t\tboundaryPoints.eo = eo - so;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn new WrappedRange(\n\t\t\t\t\tboundaryPoints.sc,\n\t\t\t\t\tboundaryPoints.so,\n\t\t\t\t\tboundaryPoints.ec,\n\t\t\t\t\tboundaryPoints.eo\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * delete contents on range\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.deleteContents = function() {\n\t\t\t\tif(this.isCollapsed()) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tvar rng = this.splitText();\n\t\t\t\tvar nodes = rng.nodes(null, {\n\t\t\t\t\tfullyContains: true\n\t\t\t\t});\n\n\t\t\t\t// find new cursor point\n\t\t\t\tvar point = dom.prevPointUntil(rng.getStartPoint(), function(point) {\n\t\t\t\t\treturn !list.contains(nodes, point.node);\n\t\t\t\t});\n\n\t\t\t\tvar emptyParents = [];\n\t\t\t\t$.each(nodes, function(idx, node) {\n\t\t\t\t\t// find empty parents\n\t\t\t\t\tvar parent = node.parentNode;\n\t\t\t\t\tif(point.node !== parent && dom.nodeLength(parent) === 1) {\n\t\t\t\t\t\temptyParents.push(parent);\n\t\t\t\t\t}\n\t\t\t\t\tdom.remove(node, false);\n\t\t\t\t});\n\n\t\t\t\t// remove empty parents\n\t\t\t\t$.each(emptyParents, function(idx, node) {\n\t\t\t\t\tdom.remove(node, false);\n\t\t\t\t});\n\n\t\t\t\treturn new WrappedRange(\n\t\t\t\t\tpoint.node,\n\t\t\t\t\tpoint.offset,\n\t\t\t\t\tpoint.node,\n\t\t\t\t\tpoint.offset\n\t\t\t\t).normalize();\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * makeIsOn: return isOn(pred) function\n\t\t\t */\n\t\t\tvar makeIsOn = function(pred) {\n\t\t\t\treturn function() {\n\t\t\t\t\tvar ancestor = dom.ancestor(sc, pred);\n\t\t\t\t\treturn !!ancestor && (ancestor === dom.ancestor(ec, pred));\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t// isOnEditable: judge whether range is on editable or not\n\t\t\tthis.isOnEditable = makeIsOn(dom.isEditable);\n\t\t\t// isOnList: judge whether range is on list node or not\n\t\t\tthis.isOnList = makeIsOn(dom.isList);\n\t\t\t// isOnAnchor: judge whether range is on anchor node or not\n\t\t\tthis.isOnAnchor = makeIsOn(dom.isAnchor);\n\t\t\t// isOnAnchor: judge whether range is on cell node or not\n\t\t\tthis.isOnCell = makeIsOn(dom.isCell);\n\n\t\t\t/**\n\t\t\t * @param {Function} pred\n\t\t\t * @return {Boolean}\n\t\t\t */\n\t\t\tthis.isLeftEdgeOf = function(pred) {\n\t\t\t\tif(!dom.isLeftEdgePoint(this.getStartPoint())) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar node = dom.ancestor(this.sc, pred);\n\t\t\t\treturn node && dom.isLeftEdgeOf(this.sc, node);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns whether range was collapsed or not\n\t\t\t */\n\t\t\tthis.isCollapsed = function() {\n\t\t\t\treturn sc === ec && so === eo;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * wrap inline nodes which children of body with paragraph\n\t\t\t *\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.wrapBodyInlineWithPara = function() {\n\t\t\t\tif(dom.isBodyContainer(sc) && dom.isEmpty(sc)) {\n\t\t\t\t\tsc.innerHTML = dom.emptyPara;\n\t\t\t\t\treturn new WrappedRange(sc.firstChild, 0, sc.firstChild, 0);\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * [workaround] firefox often create range on not visible point. so normalize here.\n\t\t\t\t *  - firefox: |<p>text</p>|\n\t\t\t\t *  - chrome: <p>|text|</p>\n\t\t\t\t */\n\t\t\t\tvar rng = this.normalize();\n\t\t\t\tif(dom.isParaInline(sc) || dom.isPara(sc)) {\n\t\t\t\t\treturn rng;\n\t\t\t\t}\n\n\t\t\t\t// find inline top ancestor\n\t\t\t\tvar topAncestor;\n\t\t\t\tif(dom.isInline(rng.sc)) {\n\t\t\t\t\tvar ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));\n\t\t\t\t\ttopAncestor = list.last(ancestors);\n\t\t\t\t\tif(!dom.isInline(topAncestor)) {\n\t\t\t\t\t\ttopAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttopAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];\n\t\t\t\t}\n\n\t\t\t\t// siblings not in paragraph\n\t\t\t\tvar inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();\n\t\t\t\tinlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline));\n\n\t\t\t\t// wrap with paragraph\n\t\t\t\tif(inlineSiblings.length) {\n\t\t\t\t\tvar para = dom.wrap(list.head(inlineSiblings), 'p');\n\t\t\t\t\tdom.appendChildNodes(para, list.tail(inlineSiblings));\n\t\t\t\t}\n\n\t\t\t\treturn this.normalize();\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * insert node at current cursor\n\t\t\t *\n\t\t\t * @param {Node} node\n\t\t\t * @return {Node}\n\t\t\t */\n\t\t\tthis.insertNode = function(node) {\n\t\t\t\tvar rng = this.wrapBodyInlineWithPara().deleteContents();\n\t\t\t\tvar info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));\n\n\t\t\t\tif(info.rightNode) {\n\t\t\t\t\tinfo.rightNode.parentNode.insertBefore(node, info.rightNode);\n\t\t\t\t} else {\n\t\t\t\t\tinfo.container.appendChild(node);\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * insert html at current cursor\n\t\t\t */\n\t\t\tthis.pasteHTML = function(markup) {\n\t\t\t\tvar contentsContainer = $('<div></div>').html(markup)[0];\n\t\t\t\tvar childNodes = list.from(contentsContainer.childNodes);\n\n\t\t\t\tvar rng = this.wrapBodyInlineWithPara().deleteContents();\n\n\t\t\t\treturn childNodes.reverse().map(function(childNode) {\n\t\t\t\t\treturn rng.insertNode(childNode);\n\t\t\t\t}).reverse();\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns text in range\n\t\t\t *\n\t\t\t * @return {String}\n\t\t\t */\n\t\t\tthis.toString = function() {\n\t\t\t\tvar nativeRng = nativeRange();\n\t\t\t\treturn agent.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * returns range for word before cursor\n\t\t\t *\n\t\t\t * @param {Boolean} [findAfter] - find after cursor, default: false\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tthis.getWordRange = function(findAfter) {\n\t\t\t\tvar endPoint = this.getEndPoint();\n\n\t\t\t\tif(!dom.isCharPoint(endPoint)) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tvar startPoint = dom.prevPointUntil(endPoint, function(point) {\n\t\t\t\t\treturn !dom.isCharPoint(point);\n\t\t\t\t});\n\n\t\t\t\tif(findAfter) {\n\t\t\t\t\tendPoint = dom.nextPointUntil(endPoint, function(point) {\n\t\t\t\t\t\treturn !dom.isCharPoint(point);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn new WrappedRange(\n\t\t\t\t\tstartPoint.node,\n\t\t\t\t\tstartPoint.offset,\n\t\t\t\t\tendPoint.node,\n\t\t\t\t\tendPoint.offset\n\t\t\t\t);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * create offsetPath bookmark\n\t\t\t *\n\t\t\t * @param {Node} editable\n\t\t\t */\n\t\t\tthis.bookmark = function(editable) {\n\t\t\t\treturn {\n\t\t\t\t\ts: {\n\t\t\t\t\t\tpath: dom.makeOffsetPath(editable, sc),\n\t\t\t\t\t\toffset: so\n\t\t\t\t\t},\n\t\t\t\t\te: {\n\t\t\t\t\t\tpath: dom.makeOffsetPath(editable, ec),\n\t\t\t\t\t\toffset: eo\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * create offsetPath bookmark base on paragraph\n\t\t\t *\n\t\t\t * @param {Node[]} paras\n\t\t\t */\n\t\t\tthis.paraBookmark = function(paras) {\n\t\t\t\treturn {\n\t\t\t\t\ts: {\n\t\t\t\t\t\tpath: list.tail(dom.makeOffsetPath(list.head(paras), sc)),\n\t\t\t\t\t\toffset: so\n\t\t\t\t\t},\n\t\t\t\t\te: {\n\t\t\t\t\t\tpath: list.tail(dom.makeOffsetPath(list.last(paras), ec)),\n\t\t\t\t\t\toffset: eo\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * getClientRects\n\t\t\t * @return {Rect[]}\n\t\t\t */\n\t\t\tthis.getClientRects = function() {\n\t\t\t\tvar nativeRng = nativeRange();\n\t\t\t\treturn nativeRng.getClientRects();\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * @class core.range\n\t\t *\n\t\t * Data structure\n\t\t *  * BoundaryPoint: a point of dom tree\n\t\t *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\n\t\t *\n\t\t * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\n\t\t *\n\t\t * @singleton\n\t\t * @alternateClassName range\n\t\t */\n\t\treturn {\n\t\t\t/**\n\t\t\t * create Range Object From arguments or Browser Selection\n\t\t\t *\n\t\t\t * @param {Node} sc - start container\n\t\t\t * @param {Number} so - start offset\n\t\t\t * @param {Node} ec - end container\n\t\t\t * @param {Number} eo - end offset\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreate: function(sc, so, ec, eo) {\n\t\t\t\tif(arguments.length === 4) {\n\t\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t\t} else if(arguments.length === 2) { //collapsed\n\t\t\t\t\tec = sc;\n\t\t\t\t\teo = so;\n\t\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t\t} else {\n\t\t\t\t\tvar wrappedRange = this.createFromSelection();\n\t\t\t\t\tif(!wrappedRange && arguments.length === 1) {\n\t\t\t\t\t\twrappedRange = this.createFromNode(arguments[0]);\n\t\t\t\t\t\treturn wrappedRange.collapse(dom.emptyPara === arguments[0].innerHTML);\n\t\t\t\t\t}\n\t\t\t\t\treturn wrappedRange;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcreateFromSelection: function() {\n\t\t\t\tvar sc, so, ec, eo;\n\t\t\t\tif(agent.isW3CRangeSupport) {\n\t\t\t\t\tvar selection = document.getSelection();\n\t\t\t\t\tif(!selection || selection.rangeCount === 0) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} else if(dom.isBody(selection.anchorNode)) {\n\t\t\t\t\t\t// Firefox: returns entire body as range on initialization.\n\t\t\t\t\t\t// We won't never need it.\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar nativeRng = selection.getRangeAt(0);\n\t\t\t\t\tsc = nativeRng.startContainer;\n\t\t\t\t\tso = nativeRng.startOffset;\n\t\t\t\t\tec = nativeRng.endContainer;\n\t\t\t\t\teo = nativeRng.endOffset;\n\t\t\t\t} else { // IE8: TextRange\n\t\t\t\t\tvar textRange = document.selection.createRange();\n\t\t\t\t\tvar textRangeEnd = textRange.duplicate();\n\t\t\t\t\ttextRangeEnd.collapse(false);\n\t\t\t\t\tvar textRangeStart = textRange;\n\t\t\t\t\ttextRangeStart.collapse(true);\n\n\t\t\t\t\tvar startPoint = textRangeToPoint(textRangeStart, true),\n\t\t\t\t\t\tendPoint = textRangeToPoint(textRangeEnd, false);\n\n\t\t\t\t\t// same visible point case: range was collapsed.\n\t\t\t\t\tif(dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) &&\n\t\t\t\t\t\tdom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) &&\n\t\t\t\t\t\tendPoint.node.nextSibling === startPoint.node) {\n\t\t\t\t\t\tstartPoint = endPoint;\n\t\t\t\t\t}\n\n\t\t\t\t\tsc = startPoint.cont;\n\t\t\t\t\tso = startPoint.offset;\n\t\t\t\t\tec = endPoint.cont;\n\t\t\t\t\teo = endPoint.offset;\n\t\t\t\t}\n\n\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @method \n\t\t\t * \n\t\t\t * create WrappedRange from node\n\t\t\t *\n\t\t\t * @param {Node} node\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreateFromNode: function(node) {\n\t\t\t\tvar sc = node;\n\t\t\t\tvar so = 0;\n\t\t\t\tvar ec = node;\n\t\t\t\tvar eo = dom.nodeLength(ec);\n\n\t\t\t\t// browsers can't target a picture or void node\n\t\t\t\tif(dom.isVoid(sc)) {\n\t\t\t\t\tso = dom.listPrev(sc).length - 1;\n\t\t\t\t\tsc = sc.parentNode;\n\t\t\t\t}\n\t\t\t\tif(dom.isBR(ec)) {\n\t\t\t\t\teo = dom.listPrev(ec).length - 1;\n\t\t\t\t\tec = ec.parentNode;\n\t\t\t\t} else if(dom.isVoid(ec)) {\n\t\t\t\t\teo = dom.listPrev(ec).length;\n\t\t\t\t\tec = ec.parentNode;\n\t\t\t\t}\n\n\t\t\t\treturn this.create(sc, so, ec, eo);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * create WrappedRange from node after position\n\t\t\t *\n\t\t\t * @param {Node} node\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreateFromNodeBefore: function(node) {\n\t\t\t\treturn this.createFromNode(node).collapse(true);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * create WrappedRange from node after position\n\t\t\t *\n\t\t\t * @param {Node} node\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreateFromNodeAfter: function(node) {\n\t\t\t\treturn this.createFromNode(node).collapse();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @method \n\t\t\t * \n\t\t\t * create WrappedRange from bookmark\n\t\t\t *\n\t\t\t * @param {Node} editable\n\t\t\t * @param {Object} bookmark\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreateFromBookmark: function(editable, bookmark) {\n\t\t\t\tvar sc = dom.fromOffsetPath(editable, bookmark.s.path);\n\t\t\t\tvar so = bookmark.s.offset;\n\t\t\t\tvar ec = dom.fromOffsetPath(editable, bookmark.e.path);\n\t\t\t\tvar eo = bookmark.e.offset;\n\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @method \n\t\t\t *\n\t\t\t * create WrappedRange from paraBookmark\n\t\t\t *\n\t\t\t * @param {Object} bookmark\n\t\t\t * @param {Node[]} paras\n\t\t\t * @return {WrappedRange}\n\t\t\t */\n\t\t\tcreateFromParaBookmark: function(bookmark, paras) {\n\t\t\t\tvar so = bookmark.s.offset;\n\t\t\t\tvar eo = bookmark.e.offset;\n\t\t\t\tvar sc = dom.fromOffsetPath(list.head(paras), bookmark.s.path);\n\t\t\t\tvar ec = dom.fromOffsetPath(list.last(paras), bookmark.e.path);\n\n\t\t\t\treturn new WrappedRange(sc, so, ec, eo);\n\t\t\t}\n\t\t};\n\t})();\n\n\t/**\n\t * @class core.async\n\t *\n\t * Async functions which returns `Promise`\n\t *\n\t * @singleton\n\t * @alternateClassName async\n\t */\n\tvar async = (function() {\n\t\t/**\n\t\t * @method readFileAsDataURL\n\t\t *\n\t\t * read contents of file as representing URL\n\t\t *\n\t\t * @param {File} file\n\t\t * @return {Promise} - then: dataUrl\n\t\t */\n\t\tvar readFileAsDataURL = function(file) {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\t$.extend(new FileReader(), {\n\t\t\t\t\tonload: function(e) {\n\t\t\t\t\t\tvar dataURL = e.target.result;\n\t\t\t\t\t\tdeferred.resolve(dataURL);\n\t\t\t\t\t},\n\t\t\t\t\tonerror: function() {\n\t\t\t\t\t\tdeferred.reject(this);\n\t\t\t\t\t}\n\t\t\t\t}).readAsDataURL(file);\n\t\t\t}).promise();\n\t\t};\n\n\t\t/**\n\t\t * @method createImage\n\t\t *\n\t\t * create `<image>` from url string\n\t\t *\n\t\t * @param {String} url\n\t\t * @return {Promise} - then: $image\n\t\t */\n\t\tvar createImage = function(url) {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tvar $img = $('<img>');\n\n\t\t\t\t$img.one('load', function() {\n\t\t\t\t\t$img.off('error abort');\n\t\t\t\t\tdeferred.resolve($img);\n\t\t\t\t}).one('error abort', function() {\n\t\t\t\t\t$img.off('load').detach();\n\t\t\t\t\tdeferred.reject($img);\n\t\t\t\t}).css({\n\t\t\t\t\tdisplay: 'none'\n\t\t\t\t}).appendTo(document.body).attr('src', url);\n\t\t\t}).promise();\n\t\t};\n\n\t\treturn {\n\t\t\treadFileAsDataURL: readFileAsDataURL,\n\t\t\tcreateImage: createImage\n\t\t};\n\t})();\n\n\t/**\n\t * @class editing.History\n\t *\n\t * Editor History\n\t *\n\t */\n\tvar History = function($editable) {\n\t\tvar stack = [],\n\t\t\tstackOffset = -1;\n\t\tvar editable = $editable[0];\n\n\t\tvar makeSnapshot = function() {\n\t\t\tvar rng = range.create(editable);\n\t\t\tvar emptyBookmark = {\n\t\t\t\ts: {\n\t\t\t\t\tpath: [],\n\t\t\t\t\toffset: 0\n\t\t\t\t},\n\t\t\t\te: {\n\t\t\t\t\tpath: [],\n\t\t\t\t\toffset: 0\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\tcontents: $editable.html(),\n\t\t\t\tbookmark: (rng ? rng.bookmark(editable) : emptyBookmark)\n\t\t\t};\n\t\t};\n\n\t\tvar applySnapshot = function(snapshot) {\n\t\t\tif(snapshot.contents !== null) {\n\t\t\t\t$editable.html(snapshot.contents);\n\t\t\t}\n\t\t\tif(snapshot.bookmark !== null) {\n\t\t\t\trange.createFromBookmark(editable, snapshot.bookmark).select();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @method rewind\n\t\t * Rewinds the history stack back to the first snapshot taken.\n\t\t * Leaves the stack intact, so that \"Redo\" can still be used.\n\t\t */\n\t\tthis.rewind = function() {\n\t\t\t// Create snap shot if not yet recorded\n\t\t\tif($editable.html() !== stack[stackOffset].contents) {\n\t\t\t\tthis.recordUndo();\n\t\t\t}\n\n\t\t\t// Return to the first available snapshot.\n\t\t\tstackOffset = 0;\n\n\t\t\t// Apply that snapshot.\n\t\t\tapplySnapshot(stack[stackOffset]);\n\t\t};\n\n\t\t/**\n\t\t * @method reset\n\t\t * Resets the history stack completely; reverting to an empty editor.\n\t\t */\n\t\tthis.reset = function() {\n\t\t\t// Clear the stack.\n\t\t\tstack = [];\n\n\t\t\t// Restore stackOffset to its original value.\n\t\t\tstackOffset = -1;\n\n\t\t\t// Clear the editable area.\n\t\t\t$editable.html('');\n\n\t\t\t// Record our first snapshot (of nothing).\n\t\t\tthis.recordUndo();\n\t\t};\n\n\t\t/**\n\t\t * undo\n\t\t */\n\t\tthis.undo = function() {\n\t\t\t// Create snap shot if not yet recorded\n\t\t\tif($editable.html() !== stack[stackOffset].contents) {\n\t\t\t\tthis.recordUndo();\n\t\t\t}\n\n\t\t\tif(0 < stackOffset) {\n\t\t\t\tstackOffset--;\n\t\t\t\tapplySnapshot(stack[stackOffset]);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * redo\n\t\t */\n\t\tthis.redo = function() {\n\t\t\tif(stack.length - 1 > stackOffset) {\n\t\t\t\tstackOffset++;\n\t\t\t\tapplySnapshot(stack[stackOffset]);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * recorded undo\n\t\t */\n\t\tthis.recordUndo = function() {\n\t\t\tstackOffset++;\n\n\t\t\t// Wash out stack after stackOffset\n\t\t\tif(stack.length > stackOffset) {\n\t\t\t\tstack = stack.slice(0, stackOffset);\n\t\t\t}\n\n\t\t\t// Create new snapshot and push it to the end\n\t\t\tstack.push(makeSnapshot());\n\t\t};\n\t};\n\n\t/**\n\t * @class editing.Style\n\t *\n\t * Style\n\t *\n\t */\n\tvar Style = function() {\n\t\t/**\n\t\t * @method jQueryCSS\n\t\t *\n\t\t * [workaround] for old jQuery\n\t\t * passing an array of style properties to .css()\n\t\t * will result in an object of property-value pairs.\n\t\t * (compability with version < 1.9)\n\t\t *\n\t\t * @private\n\t\t * @param  {jQuery} $obj\n\t\t * @param  {Array} propertyNames - An array of one or more CSS properties.\n\t\t * @return {Object}\n\t\t */\n\t\tvar jQueryCSS = function($obj, propertyNames) {\n\t\t\tif(agent.jqueryVersion < 1.9) {\n\t\t\t\tvar result = {};\n\t\t\t\t$.each(propertyNames, function(idx, propertyName) {\n\t\t\t\t\tresult[propertyName] = $obj.css(propertyName);\n\t\t\t\t});\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\treturn $obj.css.call($obj, propertyNames);\n\t\t};\n\n\t\t/**\n\t\t * returns style object from node\n\t\t *\n\t\t * @param {jQuery} $node\n\t\t * @return {Object}\n\t\t */\n\t\tthis.fromNode = function($node) {\n\t\t\tvar properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];\n\t\t\tvar styleInfo = jQueryCSS($node, properties) || {};\n\t\t\tstyleInfo['font-size'] = parseInt(styleInfo['font-size'], 10);\n\t\t\treturn styleInfo;\n\t\t};\n\n\t\t/**\n\t\t * paragraph level style\n\t\t *\n\t\t * @param {WrappedRange} rng\n\t\t * @param {Object} styleInfo\n\t\t */\n\t\tthis.stylePara = function(rng, styleInfo) {\n\t\t\t$.each(rng.nodes(dom.isPara, {\n\t\t\t\tincludeAncestor: true\n\t\t\t}), function(idx, para) {\n\t\t\t\t$(para).css(styleInfo);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * insert and returns styleNodes on range.\n\t\t *\n\t\t * @param {WrappedRange} rng\n\t\t * @param {Object} [options] - options for styleNodes\n\t\t * @param {String} [options.nodeName] - default: `SPAN`\n\t\t * @param {Boolean} [options.expandClosestSibling] - default: `false`\n\t\t * @param {Boolean} [options.onlyPartialContains] - default: `false`\n\t\t * @return {Node[]}\n\t\t */\n\t\tthis.styleNodes = function(rng, options) {\n\t\t\trng = rng.splitText();\n\n\t\t\tvar nodeName = options && options.nodeName || 'SPAN';\n\t\t\tvar expandClosestSibling = !!(options && options.expandClosestSibling);\n\t\t\tvar onlyPartialContains = !!(options && options.onlyPartialContains);\n\n\t\t\tif(rng.isCollapsed()) {\n\t\t\t\treturn [rng.insertNode(dom.create(nodeName))];\n\t\t\t}\n\n\t\t\tvar pred = dom.makePredByNodeName(nodeName);\n\t\t\tvar nodes = rng.nodes(dom.isText, {\n\t\t\t\tfullyContains: true\n\t\t\t}).map(function(text) {\n\t\t\t\treturn dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);\n\t\t\t});\n\n\t\t\tif(expandClosestSibling) {\n\t\t\t\tif(onlyPartialContains) {\n\t\t\t\t\tvar nodesInRange = rng.nodes();\n\t\t\t\t\t// compose with partial contains predication\n\t\t\t\t\tpred = func.and(pred, function(node) {\n\t\t\t\t\t\treturn list.contains(nodesInRange, node);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn nodes.map(function(node) {\n\t\t\t\t\tvar siblings = dom.withClosestSiblings(node, pred);\n\t\t\t\t\tvar head = list.head(siblings);\n\t\t\t\t\tvar tails = list.tail(siblings);\n\t\t\t\t\t$.each(tails, function(idx, elem) {\n\t\t\t\t\t\tdom.appendChildNodes(head, elem.childNodes);\n\t\t\t\t\t\tdom.remove(elem);\n\t\t\t\t\t});\n\t\t\t\t\treturn list.head(siblings);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn nodes;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * get current style on cursor\n\t\t *\n\t\t * @param {WrappedRange} rng\n\t\t * @return {Object} - object contains style properties.\n\t\t */\n\t\tthis.current = function(rng) {\n\t\t\tvar $cont = $(!dom.isElement(rng.sc) ? rng.sc.parentNode : rng.sc);\n\t\t\tvar styleInfo = this.fromNode($cont);\n\n\t\t\t// document.queryCommandState for toggle state\n\t\t\t// [workaround] prevent Firefox nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"\n\t\t\ttry {\n\t\t\t\tstyleInfo = $.extend(styleInfo, {\n\t\t\t\t\t'font-bold': document.queryCommandState('bold') ? 'bold' : 'normal',\n\t\t\t\t\t'font-italic': document.queryCommandState('italic') ? 'italic' : 'normal',\n\t\t\t\t\t'font-underline': document.queryCommandState('underline') ? 'underline' : 'normal',\n\t\t\t\t\t'font-subscript': document.queryCommandState('subscript') ? 'subscript' : 'normal',\n\t\t\t\t\t'font-superscript': document.queryCommandState('superscript') ? 'superscript' : 'normal',\n\t\t\t\t\t'font-strikethrough': document.queryCommandState('strikethrough') ? 'strikethrough' : 'normal'\n\t\t\t\t});\n\t\t\t} catch(e) {}\n\n\t\t\t// list-style-type to list-style(unordered, ordered)\n\t\t\tif(!rng.isOnList()) {\n\t\t\t\tstyleInfo['list-style'] = 'none';\n\t\t\t} else {\n\t\t\t\tvar orderedTypes = ['circle', 'disc', 'disc-leading-zero', 'square'];\n\t\t\t\tvar isUnordered = $.inArray(styleInfo['list-style-type'], orderedTypes) > -1;\n\t\t\t\tstyleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';\n\t\t\t}\n\n\t\t\tvar para = dom.ancestor(rng.sc, dom.isPara);\n\t\t\tif(para && para.style['line-height']) {\n\t\t\t\tstyleInfo['line-height'] = para.style.lineHeight;\n\t\t\t} else {\n\t\t\t\tvar lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);\n\t\t\t\tstyleInfo['line-height'] = lineHeight.toFixed(1);\n\t\t\t}\n\n\t\t\tstyleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);\n\t\t\tstyleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);\n\t\t\tstyleInfo.range = rng;\n\n\t\t\treturn styleInfo;\n\t\t};\n\t};\n\n\t/**\n\t * @class editing.Bullet\n\t *\n\t * @alternateClassName Bullet\n\t */\n\tvar Bullet = function() {\n\t\tvar self = this;\n\n\t\t/**\n\t\t * toggle ordered list\n\t\t */\n\t\tthis.insertOrderedList = function(editable) {\n\t\t\tthis.toggleList('OL', editable);\n\t\t};\n\n\t\t/**\n\t\t * toggle unordered list\n\t\t */\n\t\tthis.insertUnorderedList = function(editable) {\n\t\t\tthis.toggleList('UL', editable);\n\t\t};\n\n\t\t/**\n\t\t * indent\n\t\t */\n\t\tthis.indent = function(editable) {\n\t\t\tvar self = this;\n\t\t\tvar rng = range.create(editable).wrapBodyInlineWithPara();\n\n\t\t\tvar paras = rng.nodes(dom.isPara, {\n\t\t\t\tincludeAncestor: true\n\t\t\t});\n\t\t\tvar clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n\t\t\t$.each(clustereds, function(idx, paras) {\n\t\t\t\tvar head = list.head(paras);\n\t\t\t\tif(dom.isLi(head)) {\n\t\t\t\t\tself.wrapList(paras, head.parentNode.nodeName);\n\t\t\t\t} else {\n\t\t\t\t\t$.each(paras, function(idx, para) {\n\t\t\t\t\t\t$(para).css('marginLeft', function(idx, val) {\n\t\t\t\t\t\t\treturn(parseInt(val, 10) || 0) + 25;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\trng.select();\n\t\t};\n\n\t\t/**\n\t\t * outdent\n\t\t */\n\t\tthis.outdent = function(editable) {\n\t\t\tvar self = this;\n\t\t\tvar rng = range.create(editable).wrapBodyInlineWithPara();\n\n\t\t\tvar paras = rng.nodes(dom.isPara, {\n\t\t\t\tincludeAncestor: true\n\t\t\t});\n\t\t\tvar clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n\t\t\t$.each(clustereds, function(idx, paras) {\n\t\t\t\tvar head = list.head(paras);\n\t\t\t\tif(dom.isLi(head)) {\n\t\t\t\t\tself.releaseList([paras]);\n\t\t\t\t} else {\n\t\t\t\t\t$.each(paras, function(idx, para) {\n\t\t\t\t\t\t$(para).css('marginLeft', function(idx, val) {\n\t\t\t\t\t\t\tval = (parseInt(val, 10) || 0);\n\t\t\t\t\t\t\treturn val > 25 ? val - 25 : '';\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\trng.select();\n\t\t};\n\n\t\t/**\n\t\t * toggle list\n\t\t *\n\t\t * @param {String} listName - OL or UL\n\t\t */\n\t\tthis.toggleList = function(listName, editable) {\n\t\t\tvar rng = range.create(editable).wrapBodyInlineWithPara();\n\n\t\t\tvar paras = rng.nodes(dom.isPara, {\n\t\t\t\tincludeAncestor: true\n\t\t\t});\n\t\t\tvar bookmark = rng.paraBookmark(paras);\n\t\t\tvar clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n\t\t\t// paragraph to list\n\t\t\tif(list.find(paras, dom.isPurePara)) {\n\t\t\t\tvar wrappedParas = [];\n\t\t\t\t$.each(clustereds, function(idx, paras) {\n\t\t\t\t\twrappedParas = wrappedParas.concat(self.wrapList(paras, listName));\n\t\t\t\t});\n\t\t\t\tparas = wrappedParas;\n\t\t\t\t// list to paragraph or change list style\n\t\t\t} else {\n\t\t\t\tvar diffLists = rng.nodes(dom.isList, {\n\t\t\t\t\tincludeAncestor: true\n\t\t\t\t}).filter(function(listNode) {\n\t\t\t\t\treturn !$.nodeName(listNode, listName);\n\t\t\t\t});\n\n\t\t\t\tif(diffLists.length) {\n\t\t\t\t\t$.each(diffLists, function(idx, listNode) {\n\t\t\t\t\t\tdom.replace(listNode, listName);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tparas = this.releaseList(clustereds, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trange.createFromParaBookmark(bookmark, paras).select();\n\t\t};\n\n\t\t/**\n\t\t * @param {Node[]} paras\n\t\t * @param {String} listName\n\t\t * @return {Node[]}\n\t\t */\n\t\tthis.wrapList = function(paras, listName) {\n\t\t\tvar head = list.head(paras);\n\t\t\tvar last = list.last(paras);\n\n\t\t\tvar prevList = dom.isList(head.previousSibling) && head.previousSibling;\n\t\t\tvar nextList = dom.isList(last.nextSibling) && last.nextSibling;\n\n\t\t\tvar listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last);\n\n\t\t\t// P to LI\n\t\t\tparas = paras.map(function(para) {\n\t\t\t\treturn dom.isPurePara(para) ? dom.replace(para, 'LI') : para;\n\t\t\t});\n\n\t\t\t// append to list(<ul>, <ol>)\n\t\t\tdom.appendChildNodes(listNode, paras);\n\n\t\t\tif(nextList) {\n\t\t\t\tdom.appendChildNodes(listNode, list.from(nextList.childNodes));\n\t\t\t\tdom.remove(nextList);\n\t\t\t}\n\n\t\t\treturn paras;\n\t\t};\n\n\t\t/**\n\t\t * @method releaseList\n\t\t *\n\t\t * @param {Array[]} clustereds\n\t\t * @param {Boolean} isEscapseToBody\n\t\t * @return {Node[]}\n\t\t */\n\t\tthis.releaseList = function(clustereds, isEscapseToBody) {\n\t\t\tvar releasedParas = [];\n\n\t\t\t$.each(clustereds, function(idx, paras) {\n\t\t\t\tvar head = list.head(paras);\n\t\t\t\tvar last = list.last(paras);\n\n\t\t\t\tvar headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) :\n\t\t\t\t\thead.parentNode;\n\t\t\t\tvar lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {\n\t\t\t\t\tnode: last.parentNode,\n\t\t\t\t\toffset: dom.position(last) + 1\n\t\t\t\t}, {\n\t\t\t\t\tisSkipPaddingBlankHTML: true\n\t\t\t\t}) : null;\n\n\t\t\t\tvar middleList = dom.splitTree(headList, {\n\t\t\t\t\tnode: head.parentNode,\n\t\t\t\t\toffset: dom.position(head)\n\t\t\t\t}, {\n\t\t\t\t\tisSkipPaddingBlankHTML: true\n\t\t\t\t});\n\n\t\t\t\tparas = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi) :\n\t\t\t\t\tlist.from(middleList.childNodes).filter(dom.isLi);\n\n\t\t\t\t// LI to P\n\t\t\t\tif(isEscapseToBody || !dom.isList(headList.parentNode)) {\n\t\t\t\t\tparas = paras.map(function(para) {\n\t\t\t\t\t\treturn dom.replace(para, 'P');\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t$.each(list.from(paras).reverse(), function(idx, para) {\n\t\t\t\t\tdom.insertAfter(para, headList);\n\t\t\t\t});\n\n\t\t\t\t// remove empty lists\n\t\t\t\tvar rootLists = list.compact([headList, middleList, lastList]);\n\t\t\t\t$.each(rootLists, function(idx, rootList) {\n\t\t\t\t\tvar listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));\n\t\t\t\t\t$.each(listNodes.reverse(), function(idx, listNode) {\n\t\t\t\t\t\tif(!dom.nodeLength(listNode)) {\n\t\t\t\t\t\t\tdom.remove(listNode, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treleasedParas = releasedParas.concat(paras);\n\t\t\t});\n\n\t\t\treturn releasedParas;\n\t\t};\n\t};\n\n\t/**\n\t * @class editing.Typing\n\t *\n\t * Typing\n\t *\n\t */\n\tvar Typing = function() {\n\n\t\t// a Bullet instance to toggle lists off\n\t\tvar bullet = new Bullet();\n\n\t\t/**\n\t\t * insert tab\n\t\t *\n\t\t * @param {WrappedRange} rng\n\t\t * @param {Number} tabsize\n\t\t */\n\t\tthis.insertTab = function(rng, tabsize) {\n\t\t\tvar tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));\n\t\t\trng = rng.deleteContents();\n\t\t\trng.insertNode(tab, true);\n\n\t\t\trng = range.create(tab, tabsize);\n\t\t\trng.select();\n\t\t};\n\n\t\t/**\n\t\t * insert paragraph\n\t\t */\n\t\tthis.insertParagraph = function(editable) {\n\t\t\tvar rng = range.create(editable);\n\n\t\t\t// deleteContents on range.\n\t\t\trng = rng.deleteContents();\n\n\t\t\t// Wrap range if it needs to be wrapped by paragraph\n\t\t\trng = rng.wrapBodyInlineWithPara();\n\n\t\t\t// finding paragraph\n\t\t\tvar splitRoot = dom.ancestor(rng.sc, dom.isPara);\n\n\t\t\tvar nextPara;\n\t\t\t// on paragraph: split paragraph\n\t\t\tif(splitRoot) {\n\t\t\t\t// if it is an empty line with li\n\t\t\t\tif(dom.isEmpty(splitRoot) && dom.isLi(splitRoot)) {\n\t\t\t\t\t// toogle UL/OL and escape\n\t\t\t\t\tbullet.toggleList(splitRoot.parentNode.nodeName);\n\t\t\t\t\treturn;\n\t\t\t\t\t// if it is an empty line with para on blockquote\n\t\t\t\t} else if(dom.isEmpty(splitRoot) && dom.isPara(splitRoot) && dom.isBlockquote(splitRoot.parentNode)) {\n\t\t\t\t\t// escape blockquote\n\t\t\t\t\tdom.insertAfter(splitRoot, splitRoot.parentNode);\n\t\t\t\t\tnextPara = splitRoot;\n\t\t\t\t\t// if new line has content (not a line break)\n\t\t\t\t} else {\n\t\t\t\t\tnextPara = dom.splitTree(splitRoot, rng.getStartPoint());\n\n\t\t\t\t\tvar emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);\n\t\t\t\t\temptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));\n\n\t\t\t\t\t$.each(emptyAnchors, function(idx, anchor) {\n\t\t\t\t\t\tdom.remove(anchor);\n\t\t\t\t\t});\n\n\t\t\t\t\t// replace empty heading or pre with P tag\n\t\t\t\t\tif((dom.isHeading(nextPara) || dom.isPre(nextPara)) && dom.isEmpty(nextPara)) {\n\t\t\t\t\t\tnextPara = dom.replace(nextPara, 'p');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// no paragraph: insert empty paragraph\n\t\t\t} else {\n\t\t\t\tvar next = rng.sc.childNodes[rng.so];\n\t\t\t\tnextPara = $(dom.emptyPara)[0];\n\t\t\t\tif(next) {\n\t\t\t\t\trng.sc.insertBefore(nextPara, next);\n\t\t\t\t} else {\n\t\t\t\t\trng.sc.appendChild(nextPara);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trange.create(nextPara, 0).normalize().select().scrollIntoView(editable);\n\t\t};\n\t};\n\n\t/**\n\t * @class editing.Table\n\t *\n\t * Table\n\t *\n\t */\n\tvar Table = function() {\n\t\t/**\n\t\t * handle tab key\n\t\t *\n\t\t * @param {WrappedRange} rng\n\t\t * @param {Boolean} isShift\n\t\t */\n\t\tthis.tab = function(rng, isShift) {\n\t\t\tvar cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n\t\t\tvar table = dom.ancestor(cell, dom.isTable);\n\t\t\tvar cells = dom.listDescendant(table, dom.isCell);\n\n\t\t\tvar nextCell = list[isShift ? 'prev' : 'next'](cells, cell);\n\t\t\tif(nextCell) {\n\t\t\t\trange.create(nextCell, 0).select();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * create empty table element\n\t\t *\n\t\t * @param {Number} rowCount\n\t\t * @param {Number} colCount\n\t\t * @return {Node}\n\t\t */\n\t\tthis.createTable = function(colCount, rowCount, options) {\n\t\t\tvar tds = [],\n\t\t\t\ttdHTML;\n\t\t\tfor(var idxCol = 0; idxCol < colCount; idxCol++) {\n\t\t\t\ttds.push('<td>' + dom.blank + '</td>');\n\t\t\t}\n\t\t\ttdHTML = tds.join('');\n\n\t\t\tvar trs = [],\n\t\t\t\ttrHTML;\n\t\t\tfor(var idxRow = 0; idxRow < rowCount; idxRow++) {\n\t\t\t\ttrs.push('<tr>' + tdHTML + '</tr>');\n\t\t\t}\n\t\t\ttrHTML = trs.join('');\n\t\t\tvar $table = $('<table>' + trHTML + '</table>');\n\t\t\tif(options && options.tableClassName) {\n\t\t\t\t$table.addClass(options.tableClassName);\n\t\t\t}\n\n\t\t\treturn $table[0];\n\t\t};\n\t};\n\n\tvar KEY_BOGUS = 'bogus';\n\n\t/**\n\t * @class Editor\n\t */\n\tvar Editor = function(context) {\n\t\tvar self = this;\n\n\t\tvar $note = context.layoutInfo.note;\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar $editable = context.layoutInfo.editable;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tvar editable = $editable[0];\n\t\tvar lastRange = null;\n\n\t\tvar style = new Style();\n\t\tvar table = new Table();\n\t\tvar typing = new Typing();\n\t\tvar bullet = new Bullet();\n\t\tvar history = new History($editable);\n\n\t\tthis.initialize = function() {\n\t\t\t// bind custom events\n\t\t\t$editable.on('keydown', function(event) {\n\t\t\t\tif(event.keyCode === key.code.ENTER) {\n\t\t\t\t\tcontext.triggerEvent('enter', event);\n\t\t\t\t}\n\t\t\t\tcontext.triggerEvent('keydown', event);\n\n\t\t\t\tif(options.shortcuts && !event.isDefaultPrevented()) {\n\t\t\t\t\tself.handleKeyMap(event);\n\t\t\t\t}\n\t\t\t}).on('keyup', function(event) {\n\t\t\t\tcontext.triggerEvent('keyup', event);\n\t\t\t}).on('focus', function(event) {\n\t\t\t\tcontext.triggerEvent('focus', event);\n\t\t\t}).on('blur', function(event) {\n\t\t\t\tcontext.triggerEvent('blur', event);\n\t\t\t}).on('mousedown', function(event) {\n\t\t\t\tcontext.triggerEvent('mousedown', event);\n\t\t\t}).on('mouseup', function(event) {\n\t\t\t\tcontext.triggerEvent('mouseup', event);\n\t\t\t}).on('scroll', function(event) {\n\t\t\t\tcontext.triggerEvent('scroll', event);\n\t\t\t}).on('paste', function(event) {\n\t\t\t\tcontext.triggerEvent('paste', event);\n\t\t\t});\n\n\t\t\t// init content before set event\n\t\t\t$editable.html(dom.html($note) || dom.emptyPara);\n\n\t\t\t// [workaround] IE doesn't have input events for contentEditable\n\t\t\t// - see: https://goo.gl/4bfIvA\n\t\t\tvar changeEventName = agent.isMSIE ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';\n\t\t\t$editable.on(changeEventName, function() {\n\t\t\t\tcontext.triggerEvent('change', $editable.html());\n\t\t\t});\n\n\t\t\t$editor.on('focusin', function(event) {\n\t\t\t\tcontext.triggerEvent('focusin', event);\n\t\t\t}).on('focusout', function(event) {\n\t\t\t\tcontext.triggerEvent('focusout', event);\n\t\t\t});\n\n\t\t\tif(!options.airMode) {\n\t\t\t\tif(options.width) {\n\t\t\t\t\t$editor.outerWidth(options.width);\n\t\t\t\t}\n\t\t\t\tif(options.height) {\n\t\t\t\t\t$editable.outerHeight(options.height);\n\t\t\t\t}\n\t\t\t\tif(options.maxHeight) {\n\t\t\t\t\t$editable.css('max-height', options.maxHeight);\n\t\t\t\t}\n\t\t\t\tif(options.minHeight) {\n\t\t\t\t\t$editable.css('min-height', options.minHeight);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thistory.recordUndo();\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\t$editable.off();\n\t\t};\n\n\t\tthis.handleKeyMap = function(event) {\n\t\t\tvar keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n\t\t\tvar keys = [];\n\n\t\t\tif(event.metaKey) {\n\t\t\t\tkeys.push('CMD');\n\t\t\t}\n\t\t\tif(event.ctrlKey && !event.altKey) {\n\t\t\t\tkeys.push('CTRL');\n\t\t\t}\n\t\t\tif(event.shiftKey) {\n\t\t\t\tkeys.push('SHIFT');\n\t\t\t}\n\n\t\t\tvar keyName = key.nameFromCode[event.keyCode];\n\t\t\tif(keyName) {\n\t\t\t\tkeys.push(keyName);\n\t\t\t}\n\n\t\t\tvar eventName = keyMap[keys.join('+')];\n\t\t\tif(eventName) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcontext.invoke(eventName);\n\t\t\t} else if(key.isEdit(event.keyCode)) {\n\t\t\t\tthis.afterCommand();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * create range\n\t\t * @return {WrappedRange}\n\t\t */\n\t\tthis.createRange = function() {\n\t\t\tthis.focus();\n\t\t\treturn range.create(editable);\n\t\t};\n\n\t\t/**\n\t\t * saveRange\n\t\t *\n\t\t * save current range\n\t\t *\n\t\t * @param {Boolean} [thenCollapse=false]\n\t\t */\n\t\tthis.saveRange = function(thenCollapse) {\n\t\t\tlastRange = this.createRange();\n\t\t\tif(thenCollapse) {\n\t\t\t\tlastRange.collapse().select();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * restoreRange\n\t\t *\n\t\t * restore lately range\n\t\t */\n\t\tthis.restoreRange = function() {\n\t\t\tif(lastRange) {\n\t\t\t\tlastRange.select();\n\t\t\t\tthis.focus();\n\t\t\t}\n\t\t};\n\n\t\tthis.saveTarget = function(node) {\n\t\t\t$editable.data('target', node);\n\t\t};\n\n\t\tthis.clearTarget = function() {\n\t\t\t$editable.removeData('target');\n\t\t};\n\n\t\tthis.restoreTarget = function() {\n\t\t\treturn $editable.data('target');\n\t\t};\n\n\t\t/**\n\t\t * currentStyle\n\t\t *\n\t\t * current style\n\t\t * @return {Object|Boolean} unfocus\n\t\t */\n\t\tthis.currentStyle = function() {\n\t\t\tvar rng = range.create();\n\t\t\tif(rng) {\n\t\t\t\trng = rng.normalize();\n\t\t\t}\n\t\t\treturn rng ? style.current(rng) : style.fromNode($editable);\n\t\t};\n\n\t\t/**\n\t\t * style from node\n\t\t *\n\t\t * @param {jQuery} $node\n\t\t * @return {Object}\n\t\t */\n\t\tthis.styleFromNode = function($node) {\n\t\t\treturn style.fromNode($node);\n\t\t};\n\n\t\t/**\n\t\t * undo\n\t\t */\n\t\tthis.undo = function() {\n\t\t\tcontext.triggerEvent('before.command', $editable.html());\n\t\t\thistory.undo();\n\t\t\tcontext.triggerEvent('change', $editable.html());\n\t\t};\n\t\tcontext.memo('help.undo', lang.help.undo);\n\n\t\t/**\n\t\t * redo\n\t\t */\n\t\tthis.redo = function() {\n\t\t\tcontext.triggerEvent('before.command', $editable.html());\n\t\t\thistory.redo();\n\t\t\tcontext.triggerEvent('change', $editable.html());\n\t\t};\n\t\tcontext.memo('help.redo', lang.help.redo);\n\n\t\t/**\n\t\t * before command\n\t\t */\n\t\tvar beforeCommand = this.beforeCommand = function() {\n\t\t\tcontext.triggerEvent('before.command', $editable.html());\n\t\t\t// keep focus on editable before command execution\n\t\t\tself.focus();\n\t\t};\n\n\t\t/**\n\t\t * after command\n\t\t * @param {Boolean} isPreventTrigger\n\t\t */\n\t\tvar afterCommand = this.afterCommand = function(isPreventTrigger) {\n\t\t\thistory.recordUndo();\n\t\t\tif(!isPreventTrigger) {\n\t\t\t\tcontext.triggerEvent('change', $editable.html());\n\t\t\t}\n\t\t};\n\n\t\t/* jshint ignore:start */\n\t\t// native commands(with execCommand), generate function for execCommand\n\t\tvar commands = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript',\n\t\t\t'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull',\n\t\t\t'formatBlock', 'removeFormat',\n\t\t\t'backColor', 'foreColor', 'fontName'\n\t\t];\n\n\t\tfor(var idx = 0, len = commands.length; idx < len; idx++) {\n\t\t\tthis[commands[idx]] = (function(sCmd) {\n\t\t\t\treturn function(value) {\n\t\t\t\t\tbeforeCommand();\n\t\t\t\t\tdocument.execCommand(sCmd, false, value);\n\t\t\t\t\tafterCommand(true);\n\t\t\t\t};\n\t\t\t})(commands[idx]);\n\t\t\tcontext.memo('help.' + commands[idx], lang.help[commands[idx]]);\n\t\t}\n\t\t/* jshint ignore:end */\n\n\t\t/**\n\t\t * handle tab key\n\t\t */\n\t\tthis.tab = function() {\n\t\t\tvar rng = this.createRange();\n\t\t\tif(rng.isCollapsed() && rng.isOnCell()) {\n\t\t\t\ttable.tab(rng);\n\t\t\t} else {\n\t\t\t\tbeforeCommand();\n\t\t\t\ttyping.insertTab(rng, options.tabSize);\n\t\t\t\tafterCommand();\n\t\t\t}\n\t\t};\n\t\tcontext.memo('help.tab', lang.help.tab);\n\n\t\t/**\n\t\t * handle shift+tab key\n\t\t */\n\t\tthis.untab = function() {\n\t\t\tvar rng = this.createRange();\n\t\t\tif(rng.isCollapsed() && rng.isOnCell()) {\n\t\t\t\ttable.tab(rng, true);\n\t\t\t}\n\t\t};\n\t\tcontext.memo('help.untab', lang.help.untab);\n\n\t\t/**\n\t\t * run given function between beforeCommand and afterCommand\n\t\t */\n\t\tthis.wrapCommand = function(fn) {\n\t\t\treturn function() {\n\t\t\t\tbeforeCommand();\n\t\t\t\tfn.apply(self, arguments);\n\t\t\t\tafterCommand();\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * insert paragraph\n\t\t */\n\t\tthis.insertParagraph = this.wrapCommand(function() {\n\t\t\ttyping.insertParagraph(editable);\n\t\t});\n\t\tcontext.memo('help.insertParagraph', lang.help.insertParagraph);\n\n\t\tthis.insertOrderedList = this.wrapCommand(function() {\n\t\t\tbullet.insertOrderedList(editable);\n\t\t});\n\t\tcontext.memo('help.insertOrderedList', lang.help.insertOrderedList);\n\n\t\tthis.insertUnorderedList = this.wrapCommand(function() {\n\t\t\tbullet.insertUnorderedList(editable);\n\t\t});\n\t\tcontext.memo('help.insertUnorderedList', lang.help.insertUnorderedList);\n\n\t\tthis.indent = this.wrapCommand(function() {\n\t\t\tbullet.indent(editable);\n\t\t});\n\t\tcontext.memo('help.indent', lang.help.indent);\n\n\t\tthis.outdent = this.wrapCommand(function() {\n\t\t\tbullet.outdent(editable);\n\t\t});\n\t\tcontext.memo('help.outdent', lang.help.outdent);\n\n\t\t/**\n\t\t * insert image\n\t\t *\tupdate by yujinjin 插入图片链接\n\t\t * @param {String} src\n\t\t * @param {String|Function} param\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.insertImage = function(src, param, linkInfo) {\n\t\t\treturn async.createImage(src, param).then(function($image) {\n\t\t\t\tbeforeCommand();\n\n\t\t\t\tif(typeof param === 'function') {\n\t\t\t\t\tparam($image);\n\t\t\t\t} else {\n\t\t\t\t\tif(typeof param === 'string') {\n\t\t\t\t\t\t$image.attr('data-filename', param);\n\t\t\t\t\t}\n\t\t\t\t\t$image.css('width', Math.min($editable.width(), $image.width()));\n\t\t\t\t}\n\t\t\t\t$image.show();\n\t\t\t\tif(linkInfo.url) {\n\t\t\t\t\t$image = $image.wrap('<a href=\"' + linkInfo.url + '\"' + (linkInfo.sNewWindow ? ' target=\"_blank\"' : '') + '></a>');\n\t\t\t\t\t$image = $image.parent();\n\t\t\t\t}\n\t\t\t\trange.create(editable).insertNode($image[0]);\n\t\t\t\trange.createFromNodeAfter($image[0]).select();\n\t\t\t\tafterCommand();\n\t\t\t}).fail(function(e) {\n\t\t\t\tcontext.triggerEvent('image.upload.error', e);\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * insertImages\n\t\t * update by yujinjin 插入图片链接\n\t\t * @param {File[]} files\n\t\t */\n\t\tthis.insertImages = function(files, linkInfo) {\n\t\t\t$.each(files, function(idx, file) {\n\t\t\t\tvar filename = file.name;\n\t\t\t\tif(options.maximumImageFileSize && options.maximumImageFileSize < file.size) {\n\t\t\t\t\tcontext.triggerEvent('image.upload.error', lang.image.maximumFileSizeError);\n\t\t\t\t} else {\n\t\t\t\t\tasync.readFileAsDataURL(file).then(function(dataURL) {\n\t\t\t\t\t\treturn self.insertImage(dataURL, filename, linkInfo);\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\tcontext.triggerEvent('image.upload.error');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * insertImagesOrCallback\n\t\t * update by yujinjin 插入图片链接\n\t\t * @param {File[]} files\n\t\t */\n\t\tthis.insertImagesOrCallback = function(files, linkInfo) {\n\t\t\tvar callbacks = options.callbacks;\n\t\t\t// If onImageUpload options setted\n\t\t\tif(callbacks.onImageUpload) {\n\t\t\t\tcontext.triggerEvent('image.upload', files, linkInfo);\n\t\t\t\t// else insert Image as dataURL\n\t\t\t} else {\n\t\t\t\tthis.insertImages(files, linkInfo);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * insertNode\n\t\t * insert node\n\t\t * @param {Node} node\n\t\t */\n\t\tthis.insertNode = this.wrapCommand(function(node) {\n\t\t\tvar rng = this.createRange();\n\t\t\trng.insertNode(node);\n\t\t\trange.createFromNodeAfter(node).select();\n\t\t});\n\n\t\t/**\n\t\t * insert text\n\t\t * @param {String} text\n\t\t */\n\t\tthis.insertText = this.wrapCommand(function(text) {\n\t\t\tvar rng = this.createRange();\n\t\t\tvar textNode = rng.insertNode(dom.createText(text));\n\t\t\trange.create(textNode, dom.nodeLength(textNode)).select();\n\t\t});\n\n\t\t/**\n\t\t * return selected plain text\n\t\t * @return {String} text\n\t\t */\n\t\tthis.getSelectedText = function() {\n\t\t\tvar rng = this.createRange();\n\n\t\t\t// if range on anchor, expand range with anchor\n\t\t\tif(rng.isOnAnchor()) {\n\t\t\t\trng = range.createFromNode(dom.ancestor(rng.sc, dom.isAnchor));\n\t\t\t}\n\n\t\t\treturn rng.toString();\n\t\t};\n\n\t\t/**\n\t\t * paste HTML\n\t\t * @param {String} markup\n\t\t */\n\t\tthis.pasteHTML = this.wrapCommand(function(markup) {\n\t\t\tvar contents = this.createRange().pasteHTML(markup);\n\t\t\trange.createFromNodeAfter(list.last(contents)).select();\n\t\t});\n\n\t\t/**\n\t\t * formatBlock\n\t\t *\n\t\t * @param {String} tagName\n\t\t */\n\t\tthis.formatBlock = this.wrapCommand(function(tagName) {\n\t\t\t// [workaround] for MSIE, IE need `<`\n\t\t\ttagName = agent.isMSIE ? '<' + tagName + '>' : tagName;\n\t\t\tdocument.execCommand('FormatBlock', false, tagName);\n\t\t});\n\n\t\tthis.formatPara = function() {\n\t\t\tthis.formatBlock('P');\n\t\t};\n\t\tcontext.memo('help.formatPara', lang.help.formatPara);\n\n\t\t/* jshint ignore:start */\n\t\tfor(var idx = 1; idx <= 6; idx++) {\n\t\t\tthis['formatH' + idx] = function(idx) {\n\t\t\t\treturn function() {\n\t\t\t\t\tthis.formatBlock('H' + idx);\n\t\t\t\t};\n\t\t\t}(idx);\n\t\t\tcontext.memo('help.formatH' + idx, lang.help['formatH' + idx]);\n\t\t};\n\t\t/* jshint ignore:end */\n\n\t\t/**\n\t\t * fontSize\n\t\t *\n\t\t * @param {String} value - px\n\t\t */\n\t\tthis.fontSize = function(value) {\n\t\t\tvar rng = this.createRange();\n\n\t\t\tif(rng && rng.isCollapsed()) {\n\t\t\t\tvar spans = style.styleNodes(rng);\n\t\t\t\tvar firstSpan = list.head(spans);\n\n\t\t\t\t$(spans).css({\n\t\t\t\t\t'font-size': value + 'px'\n\t\t\t\t});\n\n\t\t\t\t// [workaround] added styled bogus span for style\n\t\t\t\t//  - also bogus character needed for cursor position\n\t\t\t\tif(firstSpan && !dom.nodeLength(firstSpan)) {\n\t\t\t\t\tfirstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;\n\t\t\t\t\trange.createFromNodeAfter(firstSpan.firstChild).select();\n\t\t\t\t\t$editable.data(KEY_BOGUS, firstSpan);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbeforeCommand();\n\t\t\t\t$(style.styleNodes(rng)).css({\n\t\t\t\t\t'font-size': value + 'px'\n\t\t\t\t});\n\t\t\t\tafterCommand();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * insert horizontal rule\n\t\t */\n\t\tthis.insertHorizontalRule = this.wrapCommand(function() {\n\t\t\tvar hrNode = this.createRange().insertNode(dom.create('HR'));\n\t\t\tif(hrNode.nextSibling) {\n\t\t\t\trange.create(hrNode.nextSibling, 0).normalize().select();\n\t\t\t}\n\t\t});\n\t\tcontext.memo('help.insertHorizontalRule', lang.help.insertHorizontalRule);\n\n\t\t/**\n\t\t * remove bogus node and character\n\t\t */\n\t\tthis.removeBogus = function() {\n\t\t\tvar bogusNode = $editable.data(KEY_BOGUS);\n\t\t\tif(!bogusNode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar textNode = list.find(list.from(bogusNode.childNodes), dom.isText);\n\n\t\t\tvar bogusCharIdx = textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);\n\t\t\tif(bogusCharIdx !== -1) {\n\t\t\t\ttextNode.deleteData(bogusCharIdx, 1);\n\t\t\t}\n\n\t\t\tif(dom.isEmpty(bogusNode)) {\n\t\t\t\tdom.remove(bogusNode);\n\t\t\t}\n\n\t\t\t$editable.removeData(KEY_BOGUS);\n\t\t};\n\n\t\t/**\n\t\t * lineHeight\n\t\t * @param {String} value\n\t\t */\n\t\tthis.lineHeight = this.wrapCommand(function(value) {\n\t\t\tstyle.stylePara(this.createRange(), {\n\t\t\t\tlineHeight: value\n\t\t\t});\n\t\t});\n\n\t\t/**\n\t\t * unlink\n\t\t *\n\t\t * @type command\n\t\t */\n\t\tthis.unlink = function() {\n\t\t\tvar rng = this.createRange();\n\t\t\tif(rng.isOnAnchor()) {\n\t\t\t\tvar anchor = dom.ancestor(rng.sc, dom.isAnchor);\n\t\t\t\trng = range.createFromNode(anchor);\n\t\t\t\trng.select();\n\n\t\t\t\tbeforeCommand();\n\t\t\t\tdocument.execCommand('unlink');\n\t\t\t\tafterCommand();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * create link (command)\n\t\t *\n\t\t * @param {Object} linkInfo\n\t\t */\n\t\tthis.createLink = this.wrapCommand(function(linkInfo) {\n\t\t\tvar linkUrl = linkInfo.url;\n\t\t\tvar linkText = linkInfo.text;\n\t\t\tvar isNewWindow = linkInfo.isNewWindow;\n\t\t\tvar rng = linkInfo.range || this.createRange();\n\t\t\tvar isTextChanged = rng.toString() !== linkText;\n\t\t\tif(options.onCreateLink) {\n\t\t\t\tlinkUrl = options.onCreateLink(linkUrl);\n\t\t\t}\n\n\t\t\tvar anchors = [];\n\t\t\tif(isTextChanged) {\n\t\t\t\trng = rng.deleteContents();\n\t\t\t\tvar anchor = rng.insertNode($('<A>' + linkText + '</A>')[0]);\n\t\t\t\tanchors.push(anchor);\n\t\t\t} else {\n\t\t\t\tanchors = style.styleNodes(rng, {\n\t\t\t\t\tnodeName: 'A',\n\t\t\t\t\texpandClosestSibling: true,\n\t\t\t\t\tonlyPartialContains: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t$.each(anchors, function(idx, anchor) {\n\t\t\t\t$(anchor).attr('href', linkUrl);\n\t\t\t\tif(isNewWindow) {\n\t\t\t\t\t$(anchor).attr('target', '_blank');\n\t\t\t\t} else {\n\t\t\t\t\t$(anchor).removeAttr('target');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar startRange = range.createFromNodeBefore(list.head(anchors));\n\t\t\tvar startPoint = startRange.getStartPoint();\n\t\t\tvar endRange = range.createFromNodeAfter(list.last(anchors));\n\t\t\tvar endPoint = endRange.getEndPoint();\n\n\t\t\trange.create(\n\t\t\t\tstartPoint.node,\n\t\t\t\tstartPoint.offset,\n\t\t\t\tendPoint.node,\n\t\t\t\tendPoint.offset\n\t\t\t).select();\n\t\t});\n\t\t\n\t\t\n\t\t/**\n\t\t * create linkImg (command)\n\t\t * \n\t\t * update by yujinjin\n\t\t *\n\t\t * @param {Object} linkImgInfo\n\t\t */\n\t\tthis.createLinkImg = this.wrapCommand(function(linkImgInfo) {\n\t\t\tvar linkUrl = linkImgInfo.url;\n\t\t\tvar isNewWindow = linkImgInfo.isNewWindow;\n\t\t\tvar target = linkImgInfo.target;\n\t\t\tif(options.onCreateLink) {\n\t\t\t\tlinkUrl = options.onCreateLink(linkUrl);\n\t\t\t}\n\t\t\tif($(target).parent().is(\"a\")){\n\t\t\t\t$(target).parent().attr(\"href\", linkUrl);\n\t\t\t\tif(isNewWindow) {\n\t\t\t\t\t$(target).parent().attr('target', '_blank');\n\t\t\t\t} else {\n\t\t\t\t\t$(target).parent().removeAttr('target');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$(target).wrap('<a href=\"' + linkUrl + '\"' + (isNewWindow ? ' target=\"_blank\"' : '') + '></a>');\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * returns link info\n\t\t *\n\t\t * @return {Object}\n\t\t * @return {WrappedRange} return.range\n\t\t * @return {String} return.text\n\t\t * @return {Boolean} [return.isNewWindow=true]\n\t\t * @return {String} [return.url=\"\"]\n\t\t */\n\t\tthis.getLinkInfo = function() {\n\t\t\tvar rng = this.createRange().expand(dom.isAnchor);\n\t\t\t// Get the first anchor on range(for edit).\n\t\t\tvar $anchor = $(list.head(rng.nodes(dom.isAnchor)));\n\t\t\treturn {\n\t\t\t\trange: rng,\n\t\t\t\ttext: rng.toString(),\n\t\t\t\tisNewWindow: $anchor.length ? $anchor.attr('target') === '_blank' : false,\n\t\t\t\turl: $anchor.length ? $anchor.attr('href') : ''\n\t\t\t};\n\t\t};\n\t\t\n\t\t/**\n\t\t * returns link img info\n\t\t * \n\t\t * update by yujinjin\n\t\t *\n\t\t * @return {Object}\n\t\t * @return {WrappedRange} return.range\n\t\t * @return {String} return.text\n\t\t * @return {Boolean} [return.isNewWindow=true]\n\t\t * @return {String} [return.url=\"\"]\n\t\t */\n\t\tthis.getLinkImgInfo = function() {\n\t\t\tvar isNewWindow = false, url = \"\";\n\t\t\t//TODO: yujinjin 这里获取parent方式来得到，这是有风险的但目前没有合适的解决方案\n\t\t\tif($(this.restoreTarget()).parent().is(\"a\")) {\n\t\t\t\tisNewWindow = ($(this.restoreTarget()).parent().attr('target') === '_blank');\n\t\t\t\turl = $(this.restoreTarget()).parent().attr('href');\n\t\t\t}\n\t\t\treturn {\n\t\t\t\ttarget: $(this.restoreTarget()),\n\t\t\t\tisNewWindow: isNewWindow,\n\t\t\t\turl: url\n\t\t\t};\n\t\t};\n\n\t\t/**\n\t\t * setting color\n\t\t *\n\t\t * @param {Object} sObjColor  color code\n\t\t * @param {String} sObjColor.foreColor foreground color\n\t\t * @param {String} sObjColor.backColor background color\n\t\t */\n\t\tthis.color = this.wrapCommand(function(colorInfo) {\n\t\t\tvar foreColor = colorInfo.foreColor;\n\t\t\tvar backColor = colorInfo.backColor;\n\n\t\t\tif(foreColor) {\n\t\t\t\tdocument.execCommand('foreColor', false, foreColor);\n\t\t\t}\n\t\t\tif(backColor) {\n\t\t\t\tdocument.execCommand('backColor', false, backColor);\n\t\t\t}\n\t\t});\n\n\t\t/**\n\t\t * insert Table\n\t\t *\n\t\t * @param {String} dimension of table (ex : \"5x5\")\n\t\t */\n\t\tthis.insertTable = this.wrapCommand(function(dim) {\n\t\t\tvar dimension = dim.split('x');\n\n\t\t\tvar rng = this.createRange().deleteContents();\n\t\t\trng.insertNode(table.createTable(dimension[0], dimension[1], options));\n\t\t});\n\n\t\t/**\n\t\t * float me\n\t\t *\n\t\t * @param {String} value\n\t\t */\n\t\tthis.floatMe = this.wrapCommand(function(value) {\n\t\t\tvar $target = $(this.restoreTarget());\n\t\t\t$target.css('float', value);\n\t\t});\n\n\t\t/**\n\t\t * resize overlay element\n\t\t * @param {String} value\n\t\t */\n\t\tthis.resize = this.wrapCommand(function(value) {\n\t\t\tvar $target = $(this.restoreTarget());\n\t\t\t$target.css({\n\t\t\t\twidth: value * 100 + '%',\n\t\t\t\theight: ''\n\t\t\t});\n\t\t});\n\n\t\t/**\n\t\t * @param {Position} pos\n\t\t * @param {jQuery} $target - target element\n\t\t * @param {Boolean} [bKeepRatio] - keep ratio\n\t\t */\n\t\tthis.resizeTo = function(pos, $target, bKeepRatio) {\n\t\t\tvar imageSize;\n\t\t\tif(bKeepRatio) {\n\t\t\t\tvar newRatio = pos.y / pos.x;\n\t\t\t\tvar ratio = $target.data('ratio');\n\t\t\t\timageSize = {\n\t\t\t\t\twidth: ratio > newRatio ? pos.x : pos.y / ratio,\n\t\t\t\t\theight: ratio > newRatio ? pos.x * ratio : pos.y\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\timageSize = {\n\t\t\t\t\twidth: pos.x,\n\t\t\t\t\theight: pos.y\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t$target.css(imageSize);\n\t\t};\n\n\t\t/**\n\t\t * remove media object\n\t\t */\n\t\tthis.removeMedia = this.wrapCommand(function() {\n\t\t\tvar $target = $(this.restoreTarget()), $parent = $(this.restoreTarget()).parent();\n\t\t\t$target.detach();\n\t\t\t// update by yujinjin 加入判断图片的父级别如果有链接而且除了图片没有其他内容就直接也删除该链接\n\t\t\tif($parent.is(\"a\") && !$target.parent().text()) {\n\t\t\t\t$parent.detach();\n\t\t\t}\n\t\t\tcontext.triggerEvent('media.delete', $target, $editable);\n\t\t});\n\n\t\t/**\n\t\t * returns whether editable area has focus or not.\n\t\t */\n\t\tthis.hasFocus = function() {\n\t\t\treturn $editable.is(':focus');\n\t\t};\n\n\t\t/**\n\t\t * set focus\n\t\t */\n\t\tthis.focus = function() {\n\t\t\t// [workaround] Screen will move when page is scolled in IE.\n\t\t\t//  - do focus when not focused\n\t\t\tif(!this.hasFocus()) {\n\t\t\t\t$editable.focus();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * returns whether contents is empty or not.\n\t\t * @return {Boolean}\n\t\t */\n\t\tthis.isEmpty = function() {\n\t\t\treturn dom.isEmpty($editable[0]) || dom.emptyPara === $editable.html();\n\t\t};\n\n\t\t/**\n\t\t * Removes all contents and restores the editable instance to an _emptyPara_.\n\t\t */\n\t\tthis.empty = function() {\n\t\t\tcontext.invoke('code', dom.emptyPara);\n\t\t};\n\t};\n\n\tvar Clipboard = function(context) {\n\t\tvar self = this;\n\n\t\tvar $editable = context.layoutInfo.editable;\n\n\t\tthis.events = {\n\t\t\t'summernote.keydown': function(we, e) {\n\t\t\t\tif(self.needKeydownHook()) {\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.keyCode === key.code.V) {\n\t\t\t\t\t\tcontext.invoke('editor.saveRange');\n\t\t\t\t\t\tself.$paste.focus();\n\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tself.pasteByHook();\n\t\t\t\t\t\t}, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.needKeydownHook = function() {\n\t\t\treturn(agent.isMSIE && agent.browserVersion > 10) || agent.isFF;\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\t// [workaround] getting image from clipboard\n\t\t\t//  - IE11 and Firefox: CTRL+v hook\n\t\t\t//  - Webkit: event.clipboardData\n\t\t\tif(this.needKeydownHook()) {\n\t\t\t\tthis.$paste = $('<div />').attr('contenteditable', true).css({\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\tleft: -100000,\n\t\t\t\t\topacity: 0\n\t\t\t\t});\n\t\t\t\t$editable.before(this.$paste);\n\n\t\t\t\tthis.$paste.on('paste', function(event) {\n\t\t\t\t\tcontext.triggerEvent('paste', event);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t$editable.on('paste', this.pasteByEvent);\n\t\t\t}\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tif(this.needKeydownHook()) {\n\t\t\t\tthis.$paste.remove();\n\t\t\t\tthis.$paste = null;\n\t\t\t}\n\t\t};\n\n\t\tthis.pasteByHook = function() {\n\t\t\tvar node = this.$paste[0].firstChild;\n\n\t\t\tif(dom.isImg(node)) {\n\t\t\t\tvar dataURI = node.src;\n\t\t\t\tvar decodedData = atob(dataURI.split(',')[1]);\n\t\t\t\tvar array = new Uint8Array(decodedData.length);\n\t\t\t\tfor(var i = 0; i < decodedData.length; i++) {\n\t\t\t\t\tarray[i] = decodedData.charCodeAt(i);\n\t\t\t\t}\n\n\t\t\t\tvar blob = new Blob([array], {\n\t\t\t\t\ttype: 'image/png'\n\t\t\t\t});\n\t\t\t\tblob.name = 'clipboard.png';\n\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t\tcontext.invoke('editor.focus');\n\t\t\t\tcontext.invoke('editor.insertImagesOrCallback', [blob]);\n\t\t\t} else {\n\t\t\t\tvar pasteContent = $('<div />').html(this.$paste.html()).html();\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t\tcontext.invoke('editor.focus');\n\n\t\t\t\tif(pasteContent) {\n\t\t\t\t\tcontext.invoke('editor.pasteHTML', pasteContent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.$paste.empty();\n\t\t};\n\n\t\t/**\n\t\t * paste by clipboard event\n\t\t *\n\t\t * @param {Event} event\n\t\t */\n\t\tthis.pasteByEvent = function(event) {\n\t\t\tvar clipboardData = event.originalEvent.clipboardData;\n\t\t\tif(clipboardData && clipboardData.items && clipboardData.items.length) {\n\t\t\t\tvar item = list.head(clipboardData.items);\n\t\t\t\tif(item.kind === 'file' && item.type.indexOf('image/') !== -1) {\n\t\t\t\t\tcontext.invoke('editor.insertImagesOrCallback', [item.getAsFile()]);\n\t\t\t\t}\n\t\t\t\tcontext.invoke('editor.afterCommand');\n\t\t\t}\n\t\t};\n\t};\n\n\tvar Dropzone = function(context) {\n\t\tvar $document = $(document);\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar $editable = context.layoutInfo.editable;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tvar $dropzone = $([\n\t\t\t'<div class=\"note-dropzone\">',\n\t\t\t'  <div class=\"note-dropzone-message\"/>',\n\t\t\t'</div>'\n\t\t].join('')).prependTo($editor);\n\n\t\t/**\n\t\t * attach Drag and Drop Events\n\t\t */\n\t\tthis.initialize = function() {\n\t\t\tif(options.disableDragAndDrop) {\n\t\t\t\t// prevent default drop event\n\t\t\t\t$document.on('drop', function(e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.attachDragAndDropEvent();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * attach Drag and Drop Events\n\t\t */\n\t\tthis.attachDragAndDropEvent = function() {\n\t\t\tvar collection = $(),\n\t\t\t\t$dropzoneMessage = $dropzone.find('.note-dropzone-message');\n\n\t\t\t// show dropzone on dragenter when dragging a object to document\n\t\t\t// -but only if the editor is visible, i.e. has a positive width and height\n\t\t\t$document.on('dragenter', function(e) {\n\t\t\t\tvar isCodeview = context.invoke('codeview.isActivated');\n\t\t\t\tvar hasEditorSize = $editor.width() > 0 && $editor.height() > 0;\n\t\t\t\tif(!isCodeview && !collection.length && hasEditorSize) {\n\t\t\t\t\t$editor.addClass('dragover');\n\t\t\t\t\t$dropzone.width($editor.width());\n\t\t\t\t\t$dropzone.height($editor.height());\n\t\t\t\t\t$dropzoneMessage.text(lang.image.dragImageHere);\n\t\t\t\t}\n\t\t\t\tcollection = collection.add(e.target);\n\t\t\t}).on('dragleave', function(e) {\n\t\t\t\tcollection = collection.not(e.target);\n\t\t\t\tif(!collection.length) {\n\t\t\t\t\t$editor.removeClass('dragover');\n\t\t\t\t}\n\t\t\t}).on('drop', function() {\n\t\t\t\tcollection = $();\n\t\t\t\t$editor.removeClass('dragover');\n\t\t\t});\n\n\t\t\t// change dropzone's message on hover.\n\t\t\t$dropzone.on('dragenter', function() {\n\t\t\t\t$dropzone.addClass('hover');\n\t\t\t\t$dropzoneMessage.text(lang.image.dropImage);\n\t\t\t}).on('dragleave', function() {\n\t\t\t\t$dropzone.removeClass('hover');\n\t\t\t\t$dropzoneMessage.text(lang.image.dragImageHere);\n\t\t\t});\n\n\t\t\t// attach dropImage\n\t\t\t$dropzone.on('drop', function(event) {\n\t\t\t\tvar dataTransfer = event.originalEvent.dataTransfer;\n\n\t\t\t\tif(dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t$editable.focus();\n\t\t\t\t\tcontext.invoke('editor.insertImagesOrCallback', dataTransfer.files);\n\t\t\t\t} else {\n\t\t\t\t\t$.each(dataTransfer.types, function(idx, type) {\n\t\t\t\t\t\tvar content = dataTransfer.getData(type);\n\n\t\t\t\t\t\tif(type.toLowerCase().indexOf('text') > -1) {\n\t\t\t\t\t\t\tcontext.invoke('editor.pasteHTML', content);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$(content).each(function() {\n\t\t\t\t\t\t\t\tcontext.invoke('editor.insertNode', this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).on('dragover', false); // prevent default dragover event\n\t\t};\n\t};\n\n\tvar CodeMirror;\n\t//if (agent.hasCodeMirror) {\n\t//  if (agent.isSupportAmd) {\n\t//    require(['codemirror'], function (cm) {\n\t//      CodeMirror = cm;\n\t//    });\n\t//  } else {\n\t//    CodeMirror = window.CodeMirror;\n\t//  }\n\t//}\n\n\t/**\n\t * @class Codeview\n\t */\n\tvar Codeview = function(context) {\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar $editable = context.layoutInfo.editable;\n\t\tvar $codable = context.layoutInfo.codable;\n\t\tvar options = context.options;\n\t\t// update by yujinjin 加入Codeview时动态的监控数据变化，如果不动态的监控数据变化通常直接Codeview完之后数据会存在没有保存进去情况\n\t\t// 定义change事件函数\n\t\tvar textAreaChangFun = function(){\n\t\t\tcontext.triggerEvent('change', dom.value($codable, options.prettifyHtml) || dom.emptyPara, $editable);\n\t\t};\n\t\tthis.sync = function() {\n\t\t\tvar isCodeview = this.isActivated();\n\t\t\tif(isCodeview && agent.hasCodeMirror) {\n\t\t\t\t$codable.data('cmEditor').save();\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @return {Boolean}\n\t\t */\n\t\tthis.isActivated = function() {\n\t\t\treturn $editor.hasClass('codeview');\n\t\t};\n\n\t\t/**\n\t\t * toggle codeview\n\t\t */\n\t\tthis.toggle = function() {\n\t\t\tif(this.isActivated()) {\n\t\t\t\tthis.deactivate();\n\t\t\t} else {\n\t\t\t\tthis.activate();\n\t\t\t}\n\t\t\tcontext.triggerEvent('codeview.toggled');\n\t\t};\n\n\t\t/**\n\t\t * activate code view\n\t\t */\n\t\tthis.activate = function() {\n\t\t\t$codable.val(dom.html($editable, options.prettifyHtml));\n\t\t\t$codable.height($editable.height());\n\n\t\t\tcontext.invoke('toolbar.updateCodeview', true);\n\t\t\t$editor.addClass('codeview');\n\t\t\t$codable.focus();\n\t\t\t// update by yujinjin 加入Codeview时动态的监控数据变化，如果不动态的监控数据变化通常直接Codeview完之后数据会存在没有保存进去情况\n\t\t\t// 绑定change事件函数\n\t\t\t$codable.on(\"change\", textAreaChangFun);\n\t\t\t// activate CodeMirror as codable\n\t\t\tif(agent.hasCodeMirror) {\n\t\t\t\tvar cmEditor = CodeMirror.fromTextArea($codable[0], options.codemirror);\n\n\t\t\t\t// CodeMirror TernServer\n\t\t\t\tif(options.codemirror.tern) {\n\t\t\t\t\tvar server = new CodeMirror.TernServer(options.codemirror.tern);\n\t\t\t\t\tcmEditor.ternServer = server;\n\t\t\t\t\tcmEditor.on('cursorActivity', function(cm) {\n\t\t\t\t\t\tserver.updateArgHints(cm);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// CodeMirror hasn't Padding.\n\t\t\t\tcmEditor.setSize(null, $editable.outerHeight());\n\t\t\t\t$codable.data('cmEditor', cmEditor);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * deactivate code view\n\t\t */\n\t\tthis.deactivate = function() {\n\t\t\t// deactivate CodeMirror as codable\n\t\t\tif(agent.hasCodeMirror) {\n\t\t\t\tvar cmEditor = $codable.data('cmEditor');\n\t\t\t\t$codable.val(cmEditor.getValue());\n\t\t\t\tcmEditor.toTextArea();\n\t\t\t}\n\t\t\t// update by yujinjin 加入Codeview时动态的监控数据变化，如果不动态的监控数据变化通常直接Codeview完之后数据会存在没有保存进去情况\n\t\t\t// 解除绑定change事件函数\n\t\t\t$codable.unbind(\"change\", textAreaChangFun);\n\t\t\tvar value = dom.value($codable, options.prettifyHtml) || dom.emptyPara;\n\t\t\tvar isChange = $editable.html() !== value;\n\n\t\t\t$editable.html(value);\n\t\t\t$editable.height(options.height ? $codable.height() : 'auto');\n\t\t\t$editor.removeClass('codeview');\n\n\t\t\tif(isChange) {\n\t\t\t\tcontext.triggerEvent('change', $editable.html(), $editable);\n\t\t\t}\n\n\t\t\t$editable.focus();\n\n\t\t\tcontext.invoke('toolbar.updateCodeview', false);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tif(this.isActivated()) {\n\t\t\t\tthis.deactivate();\n\t\t\t}\n\t\t};\n\t};\n\n\tvar EDITABLE_PADDING = 24;\n\n\tvar Statusbar = function(context) {\n\t\tvar $document = $(document);\n\t\tvar $statusbar = context.layoutInfo.statusbar;\n\t\tvar $editable = context.layoutInfo.editable;\n\t\tvar options = context.options;\n\n\t\tthis.initialize = function() {\n\t\t\tif(options.airMode || options.disableResizeEditor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$statusbar.on('mousedown', function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\tvar editableTop = $editable.offset().top - $document.scrollTop();\n\n\t\t\t\t$document.on('mousemove', function(event) {\n\t\t\t\t\tvar height = event.clientY - (editableTop + EDITABLE_PADDING);\n\n\t\t\t\t\theight = (options.minheight > 0) ? Math.max(height, options.minheight) : height;\n\t\t\t\t\theight = (options.maxHeight > 0) ? Math.min(height, options.maxHeight) : height;\n\n\t\t\t\t\t$editable.height(height);\n\t\t\t\t}).one('mouseup', function() {\n\t\t\t\t\t$document.off('mousemove');\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\t$statusbar.off();\n\t\t};\n\t};\n\n\tvar Fullscreen = function(context) {\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar $toolbar = context.layoutInfo.toolbar;\n\t\tvar $editable = context.layoutInfo.editable;\n\t\tvar $codable = context.layoutInfo.codable;\n\n\t\tvar $window = $(window);\n\t\tvar $scrollbar = $('html, body');\n\n\t\t/**\n\t\t * toggle fullscreen\n\t\t */\n\t\tthis.toggle = function() {\n\t\t\tvar resize = function(size) {\n\t\t\t\t$editable.css('height', size.h);\n\t\t\t\t$codable.css('height', size.h);\n\t\t\t\tif($codable.data('cmeditor')) {\n\t\t\t\t\t$codable.data('cmeditor').setsize(null, size.h);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t$editor.toggleClass('fullscreen');\n\t\t\tif(this.isFullscreen()) {\n\t\t\t\t$editable.data('orgHeight', $editable.css('height'));\n\n\t\t\t\t$window.on('resize', function() {\n\t\t\t\t\tresize({\n\t\t\t\t\t\th: $window.height() - $toolbar.outerHeight()\n\t\t\t\t\t});\n\t\t\t\t}).trigger('resize');\n\n\t\t\t\t$scrollbar.css('overflow', 'hidden');\n\t\t\t} else {\n\t\t\t\t$window.off('resize');\n\t\t\t\tresize({\n\t\t\t\t\th: $editable.data('orgHeight')\n\t\t\t\t});\n\t\t\t\t$scrollbar.css('overflow', 'visible');\n\t\t\t}\n\n\t\t\tcontext.invoke('toolbar.updateFullscreen', this.isFullscreen());\n\t\t};\n\n\t\tthis.isFullscreen = function() {\n\t\t\treturn $editor.hasClass('fullscreen');\n\t\t};\n\t};\n\n\tvar Handle = function(context) {\n\t\tvar self = this;\n\t\tvar $document = $(document);\n\t\tvar $editingArea = context.layoutInfo.editingArea;\n\t\tvar options = context.options;\n\t\tthis.events = {\n\t\t\t'summernote.mousedown': function(we, e) {\n\t\t\t\tif(self.update(e.target)) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t},\n\t\t\t'summernote.keyup summernote.scroll summernote.change summernote.dialog.shown': function() {\n\t\t\t\tself.update();\n\t\t\t}\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.$handle = $([\n\t\t\t\t'<div class=\"note-handle\">',\n\t\t\t\t'<div class=\"note-control-selection\">',\n\t\t\t\t'<div class=\"note-control-selection-bg\"></div>',\n\t\t\t\t'<div class=\"note-control-holder note-control-nw\"></div>',\n\t\t\t\t'<div class=\"note-control-holder note-control-ne\"></div>',\n\t\t\t\t'<div class=\"note-control-holder note-control-sw\"></div>',\n\t\t\t\t'<div class=\"',\n\t\t\t\t(options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing'),\n\t\t\t\t' note-control-se\"></div>',\n\t\t\t\t(options.disableResizeImage ? '' : '<div class=\"note-control-selection-info\"></div>'),\n\t\t\t\t'</div>',\n\t\t\t\t'</div>'\n\t\t\t].join('')).prependTo($editingArea);\n\n\t\t\tthis.$handle.on('mousedown', function(event) {\n\t\t\t\tif(dom.isControlSizing(event.target)) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tevent.stopPropagation();\n\n\t\t\t\t\tvar $target = self.$handle.find('.note-control-selection').data('target'),\n\t\t\t\t\t\tposStart = $target.offset(),\n\t\t\t\t\t\tscrollTop = $document.scrollTop();\n\n\t\t\t\t\t$document.on('mousemove', function(event) {\n\t\t\t\t\t\tcontext.invoke('editor.resizeTo', {\n\t\t\t\t\t\t\tx: event.clientX - posStart.left,\n\t\t\t\t\t\t\ty: event.clientY - (posStart.top - scrollTop)\n\t\t\t\t\t\t}, $target, !event.shiftKey);\n\n\t\t\t\t\t\tself.update($target[0]);\n\t\t\t\t\t}).one('mouseup', function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t$document.off('mousemove');\n\t\t\t\t\t\tcontext.invoke('editor.afterCommand');\n\t\t\t\t\t});\n\n\t\t\t\t\tif(!$target.data('ratio')) { // original ratio.\n\t\t\t\t\t\t$target.data('ratio', $target.height() / $target.width());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$handle.remove();\n\t\t};\n\n\t\tthis.update = function(target) {\n\t\t\tvar isImage = dom.isImg(target);\n\t\t\tvar $selection = this.$handle.find('.note-control-selection');\n\t\t\tcontext.invoke('imagePopover.update', target);\n\t\t\t\n\t\t\tif(isImage) {\n\t\t\t\tvar $image = $(target);\n\t\t\t\tvar pos = $image.position();\n\n\t\t\t\t// include margin\n\t\t\t\tvar imageSize = {\n\t\t\t\t\tw: $image.outerWidth(true),\n\t\t\t\t\th: $image.outerHeight(true)\n\t\t\t\t};\n\n\t\t\t\t$selection.css({\n\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\tleft: pos.left,\n\t\t\t\t\ttop: pos.top,\n\t\t\t\t\twidth: imageSize.w,\n\t\t\t\t\theight: imageSize.h\n\t\t\t\t}).data('target', $image); // save current image element.\n\n\t\t\t\tvar sizingText = imageSize.w + 'x' + imageSize.h;\n\t\t\t\t$selection.find('.note-control-selection-info').text(sizingText);\n\t\t\t\tcontext.invoke('editor.saveTarget', target);\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\n\t\t\treturn isImage;\n\t\t};\n\n\t\t/**\n\t\t * hide\n\t\t *\n\t\t * @param {jQuery} $handle\n\t\t */\n\t\tthis.hide = function() {\n\t\t\tcontext.invoke('editor.clearTarget');\n\t\t\tthis.$handle.children().hide();\n\t\t};\n\t};\n\n\tvar AutoLink = function(context) {\n\t\tvar self = this;\n\t\tvar defaultScheme = 'http://';\n\t\tvar linkPattern = /^(https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|mailto:[A-Z0-9._%+-]+@)?(www\\.)?(.+)$/i;\n\n\t\tthis.events = {\n\t\t\t'summernote.keyup': function(we, e) {\n\t\t\t\tif(!e.isDefaultPrevented()) {\n\t\t\t\t\tself.handleKeyup(e);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'summernote.keydown': function(we, e) {\n\t\t\t\tself.handleKeydown(e);\n\t\t\t}\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.lastWordRange = null;\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.lastWordRange = null;\n\t\t};\n\n\t\tthis.replace = function() {\n\t\t\tif(!this.lastWordRange) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar keyword = this.lastWordRange.toString();\n\t\t\tvar match = keyword.match(linkPattern);\n\n\t\t\tif(match && (match[1] || match[2])) {\n\t\t\t\tvar link = match[1] ? keyword : defaultScheme + keyword;\n\t\t\t\tvar node = $('<a />').html(keyword).attr('href', link)[0];\n\n\t\t\t\tthis.lastWordRange.insertNode(node);\n\t\t\t\tthis.lastWordRange = null;\n\t\t\t\tcontext.invoke('editor.focus');\n\t\t\t}\n\n\t\t};\n\n\t\tthis.handleKeydown = function(e) {\n\t\t\tif(list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n\t\t\t\tvar wordRange = context.invoke('editor.createRange').getWordRange();\n\t\t\t\tthis.lastWordRange = wordRange;\n\t\t\t}\n\t\t};\n\n\t\tthis.handleKeyup = function(e) {\n\t\t\tif(list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n\t\t\t\tthis.replace();\n\t\t\t}\n\t\t};\n\t};\n\n\t/**\n\t * textarea auto sync.\n\t */\n\tvar AutoSync = function(context) {\n\t\tvar $note = context.layoutInfo.note;\n\n\t\tthis.events = {\n\t\t\t'summernote.change': function() {\n\t\t\t\t$note.val(context.invoke('code'));\n\t\t\t}\n\t\t};\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn dom.isTextarea($note[0]);\n\t\t};\n\t};\n\n\tvar Placeholder = function(context) {\n\t\tvar self = this;\n\t\tvar $editingArea = context.layoutInfo.editingArea;\n\t\tvar options = context.options;\n\n\t\tthis.events = {\n\t\t\t'summernote.init summernote.change': function() {\n\t\t\t\tself.update();\n\t\t\t},\n\t\t\t'summernote.codeview.toggled': function() {\n\t\t\t\tself.update();\n\t\t\t}\n\t\t};\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn !!options.placeholder;\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.$placeholder = $('<div class=\"note-placeholder\">');\n\t\t\tthis.$placeholder.on('click', function() {\n\t\t\t\tcontext.invoke('focus');\n\t\t\t}).text(options.placeholder).prependTo($editingArea);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$placeholder.remove();\n\t\t};\n\n\t\tthis.update = function() {\n\t\t\tvar isShow = !context.invoke('codeview.isActivated') && context.invoke('editor.isEmpty');\n\t\t\tthis.$placeholder.toggle(isShow);\n\t\t};\n\t};\n\n\tvar Buttons = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $toolbar = context.layoutInfo.toolbar;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tvar invertedKeyMap = func.invertObject(options.keyMap[agent.isMac ? 'mac' : 'pc']);\n\n\t\tvar representShortcut = this.representShortcut = function(editorMethod) {\n\t\t\tif(!options.shortcuts) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tvar shortcut = invertedKeyMap[editorMethod];\n\t\t\tif(agent.isMac) {\n\t\t\t\tshortcut = shortcut.replace('CMD', '⌘').replace('SHIFT', '⇧');\n\t\t\t}\n\n\t\t\tshortcut = shortcut.replace('BACKSLASH', '\\\\')\n\t\t\t\t.replace('SLASH', '/')\n\t\t\t\t.replace('LEFTBRACKET', '[')\n\t\t\t\t.replace('RIGHTBRACKET', ']');\n\n\t\t\treturn ' (' + shortcut + ')';\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.addToolbarButtons();\n\t\t\tthis.addImagePopoverButtons();\n\t\t\tthis.addLinkPopoverButtons();\n\t\t\tthis.fontInstalledMap = {};\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tdelete this.fontInstalledMap;\n\t\t};\n\n\t\tthis.isFontInstalled = function(name) {\n\t\t\tif(!self.fontInstalledMap.hasOwnProperty(name)) {\n\t\t\t\tself.fontInstalledMap[name] = agent.isFontInstalled(name) ||\n\t\t\t\t\tlist.contains(options.fontNamesIgnoreCheck, name);\n\t\t\t}\n\n\t\t\treturn self.fontInstalledMap[name];\n\t\t};\n\n\t\tthis.addToolbarButtons = function() {\n\n\t\t\t/**\n\t\t\t * define style buttons\n\t\t\t *\n\t\t\t * styleTags : [item, item, ...]\n\t\t\t *\n\t\t\t * 1. if item is string , convert string to object. and go 2.\n\t\t\t *\n\t\t\t * { tag : item, title : item }\n\t\t\t *\n\t\t\t * 2. if item is object\n\t\t\t *\n\t\t\t * { tag : '', title : '', className : '', style : '', click : callback }\n\t\t\t *\n\t\t\t */\n\t\t\tcontext.memo('button.style', function() {\n\n\t\t\t\treturn ui.dropdownButton({\n\t\t\t\t\ttitle: ui.icon(options.icons.magic),\n\t\t\t\t\tclassName: 'dropdown-style',\n\t\t\t\t\ttooltip: lang.style.style,\n\t\t\t\t\titems: context.options.styleTags,\n\t\t\t\t\ttemplate: function(item) {\n\n\t\t\t\t\t\tif(typeof item === 'string') {\n\t\t\t\t\t\t\titem = {\n\t\t\t\t\t\t\t\ttag: item,\n\t\t\t\t\t\t\t\ttitle: item\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar tag = item.tag;\n\t\t\t\t\t\tvar title = item.title || tag;\n\t\t\t\t\t\tvar style = item.style ? ' style=\"' + item.style + '\" ' : '';\n\t\t\t\t\t\tvar className = item.className ? ' class=\"' + item.className + '\"' : '';\n\n\t\t\t\t\t\treturn '<' + tag + style + className + '>' + title + '</' + tag + '>';\n\t\t\t\t\t},\n\t\t\t\t\titemClick: context.createInvokeHandler('editor.formatBlock')\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tcontext.memo('button.bold', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.bold),\n\t\t\t\t\ttooltip: lang.font.bold + representShortcut('bold'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.bold')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.italic', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.italic),\n\t\t\t\t\ttooltip: lang.font.italic + representShortcut('italic'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.italic')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.underline', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.underline),\n\t\t\t\t\ttooltip: lang.font.underline + representShortcut('underline'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.underline')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.clear', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.eraser),\n\t\t\t\t\ttooltip: lang.font.clear + representShortcut('removeFormat'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.removeFormat')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.strikethrough', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.strikethrough),\n\t\t\t\t\ttooltip: lang.font.strikethrough + representShortcut('strikethrough'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.strikethrough')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.superscript', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.superscript),\n\t\t\t\t\ttooltip: lang.font.superscript,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.superscript')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.subscript', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.subscript),\n\t\t\t\t\ttooltip: lang.font.subscript,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.subscript')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.fontname', function() {\n\t\t\t\treturn ui.dropdownCheckButton({\n\t\t\t\t\ttitle: '<span class=\"note-current-fontname\"/>',\n\t\t\t\t\tclassName: 'dropdown-fontname',\n\t\t\t\t\ttooltip: lang.font.name,\n\t\t\t\t\tcheckClassName: options.icons.menuCheck,\n\t\t\t\t\titems: options.fontNames.filter(self.isFontInstalled),\n\t\t\t\t\ttemplate: function(item) {\n\t\t\t\t\t\treturn '<span style=\"font-family:' + item + '\">' + item + '</span>';\n\t\t\t\t\t},\n\t\t\t\t\titemClick: context.createInvokeHandler('editor.fontName')\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcontext.memo('button.fontsize', function() {\n\t\t\t\treturn ui.dropdownCheckButton({\n\t\t\t\t\ttitle: '<span class=\"note-current-fontsize\"/>',\n\t\t\t\t\tclassName: 'dropdown-fontsize',\n\t\t\t\t\ttooltip: lang.font.size,\n\t\t\t\t\tcheckClassName: options.icons.menuCheck,\n\t\t\t\t\titems: options.fontSizes,\n\t\t\t\t\ttemplate: function(item) {\n\t\t\t\t\t\treturn '<span style=\"font-family:' + item + '\">' + item + '</span>';\n\t\t\t\t\t},\n\t\t\t\t\titemClick: context.createInvokeHandler('editor.fontSize')\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tvar createColorButton = function(type) {\n\t\t\t\treturn ui.colorDropdownButton({\n\t\t\t\t\ttitle: ui.icon(options.icons.font + ' note-recent-color'),\n\t\t\t\t\tlang: lang,\n\t\t\t\t\tcurrentClick: function(e) {\n\t\t\t\t\t\tvar $button = $(e.currentTarget);\n\n\t\t\t\t\t\tcontext.invoke('editor.color', {\n\t\t\t\t\t\t\tbackColor: $button.attr('data-backColor'),\n\t\t\t\t\t\t\tforeColor: $button.attr('data-foreColor')\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tcolors: options.colors,\n\t\t\t\t\titemClick: function(eventName, value) {\n\t\t\t\t\t\tcontext.invoke('editor.' + eventName, value);\n\t\t\t\t\t}\n\t\t\t\t}, type || '');\n\t\t\t};\n\n\t\t\tcontext.memo('button.color', function() {\n\t\t\t\treturn createColorButton();\n\t\t\t});\n\n\t\t\tcontext.memo('button.ul', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.unorderedlist),\n\t\t\t\t\ttooltip: lang.lists.unordered + representShortcut('insertUnorderedList'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.insertUnorderedList')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.ol', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.orderedlist),\n\t\t\t\t\ttooltip: lang.lists.ordered + representShortcut('insertOrderedList'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.insertOrderedList')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tvar justifyLeft = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.alignLeft),\n\t\t\t\ttooltip: lang.paragraph.left + representShortcut('justifyLeft'),\n\t\t\t\tclick: context.createInvokeHandler('editor.justifyLeft')\n\t\t\t});\n\n\t\t\tvar justifyCenter = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.alignCenter),\n\t\t\t\ttooltip: lang.paragraph.center + representShortcut('justifyCenter'),\n\t\t\t\tclick: context.createInvokeHandler('editor.justifyCenter')\n\t\t\t});\n\n\t\t\tvar justifyRight = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.alignRight),\n\t\t\t\ttooltip: lang.paragraph.right + representShortcut('justifyRight'),\n\t\t\t\tclick: context.createInvokeHandler('editor.justifyRight')\n\t\t\t});\n\n\t\t\tvar justifyFull = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.alignJustify),\n\t\t\t\ttooltip: lang.paragraph.justify + representShortcut('justifyFull'),\n\t\t\t\tclick: context.createInvokeHandler('editor.justifyFull')\n\t\t\t});\n\n\t\t\tvar outdent = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.outdent),\n\t\t\t\ttooltip: lang.paragraph.outdent + representShortcut('outdent'),\n\t\t\t\tclick: context.createInvokeHandler('editor.outdent')\n\t\t\t});\n\n\t\t\tvar indent = ui.button({\n\t\t\t\tcontents: ui.icon(options.icons.indent),\n\t\t\t\ttooltip: lang.paragraph.indent + representShortcut('indent'),\n\t\t\t\tclick: context.createInvokeHandler('editor.indent')\n\t\t\t});\n\n\t\t\tcontext.memo('button.justifyLeft', func.invoke(justifyLeft, 'render'));\n\t\t\tcontext.memo('button.justifyCenter', func.invoke(justifyCenter, 'render'));\n\t\t\tcontext.memo('button.justifyRight', func.invoke(justifyRight, 'render'));\n\t\t\tcontext.memo('button.justifyFull', func.invoke(justifyFull, 'render'));\n\t\t\tcontext.memo('button.outdent', func.invoke(outdent, 'render'));\n\t\t\tcontext.memo('button.indent', func.invoke(indent, 'render'));\n\n\t\t\tcontext.memo('button.paragraph', function() {\n\t\t\t\treturn ui.paragraphDropdownButton({\n\t\t\t\t\ttitle: ui.icon(options.icons.alignLeft),\n\t\t\t\t\ttooltip: lang.paragraph.paragraph,\n\t\t\t\t\titems: [\n\t\t\t\t\t\t[justifyLeft, justifyCenter, justifyRight, justifyFull],\n\t\t\t\t\t\t[outdent, indent]\n\t\t\t\t\t]\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tcontext.memo('button.height', function() {\n\t\t\t\treturn ui.dropdownCheckButton({\n\t\t\t\t\ttitle: ui.icon(options.icons.textHeight),\n\t\t\t\t\tclassName: 'dropdown-line-height',\n\t\t\t\t\ttooltip: lang.font.height,\n\t\t\t\t\titems: options.lineHeights,\n\t\t\t\t\tcheckClassName: options.icons.menuCheck,\n\t\t\t\t\titemClick: context.createInvokeHandler('editor.lineHeight')\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tcontext.memo('button.table', function() {\n\n\t\t\t\treturn ui.tableDropdownButton({\n\t\t\t\t\ttitle: ui.icon(options.icons.table),\n\t\t\t\t\ttooltip: lang.table.table,\n\t\t\t\t\tcol: options.insertTableMaxSize.col,\n\t\t\t\t\trow: options.insertTableMaxSize.row,\n\t\t\t\t\titemClick: context.createInvokeHandler('editor.insertTable')\n\t\t\t\t});\n\n\t\t\t});\n\n\t\t\tcontext.memo('button.link', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.link),\n\t\t\t\t\ttooltip: lang.link.link + representShortcut('linkDialog.show'),\n\t\t\t\t\tclick: context.createInvokeHandler('linkDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.picture', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.picture),\n\t\t\t\t\ttooltip: lang.image.image,\n\t\t\t\t\tclick: context.createInvokeHandler('imageDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.video', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.video),\n\t\t\t\t\ttooltip: lang.video.video,\n\t\t\t\t\tclick: context.createInvokeHandler('videoDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.hr', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.minus),\n\t\t\t\t\ttooltip: lang.hr.insert + representShortcut('insertHorizontalRule'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.insertHorizontalRule')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.fullscreen', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.arrowsAlt),\n\t\t\t\t\ttooltip: lang.options.fullscreen,\n\t\t\t\t\tclick: context.createInvokeHandler('fullscreen.toggle')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.codeview', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.code),\n\t\t\t\t\ttooltip: lang.options.codeview,\n\t\t\t\t\tclick: context.createInvokeHandler('codeview.toggle')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.redo', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.redo),\n\t\t\t\t\ttooltip: lang.history.redo + representShortcut('redo'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.redo')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.undo', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.undo),\n\t\t\t\t\ttooltip: lang.history.undo + representShortcut('undo'),\n\t\t\t\t\tclick: context.createInvokeHandler('editor.undo')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.help', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.question),\n\t\t\t\t\ttooltip: lang.options.help,\n\t\t\t\t\tclick: context.createInvokeHandler('helpDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * image: [\n\t\t *   ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n\t\t *   ['float', ['floatLeft', 'floatRight', 'floatNone' ]],\n\t\t *   ['remove', ['removeMedia']]\n\t\t * ],\n\t\t */\n\t\tthis.addImagePopoverButtons = function() {\n\t\t\t// Image Size Buttons\n\t\t\tcontext.memo('button.imageSize100', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: '<span class=\"note-fontsize-10\">100%</span>',\n\t\t\t\t\ttooltip: lang.image.resizeFull,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.resize', '1')\n\t\t\t\t}).render();\n\t\t\t});\n\t\t\tcontext.memo('button.imageSize50', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: '<span class=\"note-fontsize-10\">50%</span>',\n\t\t\t\t\ttooltip: lang.image.resizeHalf,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.resize', '0.5')\n\t\t\t\t}).render();\n\t\t\t});\n\t\t\tcontext.memo('button.imageSize25', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: '<span class=\"note-fontsize-10\">25%</span>',\n\t\t\t\t\ttooltip: lang.image.resizeQuarter,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.resize', '0.25')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\t// Float Buttons\n\t\t\tcontext.memo('button.floatLeft', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.alignLeft),\n\t\t\t\t\ttooltip: lang.image.floatLeft,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.floatMe', 'left')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.floatRight', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.alignRight),\n\t\t\t\t\ttooltip: lang.image.floatRight,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.floatMe', 'right')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.floatNone', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.alignJustify),\n\t\t\t\t\ttooltip: lang.image.floatNone,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.floatMe', 'none')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\t//update by yujinjin 图片加入链接\n\t\t\tcontext.memo('button.linkImgDialogShow', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.link),\n\t\t\t\t\ttooltip: lang.link.edit,\n\t\t\t\t\tclick: context.createInvokeHandler('linkImgDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\t//update by yujinjin 图片加入删除链接\n\t\t\tcontext.memo('button.unlink', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.unlink),\n\t\t\t\t\ttooltip: lang.link.unlink,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.unlink')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\t// Remove Buttons\n\t\t\tcontext.memo('button.removeMedia', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.trash),\n\t\t\t\t\ttooltip: lang.image.remove,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.removeMedia')\n\t\t\t\t}).render();\n\t\t\t});\n\t\t};\n\n\t\tthis.addLinkPopoverButtons = function() {\n\t\t\tcontext.memo('button.linkDialogShow', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.link),\n\t\t\t\t\ttooltip: lang.link.edit,\n\t\t\t\t\tclick: context.createInvokeHandler('linkDialog.show')\n\t\t\t\t}).render();\n\t\t\t});\n\n\t\t\tcontext.memo('button.unlink', function() {\n\t\t\t\treturn ui.button({\n\t\t\t\t\tcontents: ui.icon(options.icons.unlink),\n\t\t\t\t\ttooltip: lang.link.unlink,\n\t\t\t\t\tclick: context.createInvokeHandler('editor.unlink')\n\t\t\t\t}).render();\n\t\t\t});\n\t\t};\n\n\t\tthis.build = function($container, groups) {\n\t\t\tfor(var groupIdx = 0, groupLen = groups.length; groupIdx < groupLen; groupIdx++) {\n\t\t\t\tvar group = groups[groupIdx];\n\t\t\t\tvar groupName = group[0];\n\t\t\t\tvar buttons = group[1];\n\n\t\t\t\tvar $group = ui.buttonGroup({\n\t\t\t\t\tclassName: 'note-' + groupName\n\t\t\t\t}).render();\n\n\t\t\t\tfor(var idx = 0, len = buttons.length; idx < len; idx++) {\n\t\t\t\t\tvar button = context.memo('button.' + buttons[idx]);\n\t\t\t\t\tif(button) {\n\t\t\t\t\t\t// create button and then add class note-btn-xxx\n\t\t\t\t\t\tvar buttonObject = typeof button === 'function' ? button(context) : button;\n\t\t\t\t\t\tvar $btn = $(buttonObject).addClass('note-btn-' + buttons[idx]);\n\t\t\t\t\t\t$group.append($btn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$group.appendTo($container);\n\t\t\t}\n\t\t};\n\n\t\tthis.updateCurrentStyle = function() {\n\t\t\tvar styleInfo = context.invoke('editor.currentStyle');\n\n\t\t\tthis.updateBtnStates({\n\t\t\t\t'.note-btn-bold': function() {\n\t\t\t\t\treturn styleInfo['font-bold'] === 'bold';\n\t\t\t\t},\n\t\t\t\t'.note-btn-italic': function() {\n\t\t\t\t\treturn styleInfo['font-italic'] === 'italic';\n\t\t\t\t},\n\t\t\t\t'.note-btn-underline': function() {\n\t\t\t\t\treturn styleInfo['font-underline'] === 'underline';\n\t\t\t\t},\n\t\t\t\t'.note-btn-subscript': function() {\n\t\t\t\t\treturn styleInfo['font-subscript'] === 'subscript';\n\t\t\t\t},\n\t\t\t\t'.note-btn-superscript': function() {\n\t\t\t\t\treturn styleInfo['font-superscript'] === 'superscript';\n\t\t\t\t},\n\t\t\t\t'.note-btn-strikethrough': function() {\n\t\t\t\t\treturn styleInfo['font-strikethrough'] === 'strikethrough';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif(styleInfo['font-family']) {\n\t\t\t\tvar fontNames = styleInfo['font-family'].split(',').map(function(name) {\n\t\t\t\t\treturn name.replace(/[\\'\\\"]/g, '')\n\t\t\t\t\t\t.replace(/\\s+$/, '')\n\t\t\t\t\t\t.replace(/^\\s+/, '');\n\t\t\t\t});\n\t\t\t\tvar fontName = list.find(fontNames, self.isFontInstalled);\n\t\t\t\tui.check($toolbar.find('.dropdown-fontname'), fontName);\n\t\t\t\t$toolbar.find('.note-current-fontname').text(fontName).css({\n\t\t\t\t\t'font-family': fontName\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif(styleInfo['font-size']) {\n\t\t\t\tvar fontSize = styleInfo['font-size'];\n\t\t\t\tui.check($toolbar.find('.dropdown-fontsize'), fontSize);\n\t\t\t\t$toolbar.find('.note-current-fontsize').text(fontSize);\n\t\t\t}\n\n\t\t\tif(styleInfo['line-height']) {\n\t\t\t\tvar lineHeight = styleInfo['line-height'];\n\t\t\t\tui.check($toolbar.find('.dropdown-line-height'), lineHeight);\n\t\t\t}\n\t\t};\n\n\t\tthis.updateBtnStates = function(infos) {\n\t\t\t$.each(infos, function(selector, pred) {\n\t\t\t\tui.toggleBtnActive($toolbar.find(selector), pred());\n\t\t\t});\n\t\t};\n\t};\n\n\tvar Toolbar = function(context) {\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $note = context.layoutInfo.note;\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar $toolbar = context.layoutInfo.toolbar;\n\t\tvar options = context.options;\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn !options.airMode;\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\toptions.toolbar = options.toolbar || [];\n\n\t\t\tif(!options.toolbar.length) {\n\t\t\t\t$toolbar.hide();\n\t\t\t} else {\n\t\t\t\tcontext.invoke('buttons.build', $toolbar, options.toolbar);\n\t\t\t}\n\n\t\t\tthis.changeContainer(false);\n\n\t\t\t$note.on('summernote.keyup summernote.mouseup summernote.change', function() {\n\t\t\t\tcontext.invoke('buttons.updateCurrentStyle');\n\t\t\t});\n\n\t\t\tcontext.invoke('buttons.updateCurrentStyle');\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\t$toolbar.children().remove();\n\t\t};\n\n\t\tthis.changeContainer = function(isFullscreen) {\n\t\t\tif(isFullscreen) {\n\t\t\t\t$toolbar.prependTo($editor);\n\t\t\t} else {\n\t\t\t\tif(options.toolbarContainer) {\n\t\t\t\t\t$toolbar.appendTo(options.toolbarContainer);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.updateFullscreen = function(isFullscreen) {\n\t\t\tui.toggleBtnActive($toolbar.find('.note-btn-fullscreen'), isFullscreen);\n\n\t\t\tthis.changeContainer(isFullscreen);\n\t\t};\n\n\t\tthis.updateCodeview = function(isCodeview) {\n\t\t\tui.toggleBtnActive($toolbar.find('.note-btn-codeview'), isCodeview);\n\t\t\tif(isCodeview) {\n\t\t\t\tthis.deactivate();\n\t\t\t} else {\n\t\t\t\tthis.activate();\n\t\t\t}\n\t\t};\n\n\t\tthis.activate = function(isIncludeCodeview) {\n\t\t\tvar $btn = $toolbar.find('button');\n\t\t\tif(!isIncludeCodeview) {\n\t\t\t\t$btn = $btn.not('.note-btn-codeview');\n\t\t\t}\n\t\t\tui.toggleBtn($btn, true);\n\t\t};\n\n\t\tthis.deactivate = function(isIncludeCodeview) {\n\t\t\tvar $btn = $toolbar.find('button');\n\t\t\tif(!isIncludeCodeview) {\n\t\t\t\t$btn = $btn.not('.note-btn-codeview');\n\t\t\t}\n\t\t\tui.toggleBtn($btn, false);\n\t\t};\n\t};\n\n\tvar LinkDialog = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tthis.initialize = function() {\n\t\t\tvar $container = options.dialogsInBody ? $(document.body) : $editor;\n\n\t\t\tthis.$dialog = ui.linkDialog({\n\t\t\t\tlang: lang,\n\t\t\t\tdisableLinkTarget: options.disableLinkTarget,\n\t\t\t\tfade: options.dialogsFade\n\t\t\t});\n\t\t\tthis.$dialog.appendTo($container);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tui.hideDialog(this.$dialog);\n\t\t\tthis.$dialog.remove();\n\t\t};\n\n\t\tthis.bindEnterKey = function($input, $btn) {\n\t\t\t$input.on('keypress', function(event) {\n\t\t\t\tif(event.keyCode === key.code.ENTER) {\n\t\t\t\t\t$btn.trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Show link dialog and set event handlers on dialog controls.\n\t\t *\n\t\t * @param {Object} linkInfo\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.showLinkDialog = function(linkInfo) {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tvar $linkText = self.$dialog.find('.note-link-text'),\n\t\t\t\t\t$linkUrl = self.$dialog.find('.note-link-url'),\n\t\t\t\t\t$linkBtn = self.$dialog.find('.note-link-btn'),\n\t\t\t\t\t$openInNewWindow = self.$dialog.find('input[type=checkbox]');\n\t\t\t\tui.onDialogShown(self.$dialog, function() {\n\t\t\t\t\tcontext.triggerEvent('dialog.shown');\n\n\t\t\t\t\t$linkText.val(linkInfo.text);\n\n\t\t\t\t\t$linkText.on('input', function() {\n\t\t\t\t\t\tui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\n\t\t\t\t\t\t// if linktext was modified by keyup,\n\t\t\t\t\t\t// stop cloning text from linkUrl\n\t\t\t\t\t\tlinkInfo.text = $linkText.val();\n\t\t\t\t\t});\n\n\t\t\t\t\t// if no url was given, copy text to url\n\t\t\t\t\tif(!linkInfo.url) {\n\t\t\t\t\t\tlinkInfo.url = linkInfo.text || 'http://';\n\t\t\t\t\t\tui.toggleBtn($linkBtn, linkInfo.text);\n\t\t\t\t\t}\n\n\t\t\t\t\t$linkUrl.on('input', function() {\n\t\t\t\t\t\t//update by yujinjin BUG修复\n\t\t\t\t\t\t// display same link on `Text to display` input\n\t\t\t\t\t\t// when create a new link\n\t\t\t\t\t\tif(!linkInfo.text) {\n\t\t\t\t\t\t\t$linkText.val($linkUrl.val());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\n\t\t\t\t\t}).val(linkInfo.url).trigger('focus');\n\n\t\t\t\t\tself.bindEnterKey($linkUrl, $linkBtn);\n\t\t\t\t\tself.bindEnterKey($linkText, $linkBtn);\n\n\t\t\t\t\t$openInNewWindow.prop('checked', linkInfo.isNewWindow);\n\n\t\t\t\t\t$linkBtn.one('click', function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tdeferred.resolve({\n\t\t\t\t\t\t\trange: linkInfo.range,\n\t\t\t\t\t\t\turl: $linkUrl.val(),\n\t\t\t\t\t\t\ttext: $linkText.val(),\n\t\t\t\t\t\t\tisNewWindow: $openInNewWindow.is(':checked')\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// update by yujinjin 修复插入链接之后隐藏dialog BUG问题\n\t\t\t\t\t\t//self.$dialog.modal('hide');\n\t\t\t\t\t\tui.hideDialog(self.$dialog);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tui.onDialogHidden(self.$dialog, function() {\n\t\t\t\t\t// detach events\n\t\t\t\t\t$linkText.off('input keypress');\n\t\t\t\t\t$linkUrl.off('input keypress');\n\t\t\t\t\t$linkBtn.off('click');\n\n\t\t\t\t\tif(deferred.state() === 'pending') {\n\t\t\t\t\t\tdeferred.reject();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tui.showDialog(self.$dialog);\n\t\t\t}).promise();\n\t\t};\n\n\t\t/**\n\t\t * @param {Object} layoutInfo\n\t\t */\n\t\tthis.show = function() {\n\t\t\tvar linkInfo = context.invoke('editor.getLinkInfo');\n\n\t\t\tcontext.invoke('editor.saveRange');\n\t\t\tthis.showLinkDialog(linkInfo).then(function(linkInfo) {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t\tcontext.invoke('editor.createLink', linkInfo);\n\t\t\t}).fail(function() {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t});\n\t\t};\n\t\tcontext.memo('help.linkDialog.show', options.langInfo.help['linkDialog.show']);\n\t};\n\n\tvar LinkPopover = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar options = context.options;\n\n\t\tthis.events = {\n\t\t\t'summernote.keyup summernote.mouseup summernote.change summernote.scroll': function() {\n\t\t\t\tself.update();\n\t\t\t},\n\t\t\t'summernote.dialog.shown': function() {\n\t\t\t\tself.hide();\n\t\t\t}\n\t\t};\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn !list.isEmpty(options.popover.link);\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.$popover = ui.popover({\n\t\t\t\tclassName: 'note-link-popover',\n\t\t\t\tcallback: function($node) {\n\t\t\t\t\tvar $content = ui.getPopoverContent($node);\n\t\t\t\t\t$content.prepend('<span><a target=\"_blank\"></a>&nbsp;</span>');\n\t\t\t\t}\n\t\t\t}).render().appendTo('body');\n\t\t\tvar $content = ui.getPopoverContent(this.$popover);\n\n\t\t\tcontext.invoke('buttons.build', $content, options.popover.link);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$popover.remove();\n\t\t};\n\n\t\tthis.update = function() {\n\t\t\t// Prevent focusing on editable when invoke('code') is executed\n\t\t\tif(!context.invoke('editor.hasFocus')) {\n\t\t\t\tthis.hide();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar rng = context.invoke('editor.createRange');\n\t\t\tif(rng.isCollapsed() && rng.isOnAnchor()) {\n\t\t\t\tvar anchor = dom.ancestor(rng.sc, dom.isAnchor);\n\t\t\t\t//update by yujin 如果链接内部只是图片就不要显示该popover\n\t\t\t\tif(!$(anchor).text() && $(anchor).children(\"img\").length > 0){\n\t\t\t\t\tthis.hide();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar href = $(anchor).attr('href');\n\t\t\t\tthis.$popover.find('a').attr('href', href).html(href);\n\n\t\t\t\tvar pos = dom.posFromPlaceholder(anchor);\n\t\t\t\tthis.$popover.css({\n\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\tleft: pos.left,\n\t\t\t\t\ttop: pos.top\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\n\t\tthis.hide = function() {\n\t\t\tthis.$popover.hide();\n\t\t};\n\t};\n\n\t// update by yujinjin 图片加入链接弹窗\n\tvar LinkImgDialog = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tthis.initialize = function() {\n\t\t\tvar $container = options.dialogsInBody ? $(document.body) : $editor;\n\n\t\t\tthis.$dialog = ui.linkImgDialog({\n\t\t\t\tlang: lang,\n\t\t\t\tdisableLinkTarget: options.disableLinkTarget,\n\t\t\t\tfade: options.dialogsFade\n\t\t\t});\n\t\t\tthis.$dialog.appendTo($container);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tui.hideDialog(this.$dialog);\n\t\t\tthis.$dialog.remove();\n\t\t};\n\n\t\tthis.bindEnterKey = function($input, $btn) {\n\t\t\t$input.on('keypress', function(event) {\n\t\t\t\tif(event.keyCode === key.code.ENTER) {\n\t\t\t\t\t$btn.trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Show link dialog and set event handlers on dialog controls.\n\t\t *\n\t\t * @param {Object} linkImgInfo\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.showLinkImgDialog = function(linkImgInfo) {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tvar $linkUrl = self.$dialog.find('.note-link-url'),\n\t\t\t\t\t$linkBtn = self.$dialog.find('.note-link-btn'),\n\t\t\t\t\t$openInNewWindow = self.$dialog.find('input[type=checkbox]');\n\t\t\t\tui.onDialogShown(self.$dialog, function() {\n\t\t\t\t\tcontext.triggerEvent('dialog.shown');\n\t\t\t\t\t// if no url was given, copy text to url\n\t\t\t\t\tif(!linkImgInfo.url) {\n\t\t\t\t\t\tlinkImgInfo.url = 'http://';\n\t\t\t\t\t\tui.toggleBtn($linkBtn, linkImgInfo.url);\n\t\t\t\t\t}\n\n\t\t\t\t\t$linkUrl.on('input', function() {\n\t\t\t\t\t\tui.toggleBtn($linkBtn, $linkUrl.val());\n\t\t\t\t\t}).val(linkImgInfo.url).trigger('focus');\n\n\t\t\t\t\tself.bindEnterKey($linkUrl, $linkBtn);\n\n\t\t\t\t\t$openInNewWindow.prop('checked', linkImgInfo.isNewWindow);\n\n\t\t\t\t\t$linkBtn.one('click', function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tdeferred.resolve({\n\t\t\t\t\t\t\ttarget: linkImgInfo.target,\n\t\t\t\t\t\t\turl: $linkUrl.val(),\n\t\t\t\t\t\t\tisNewWindow: $openInNewWindow.is(':checked')\n\t\t\t\t\t\t});\n\t\t\t\t\t\tui.hideDialog(self.$dialog);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tui.onDialogHidden(self.$dialog, function() {\n\t\t\t\t\t// detach events\n\t\t\t\t\t$linkUrl.off('input keypress');\n\t\t\t\t\t$linkBtn.off('click');\n\n\t\t\t\t\tif(deferred.state() === 'pending') {\n\t\t\t\t\t\tdeferred.reject();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tui.showDialog(self.$dialog);\n\t\t\t}).promise();\n\t\t};\n\n\t\t/**\n\t\t * @param {Object} layoutInfo\n\t\t */\n\t\tthis.show = function() {\n\t\t\tcontext.invoke('editor.saveRange');\n\t\t\tvar linkImgInfo = context.invoke('editor.getLinkImgInfo');\n\t\t\t\n\t\t\tthis.showLinkImgDialog(linkImgInfo).then(function(linkImgInfo) {\n\t\t\t\tcontext.invoke('editor.restoreRange');\r\n\t\t\t\tcontext.invoke('editor.createLinkImg', linkImgInfo);\n\t\t\t}).fail(function() {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t});\n\t\t};\n\t};\n\n\tvar ImageDialog = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tthis.initialize = function() {\n\t\t\tvar $container = options.dialogsInBody ? $(document.body) : $editor;\n\n\t\t\tvar imageLimitation = '';\n\t\t\tif(options.maximumImageFileSize) {\n\t\t\t\tvar unit = Math.floor(Math.log(options.maximumImageFileSize) / Math.log(1024));\n\t\t\t\tvar readableSize = (options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +\n\t\t\t\t\t' ' + ' KMGTP' [unit] + 'B';\n\t\t\t\timageLimitation = '<small>' + lang.image.maximumFileSize + ' : ' + readableSize + '</small>';\n\t\t\t}\n\n\t\t\tthis.$dialog = ui.imageDialog({\n\t\t\t\timageLimitation: imageLimitation,\n\t\t\t\tlang: lang,\n\t\t\t\tfade: options.dialogsFade\n\t\t\t});\n\n\t\t\tthis.$dialog.appendTo($container);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tui.hideDialog(this.$dialog);\n\t\t\tthis.$dialog.remove();\n\t\t};\n\n\t\tthis.bindEnterKey = function($input, $btn) {\n\t\t\t$input.on('keypress', function(event) {\n\t\t\t\tif(event.keyCode === key.code.ENTER) {\n\t\t\t\t\t$btn.trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.show = function() {\n\t\t\tcontext.invoke('editor.saveRange');\n\t\t\tthis.showImageDialog().then(function(data, linkInfo) {\n\t\t\t\t// [workaround] hide dialog before restore range for IE range focus\n\t\t\t\tui.hideDialog(self.$dialog);\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t\tif(typeof data === 'string') { // image url\n\t\t\t\t\tcontext.invoke('editor.insertImage', data, null, linkInfo);\n\t\t\t\t} else { // array of files\n\t\t\t\t\tcontext.invoke('editor.insertImagesOrCallback', data, linkInfo);\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * show image dialog\n\t\t *\n\t\t * @param {jQuery} $dialog\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.showImageDialog = function() {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tvar $imageInput = self.$dialog.find('.note-image-input'),\n\t\t\t\t\t$imageLinkUrl = self.$dialog.find('.note-link-url'),\n\t\t\t\t\t$imageUrl = self.$dialog.find('.note-image-url'),\n\t\t\t\t\t$imageBtn = self.$dialog.find('.note-image-btn'),\n\t\t\t\t\t$openInNewWindow = self.$dialog.find('input[type=checkbox]');\n\n\t\t\t\tui.onDialogShown(self.$dialog, function() {\n\t\t\t\t\tcontext.triggerEvent('dialog.shown');\n\n\t\t\t\t\t// Cloning imageInput to clear element.\n\t\t\t\t\t$imageInput.replaceWith($imageInput.clone()\n\t\t\t\t\t\t.on('change', function() {\n\t\t\t\t\t\t\tdeferred.resolve(this.files || this.value, {url: $imageLinkUrl.val()===\"http://\" ? \"\": $imageLinkUrl.val(), isNewWindow: $openInNewWindow.is(':checked')});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.val('')\n\t\t\t\t\t);\n\n\t\t\t\t\t$imageBtn.click(function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\tdeferred.resolve($imageUrl.val(), {url: $imageLinkUrl.val()===\"http://\" ? \"\": $imageLinkUrl.val(), isNewWindow: $openInNewWindow.is(':checked')});\n\t\t\t\t\t});\n\n\t\t\t\t\t$imageUrl.on('keyup paste', function() {\n\t\t\t\t\t\tvar url = $imageUrl.val();\n\t\t\t\t\t\tui.toggleBtn($imageBtn, url);\n\t\t\t\t\t}).val('').trigger('focus');\n\t\t\t\t\tself.bindEnterKey($imageUrl, $imageBtn);\n\t\t\t\t});\n\n\t\t\t\tui.onDialogHidden(self.$dialog, function() {\n\t\t\t\t\t$imageInput.off('change');\n\t\t\t\t\t$imageUrl.off('keyup paste keypress');\n\t\t\t\t\t$imageBtn.off('click');\n\n\t\t\t\t\tif(deferred.state() === 'pending') {\n\t\t\t\t\t\tdeferred.reject();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tui.showDialog(self.$dialog);\n\t\t\t});\n\t\t};\n\t};\n\n\tvar ImagePopover = function(context) {\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar options = context.options;\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn !list.isEmpty(options.popover.image);\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.$popover = ui.popover({\n\t\t\t\tclassName: 'note-image-popover'\n\t\t\t}).render().appendTo('body');\n\t\t\tvar $content = ui.getPopoverContent(this.$popover);\n\n\t\t\tcontext.invoke('buttons.build', $content, options.popover.image);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$popover.remove();\n\t\t};\n\n\t\tthis.update = function(target) {\n\t\t\tif(dom.isImg(target)) {\n\t\t\t\tvar pos = dom.posFromPlaceholder(target);\n\t\t\t\tthis.$popover.css({\n\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\tleft: pos.left,\n\t\t\t\t\ttop: pos.top\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\n\t\tthis.hide = function() {\n\t\t\tthis.$popover.hide();\n\t\t};\n\t};\n\n\tvar VideoDialog = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tthis.initialize = function() {\n\t\t\tvar $container = options.dialogsInBody ? $(document.body) : $editor;\n\n\t\t\tthis.$dialog = ui.videoDialog({\n\t\t\t\tlang: lang,\n\t\t\t\tfade: options.dialogsFade\n\t\t\t});\n\t\t\tthis.$dialog.appendTo($container);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tui.hideDialog(this.$dialog);\n\t\t\tthis.$dialog.remove();\n\t\t};\n\n\t\tthis.bindEnterKey = function($input, $btn) {\n\t\t\t$input.on('keypress', function(event) {\n\t\t\t\tif(event.keyCode === key.code.ENTER) {\n\t\t\t\t\t$btn.trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tthis.createVideoNode = function(url) {\n\t\t\t// video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)\n\t\t\tvar ytRegExp = /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\n\t\t\tvar ytMatch = url.match(ytRegExp);\n\n\t\t\tvar igRegExp = /\\/\\/instagram.com\\/p\\/(.[a-zA-Z0-9_-]*)/;\n\t\t\tvar igMatch = url.match(igRegExp);\n\n\t\t\tvar vRegExp = /\\/\\/vine.co\\/v\\/(.[a-zA-Z0-9]*)/;\n\t\t\tvar vMatch = url.match(vRegExp);\n\n\t\t\tvar vimRegExp = /\\/\\/(player.)?vimeo.com\\/([a-z]*\\/)*([0-9]{6,11})[?]?.*/;\n\t\t\tvar vimMatch = url.match(vimRegExp);\n\n\t\t\tvar dmRegExp = /.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/;\n\t\t\tvar dmMatch = url.match(dmRegExp);\n\n\t\t\tvar youkuRegExp = /\\/\\/v\\.youku\\.com\\/v_show\\/id_(\\w+)=*\\.html/;\n\t\t\tvar youkuMatch = url.match(youkuRegExp);\n\n\t\t\tvar mp4RegExp = /^.+.(mp4|m4v)$/;\n\t\t\tvar mp4Match = url.match(mp4RegExp);\n\n\t\t\tvar oggRegExp = /^.+.(ogg|ogv)$/;\n\t\t\tvar oggMatch = url.match(oggRegExp);\n\n\t\t\tvar webmRegExp = /^.+.(webm)$/;\n\t\t\tvar webmMatch = url.match(webmRegExp);\n\n\t\t\tvar $video;\n\t\t\tif(ytMatch && ytMatch[1].length === 11) {\n\t\t\t\tvar youtubeId = ytMatch[1];\n\t\t\t\t$video = $('<iframe>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('src', '//www.youtube.com/embed/' + youtubeId)\n\t\t\t\t\t.attr('width', '640').attr('height', '360');\n\t\t\t} else if(igMatch && igMatch[0].length) {\n\t\t\t\t$video = $('<iframe>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('src', igMatch[0] + '/embed/')\n\t\t\t\t\t.attr('width', '612').attr('height', '710')\n\t\t\t\t\t.attr('scrolling', 'no')\n\t\t\t\t\t.attr('allowtransparency', 'true');\n\t\t\t} else if(vMatch && vMatch[0].length) {\n\t\t\t\t$video = $('<iframe>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('src', vMatch[0] + '/embed/simple')\n\t\t\t\t\t.attr('width', '600').attr('height', '600')\n\t\t\t\t\t.attr('class', 'vine-embed');\n\t\t\t} else if(vimMatch && vimMatch[3].length) {\n\t\t\t\t$video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('src', '//player.vimeo.com/video/' + vimMatch[3])\n\t\t\t\t\t.attr('width', '640').attr('height', '360');\n\t\t\t} else if(dmMatch && dmMatch[2].length) {\n\t\t\t\t$video = $('<iframe>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2])\n\t\t\t\t\t.attr('width', '640').attr('height', '360');\n\t\t\t} else if(youkuMatch && youkuMatch[1].length) {\n\t\t\t\t$video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n\t\t\t\t\t.attr('frameborder', 0)\n\t\t\t\t\t.attr('height', '498')\n\t\t\t\t\t.attr('width', '510')\n\t\t\t\t\t.attr('src', '//player.youku.com/embed/' + youkuMatch[1]);\n\t\t\t} else if(mp4Match || oggMatch || webmMatch) {\n\t\t\t\t$video = $('<video controls>')\n\t\t\t\t\t.attr('src', url)\n\t\t\t\t\t.attr('width', '640').attr('height', '360');\n\t\t\t} else {\n\t\t\t\t// this is not a known video link. Now what, Cat? Now what?\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$video.addClass('note-video-clip');\n\n\t\t\treturn $video[0];\n\t\t};\n\n\t\tthis.show = function() {\n\t\t\tvar text = context.invoke('editor.getSelectedText');\n\t\t\tcontext.invoke('editor.saveRange');\n\t\t\tthis.showVideoDialog(text).then(function(url) {\n\t\t\t\t// [workaround] hide dialog before restore range for IE range focus\n\t\t\t\tui.hideDialog(self.$dialog);\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\n\t\t\t\t// build node\n\t\t\t\tvar $node = self.createVideoNode(url);\n\n\t\t\t\tif($node) {\n\t\t\t\t\t// insert video node\n\t\t\t\t\tcontext.invoke('editor.insertNode', $node);\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * show image dialog\n\t\t *\n\t\t * @param {jQuery} $dialog\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.showVideoDialog = function(text) {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tvar $videoUrl = self.$dialog.find('.note-video-url'),\n\t\t\t\t\t$videoBtn = self.$dialog.find('.note-video-btn');\n\n\t\t\t\tui.onDialogShown(self.$dialog, function() {\n\t\t\t\t\tcontext.triggerEvent('dialog.shown');\n\n\t\t\t\t\t$videoUrl.val(text).on('input', function() {\n\t\t\t\t\t\tui.toggleBtn($videoBtn, $videoUrl.val());\n\t\t\t\t\t}).trigger('focus');\n\n\t\t\t\t\t$videoBtn.click(function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\tdeferred.resolve($videoUrl.val());\n\t\t\t\t\t});\n\n\t\t\t\t\tself.bindEnterKey($videoUrl, $videoBtn);\n\t\t\t\t});\n\n\t\t\t\tui.onDialogHidden(self.$dialog, function() {\n\t\t\t\t\t$videoUrl.off('input');\n\t\t\t\t\t$videoBtn.off('click');\n\n\t\t\t\t\tif(deferred.state() === 'pending') {\n\t\t\t\t\t\tdeferred.reject();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tui.showDialog(self.$dialog);\n\t\t\t});\n\t\t};\n\t};\n\n\tvar HelpDialog = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar $editor = context.layoutInfo.editor;\n\t\tvar options = context.options;\n\t\tvar lang = options.langInfo;\n\n\t\tthis.createShortCutList = function() {\n\t\t\tvar keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n\t\t\treturn Object.keys(keyMap).map(function(key) {\n\t\t\t\tvar command = keyMap[key];\n\t\t\t\tvar $row = $('<div><div class=\"help-list-item\"/></div>');\n\t\t\t\t$row.find('.help-list-item').append($('<label><kbd>' + key + '</kbd></label>').css({\n\t\t\t\t\t'width': 180,\n\t\t\t\t\t'margin-right': 10\n\t\t\t\t})).append($('<span/>').html(context.memo('help.' + command) || command));\n\t\t\t\treturn $row.html();\n\t\t\t}).join('');\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tvar $container = options.dialogsInBody ? $(document.body) : $editor;\n\n\t\t\tvar body = [\n\t\t\t\t'<p class=\"text-center\">',\n\t\t\t\t'<a href=\"http://summernote.org/\" target=\"_blank\">Summernote 0.8.1</a> · ',\n\t\t\t\t'<a href=\"https://github.com/summernote/summernote\" target=\"_blank\">Project</a> · ',\n\t\t\t\t'<a href=\"https://github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>',\n\t\t\t\t'</p>'\n\t\t\t].join('');\n\n\t\t\tthis.$dialog = ui.dialog({\n\t\t\t\ttitle: lang.options.help,\n\t\t\t\tfade: options.dialogsFade,\n\t\t\t\tbody: this.createShortCutList(),\n\t\t\t\tfooter: body,\n\t\t\t\tcallback: function($node) {\n\t\t\t\t\tui.getDialogBody($node).css({\n\t\t\t\t\t\t'max-height': 300,\n\t\t\t\t\t\t'overflow-y': 'auto'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).render().appendTo($container);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tui.hideDialog(this.$dialog);\n\t\t\tthis.$dialog.remove();\n\t\t};\n\n\t\t/**\n\t\t * show help dialog\n\t\t *\n\t\t * @return {Promise}\n\t\t */\n\t\tthis.showHelpDialog = function() {\n\t\t\treturn $.Deferred(function(deferred) {\n\t\t\t\tui.onDialogShown(self.$dialog, function() {\n\t\t\t\t\tcontext.triggerEvent('dialog.shown');\n\t\t\t\t\tdeferred.resolve();\n\t\t\t\t});\n\t\t\t\tui.showDialog(self.$dialog);\n\t\t\t}).promise();\n\t\t};\n\n\t\tthis.show = function() {\n\t\t\tcontext.invoke('editor.saveRange');\n\t\t\tthis.showHelpDialog().then(function() {\n\t\t\t\tcontext.invoke('editor.restoreRange');\n\t\t\t});\n\t\t};\n\t};\n\n\tvar AirPopover = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar options = context.options;\n\n\t\tvar AIR_MODE_POPOVER_X_OFFSET = 20;\n\n\t\tthis.events = {\n\t\t\t'summernote.keyup summernote.mouseup summernote.scroll': function() {\n\t\t\t\tself.update();\n\t\t\t},\n\t\t\t'summernote.change summernote.dialog.shown': function() {\n\t\t\t\tself.hide();\n\t\t\t},\n\t\t\t'summernote.focusout': function(we, e) {\n\t\t\t\t// [workaround] Firefox doesn't support relatedTarget on focusout\n\t\t\t\t//  - Ignore hide action on focus out in FF.\n\t\t\t\tif(agent.isFF) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif(!e.relatedTarget || !dom.ancestor(e.relatedTarget, func.eq(self.$popover[0]))) {\n\t\t\t\t\tself.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn options.airMode && !list.isEmpty(options.popover.air);\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.$popover = ui.popover({\n\t\t\t\tclassName: 'note-air-popover'\n\t\t\t}).render().appendTo('body');\n\t\t\tvar $content = ui.getPopoverContent(this.$popover);\n\n\t\t\tcontext.invoke('buttons.build', $content, options.popover.air);\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$popover.remove();\n\t\t};\n\n\t\tthis.update = function() {\n\t\t\tvar styleInfo = context.invoke('editor.currentStyle');\n\t\t\tif(styleInfo.range && !styleInfo.range.isCollapsed()) {\n\t\t\t\tvar rect = list.last(styleInfo.range.getClientRects());\n\t\t\t\tif(rect) {\n\t\t\t\t\tvar bnd = func.rect2bnd(rect);\n\t\t\t\t\tthis.$popover.css({\n\t\t\t\t\t\tdisplay: 'block',\n\t\t\t\t\t\tleft: Math.max(bnd.left + bnd.width / 2, 0) - AIR_MODE_POPOVER_X_OFFSET,\n\t\t\t\t\t\ttop: bnd.top + bnd.height\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\n\t\tthis.hide = function() {\n\t\t\tthis.$popover.hide();\n\t\t};\n\t};\n\n\tvar HintPopover = function(context) {\n\t\tvar self = this;\n\t\tvar ui = $.summernote.ui;\n\n\t\tvar POPOVER_DIST = 5;\n\t\tvar hint = context.options.hint || [];\n\t\tvar direction = context.options.hintDirection || 'bottom';\n\t\tvar hints = $.isArray(hint) ? hint : [hint];\n\n\t\tthis.events = {\n\t\t\t'summernote.keyup': function(we, e) {\n\t\t\t\tif(!e.isDefaultPrevented()) {\n\t\t\t\t\tself.handleKeyup(e);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'summernote.keydown': function(we, e) {\n\t\t\t\tself.handleKeydown(e);\n\t\t\t},\n\t\t\t'summernote.dialog.shown': function() {\n\t\t\t\tself.hide();\n\t\t\t}\n\t\t};\n\n\t\tthis.shouldInitialize = function() {\n\t\t\treturn hints.length > 0;\n\t\t};\n\n\t\tthis.initialize = function() {\n\t\t\tthis.lastWordRange = null;\n\t\t\tthis.$popover = ui.popover({\n\t\t\t\tclassName: 'note-hint-popover',\n\t\t\t\thideArrow: true,\n\t\t\t\tdirection: ''\n\t\t\t}).render().appendTo('body');\n\n\t\t\tthis.$popover.hide();\n\n\t\t\tthis.$content = ui.getPopoverContent(this.$popover);\n\n\t\t\tthis.$content.on('click', '.note-hint-item', function() {\n\t\t\t\tself.$content.find('.active').removeClass('active');\n\t\t\t\t$(this).addClass('active');\n\t\t\t\tself.replace();\n\t\t\t});\n\t\t};\n\n\t\tthis.destroy = function() {\n\t\t\tthis.$popover.remove();\n\t\t};\n\n\t\tthis.selectItem = function($item) {\n\t\t\tthis.$content.find('.active').removeClass('active');\n\t\t\t$item.addClass('active');\n\n\t\t\tthis.$content[0].scrollTop = $item[0].offsetTop - (this.$content.innerHeight() / 2);\n\t\t};\n\n\t\tthis.moveDown = function() {\n\t\t\tvar $current = this.$content.find('.note-hint-item.active');\n\t\t\tvar $next = $current.next();\n\n\t\t\tif($next.length) {\n\t\t\t\tthis.selectItem($next);\n\t\t\t} else {\n\t\t\t\tvar $nextGroup = $current.parent().next();\n\n\t\t\t\tif(!$nextGroup.length) {\n\t\t\t\t\t$nextGroup = this.$content.find('.note-hint-group').first();\n\t\t\t\t}\n\n\t\t\t\tthis.selectItem($nextGroup.find('.note-hint-item').first());\n\t\t\t}\n\t\t};\n\n\t\tthis.moveUp = function() {\n\t\t\tvar $current = this.$content.find('.note-hint-item.active');\n\t\t\tvar $prev = $current.prev();\n\n\t\t\tif($prev.length) {\n\t\t\t\tthis.selectItem($prev);\n\t\t\t} else {\n\t\t\t\tvar $prevGroup = $current.parent().prev();\n\n\t\t\t\tif(!$prevGroup.length) {\n\t\t\t\t\t$prevGroup = this.$content.find('.note-hint-group').last();\n\t\t\t\t}\n\n\t\t\t\tthis.selectItem($prevGroup.find('.note-hint-item').last());\n\t\t\t}\n\t\t};\n\n\t\tthis.replace = function() {\n\t\t\tvar $item = this.$content.find('.note-hint-item.active');\n\n\t\t\tif($item.length) {\n\t\t\t\tvar node = this.nodeFromItem($item);\n\t\t\t\tthis.lastWordRange.insertNode(node);\n\t\t\t\trange.createFromNode(node).collapse().select();\n\n\t\t\t\tthis.lastWordRange = null;\n\t\t\t\tthis.hide();\n\t\t\t\tcontext.invoke('editor.focus');\n\t\t\t}\n\n\t\t};\n\n\t\tthis.nodeFromItem = function($item) {\n\t\t\tvar hint = hints[$item.data('index')];\n\t\t\tvar item = $item.data('item');\n\t\t\tvar node = hint.content ? hint.content(item) : item;\n\t\t\tif(typeof node === 'string') {\n\t\t\t\tnode = dom.createText(node);\n\t\t\t}\n\t\t\treturn node;\n\t\t};\n\n\t\tthis.createItemTemplates = function(hintIdx, items) {\n\t\t\tvar hint = hints[hintIdx];\n\t\t\treturn items.map(function(item, idx) {\n\t\t\t\tvar $item = $('<div class=\"note-hint-item\"/>');\n\t\t\t\t$item.append(hint.template ? hint.template(item) : item + '');\n\t\t\t\t$item.data({\n\t\t\t\t\t'index': hintIdx,\n\t\t\t\t\t'item': item\n\t\t\t\t});\n\n\t\t\t\tif(hintIdx === 0 && idx === 0) {\n\t\t\t\t\t$item.addClass('active');\n\t\t\t\t}\n\t\t\t\treturn $item;\n\t\t\t});\n\t\t};\n\n\t\tthis.handleKeydown = function(e) {\n\t\t\tif(!this.$popover.is(':visible')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif(e.keyCode === key.code.ENTER) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.replace();\n\t\t\t} else if(e.keyCode === key.code.UP) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.moveUp();\n\t\t\t} else if(e.keyCode === key.code.DOWN) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.moveDown();\n\t\t\t}\n\t\t};\n\n\t\tthis.searchKeyword = function(index, keyword, callback) {\n\t\t\tvar hint = hints[index];\n\t\t\tif(hint && hint.match.test(keyword) && hint.search) {\n\t\t\t\tvar matches = hint.match.exec(keyword);\n\t\t\t\thint.search(matches[1], callback);\n\t\t\t} else {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t};\n\n\t\tthis.createGroup = function(idx, keyword) {\n\t\t\tvar $group = $('<div class=\"note-hint-group note-hint-group-' + idx + '\"/>');\n\t\t\tthis.searchKeyword(idx, keyword, function(items) {\n\t\t\t\titems = items || [];\n\t\t\t\tif(items.length) {\n\t\t\t\t\t$group.html(self.createItemTemplates(idx, items));\n\t\t\t\t\tself.show();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn $group;\n\t\t};\n\n\t\tthis.handleKeyup = function(e) {\n\t\t\tif(list.contains([key.code.ENTER, key.code.UP, key.code.DOWN], e.keyCode)) {\n\t\t\t\tif(e.keyCode === key.code.ENTER) {\n\t\t\t\t\tif(this.$popover.is(':visible')) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar wordRange = context.invoke('editor.createRange').getWordRange();\n\t\t\t\tvar keyword = wordRange.toString();\n\t\t\t\tif(hints.length && keyword) {\n\t\t\t\t\tthis.$content.empty();\n\n\t\t\t\t\tvar bnd = func.rect2bnd(list.last(wordRange.getClientRects()));\n\t\t\t\t\tif(bnd) {\n\n\t\t\t\t\t\tthis.$popover.hide();\n\n\t\t\t\t\t\tthis.lastWordRange = wordRange;\n\n\t\t\t\t\t\thints.forEach(function(hint, idx) {\n\t\t\t\t\t\t\tif(hint.match.test(keyword)) {\n\t\t\t\t\t\t\t\tself.createGroup(idx, keyword).appendTo(self.$content);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// set position for popover after group is created\n\t\t\t\t\t\tif(direction === 'top') {\n\t\t\t\t\t\t\tthis.$popover.css({\n\t\t\t\t\t\t\t\tleft: bnd.left,\n\t\t\t\t\t\t\t\ttop: bnd.top - this.$popover.outerHeight() - POPOVER_DIST\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.$popover.css({\n\t\t\t\t\t\t\t\tleft: bnd.left,\n\t\t\t\t\t\t\t\ttop: bnd.top + bnd.height + POPOVER_DIST\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.show = function() {\n\t\t\tthis.$popover.show();\n\t\t};\n\n\t\tthis.hide = function() {\n\t\t\tthis.$popover.hide();\n\t\t};\n\t};\n\n\t$.summernote = $.extend($.summernote, {\n\t\tversion: '0.8.1',\n\t\tui: ui,\n\n\t\tplugins: {},\n\n\t\toptions: {\n\t\t\tmodules: {\n\t\t\t\t'editor': Editor,\n\t\t\t\t'clipboard': Clipboard,\n\t\t\t\t'dropzone': Dropzone,\n\t\t\t\t'codeview': Codeview,\n\t\t\t\t'statusbar': Statusbar,\n\t\t\t\t'fullscreen': Fullscreen,\n\t\t\t\t'handle': Handle,\n\t\t\t\t// FIXME: HintPopover must be front of autolink\n\t\t\t\t//  - Script error about range when Enter key is pressed on hint popover\n\t\t\t\t'hintPopover': HintPopover,\n\t\t\t\t'autoLink': AutoLink,\n\t\t\t\t'autoSync': AutoSync,\n\t\t\t\t'placeholder': Placeholder,\n\t\t\t\t'buttons': Buttons,\n\t\t\t\t'toolbar': Toolbar,\n\t\t\t\t'linkDialog': LinkDialog,\n\t\t\t\t'linkImgDialog': LinkImgDialog,\n\t\t\t\t'linkPopover': LinkPopover,\n\t\t\t\t'imageDialog': ImageDialog,\n\t\t\t\t'imagePopover': ImagePopover,\n\t\t\t\t'videoDialog': VideoDialog,\n\t\t\t\t'helpDialog': HelpDialog,\n\t\t\t\t'airPopover': AirPopover\n\t\t\t},\n\n\t\t\tbuttons: {},\n\n\t\t\tlang: 'en-US',\n\n\t\t\t// toolbar\n\t\t\ttoolbar: [\n\t\t\t\t['style', ['style']],\n\t\t\t\t['font', ['bold', 'underline', 'clear']],\n\t\t\t\t['fontname', ['fontname']],\n\t\t\t\t['fontsize', ['fontsize']],\n\t\t\t\t['color', ['color']],\n\t\t\t\t['para', ['ul', 'ol', 'paragraph']],\n\t\t\t\t['table', ['table']],\n\t\t\t\t['insert', ['link', 'picture', 'video']],\n\t\t\t\t['view', ['fullscreen', 'codeview', 'help']]\n\t\t\t],\n\n\t\t\t// popover\n\t\t\tpopover: {\n\t\t\t\timage: [\n\t\t\t\t\t['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n\t\t\t\t\t['float', ['floatLeft', 'floatRight', 'floatNone']],\n\t\t\t\t\t['link', ['linkImgDialogShow', 'unlink']],\n\t\t\t\t\t['remove', ['removeMedia']]\n\t\t\t\t],\n\t\t\t\tlink: [\n\t\t\t\t\t['link', ['linkDialogShow', 'unlink']]\n\t\t\t\t],\n\t\t\t\tair: [\n\t\t\t\t\t['color', ['color']],\n\t\t\t\t\t['font', ['bold', 'underline', 'clear']],\n\t\t\t\t\t['para', ['ul', 'paragraph']],\n\t\t\t\t\t['table', ['table']],\n\t\t\t\t\t['insert', ['link', 'picture']]\n\t\t\t\t]\n\t\t\t},\n\n\t\t\t// air mode: inline editor\n\t\t\tairMode: false,\n\n\t\t\twidth: null,\n\t\t\theight: null,\n\n\t\t\tfocus: false,\n\t\t\ttabSize: 4,\n\t\t\tstyleWithSpan: true,\n\t\t\tshortcuts: true,\n\t\t\ttextareaAutoSync: true,\n\t\t\tdirection: null,\n\n\t\t\tstyleTags: ['p', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n\t\t\tfontNames: [\n\t\t\t\t'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',\n\t\t\t\t'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',\n\t\t\t\t'Tahoma', 'Times New Roman', 'Verdana'\n\t\t\t],\n\n\t\t\tfontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],\n\n\t\t\t// pallete colors(n x n)\n\t\t\tcolors: [\n\t\t\t\t['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'],\n\t\t\t\t['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],\n\t\t\t\t['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],\n\t\t\t\t['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],\n\t\t\t\t['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],\n\t\t\t\t['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],\n\t\t\t\t['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],\n\t\t\t\t['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']\n\t\t\t],\n\n\t\t\tlineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],\n\n\t\t\ttableClassName: 'table table-bordered',\n\n\t\t\tinsertTableMaxSize: {\n\t\t\t\tcol: 10,\n\t\t\t\trow: 10\n\t\t\t},\n\n\t\t\tdialogsInBody: false,\n\t\t\tdialogsFade: false,\n\n\t\t\tmaximumImageFileSize: null,\n\n\t\t\tcallbacks: {\n\t\t\t\tonInit: null,\n\t\t\t\tonFocus: null,\n\t\t\t\tonBlur: null,\n\t\t\t\tonEnter: null,\n\t\t\t\tonKeyup: null,\n\t\t\t\tonKeydown: null,\n\t\t\t\tonSubmit: null,\n\t\t\t\tonImageUpload: null,\n\t\t\t\tonImageUploadError: null\n\t\t\t},\n\n\t\t\tcodemirror: {\n\t\t\t\tmode: 'text/html',\n\t\t\t\thtmlMode: true,\n\t\t\t\tlineNumbers: true\n\t\t\t},\n\n\t\t\tkeyMap: {\n\t\t\t\tpc: {\n\t\t\t\t\t'ENTER': 'insertParagraph',\n\t\t\t\t\t'CTRL+Z': 'undo',\n\t\t\t\t\t'CTRL+Y': 'redo',\n\t\t\t\t\t'TAB': 'tab',\n\t\t\t\t\t'SHIFT+TAB': 'untab',\n\t\t\t\t\t'CTRL+B': 'bold',\n\t\t\t\t\t'CTRL+I': 'italic',\n\t\t\t\t\t'CTRL+U': 'underline',\n\t\t\t\t\t'CTRL+SHIFT+S': 'strikethrough',\n\t\t\t\t\t'CTRL+BACKSLASH': 'removeFormat',\n\t\t\t\t\t'CTRL+SHIFT+L': 'justifyLeft',\n\t\t\t\t\t'CTRL+SHIFT+E': 'justifyCenter',\n\t\t\t\t\t'CTRL+SHIFT+R': 'justifyRight',\n\t\t\t\t\t'CTRL+SHIFT+J': 'justifyFull',\n\t\t\t\t\t'CTRL+SHIFT+NUM7': 'insertUnorderedList',\n\t\t\t\t\t'CTRL+SHIFT+NUM8': 'insertOrderedList',\n\t\t\t\t\t'CTRL+LEFTBRACKET': 'outdent',\n\t\t\t\t\t'CTRL+RIGHTBRACKET': 'indent',\n\t\t\t\t\t'CTRL+NUM0': 'formatPara',\n\t\t\t\t\t'CTRL+NUM1': 'formatH1',\n\t\t\t\t\t'CTRL+NUM2': 'formatH2',\n\t\t\t\t\t'CTRL+NUM3': 'formatH3',\n\t\t\t\t\t'CTRL+NUM4': 'formatH4',\n\t\t\t\t\t'CTRL+NUM5': 'formatH5',\n\t\t\t\t\t'CTRL+NUM6': 'formatH6',\n\t\t\t\t\t'CTRL+ENTER': 'insertHorizontalRule',\n\t\t\t\t\t'CTRL+K': 'linkDialog.show'\n\t\t\t\t},\n\n\t\t\t\tmac: {\n\t\t\t\t\t'ENTER': 'insertParagraph',\n\t\t\t\t\t'CMD+Z': 'undo',\n\t\t\t\t\t'CMD+SHIFT+Z': 'redo',\n\t\t\t\t\t'TAB': 'tab',\n\t\t\t\t\t'SHIFT+TAB': 'untab',\n\t\t\t\t\t'CMD+B': 'bold',\n\t\t\t\t\t'CMD+I': 'italic',\n\t\t\t\t\t'CMD+U': 'underline',\n\t\t\t\t\t'CMD+SHIFT+S': 'strikethrough',\n\t\t\t\t\t'CMD+BACKSLASH': 'removeFormat',\n\t\t\t\t\t'CMD+SHIFT+L': 'justifyLeft',\n\t\t\t\t\t'CMD+SHIFT+E': 'justifyCenter',\n\t\t\t\t\t'CMD+SHIFT+R': 'justifyRight',\n\t\t\t\t\t'CMD+SHIFT+J': 'justifyFull',\n\t\t\t\t\t'CMD+SHIFT+NUM7': 'insertUnorderedList',\n\t\t\t\t\t'CMD+SHIFT+NUM8': 'insertOrderedList',\n\t\t\t\t\t'CMD+LEFTBRACKET': 'outdent',\n\t\t\t\t\t'CMD+RIGHTBRACKET': 'indent',\n\t\t\t\t\t'CMD+NUM0': 'formatPara',\n\t\t\t\t\t'CMD+NUM1': 'formatH1',\n\t\t\t\t\t'CMD+NUM2': 'formatH2',\n\t\t\t\t\t'CMD+NUM3': 'formatH3',\n\t\t\t\t\t'CMD+NUM4': 'formatH4',\n\t\t\t\t\t'CMD+NUM5': 'formatH5',\n\t\t\t\t\t'CMD+NUM6': 'formatH6',\n\t\t\t\t\t'CMD+ENTER': 'insertHorizontalRule',\n\t\t\t\t\t'CMD+K': 'linkDialog.show'\n\t\t\t\t}\n\t\t\t},\n\t\t\ticons: {\n\t\t\t\t'align': 'note-icon-align',\n\t\t\t\t'alignCenter': 'note-icon-align-center',\n\t\t\t\t'alignJustify': 'note-icon-align-justify',\n\t\t\t\t'alignLeft': 'note-icon-align-left',\n\t\t\t\t'alignRight': 'note-icon-align-right',\n\t\t\t\t'indent': 'note-icon-align-indent',\n\t\t\t\t'outdent': 'note-icon-align-outdent',\n\t\t\t\t'arrowsAlt': 'note-icon-arrows-alt',\n\t\t\t\t'bold': 'note-icon-bold',\n\t\t\t\t'caret': 'note-icon-caret',\n\t\t\t\t'circle': 'note-icon-circle',\n\t\t\t\t'close': 'note-icon-close',\n\t\t\t\t'code': 'note-icon-code',\n\t\t\t\t'eraser': 'note-icon-eraser',\n\t\t\t\t'font': 'note-icon-font',\n\t\t\t\t'frame': 'note-icon-frame',\n\t\t\t\t'italic': 'note-icon-italic',\n\t\t\t\t'link': 'note-icon-link',\n\t\t\t\t'unlink': 'note-icon-chain-broken',\n\t\t\t\t'magic': 'note-icon-magic',\n\t\t\t\t'menuCheck': 'note-icon-menu-check',\n\t\t\t\t'minus': 'note-icon-minus',\n\t\t\t\t'orderedlist': 'note-icon-orderedlist',\n\t\t\t\t'pencil': 'note-icon-pencil',\n\t\t\t\t'picture': 'note-icon-picture',\n\t\t\t\t'question': 'note-icon-question',\n\t\t\t\t'redo': 'note-icon-redo',\n\t\t\t\t'square': 'note-icon-square',\n\t\t\t\t'strikethrough': 'note-icon-strikethrough',\n\t\t\t\t'subscript': 'note-icon-subscript',\n\t\t\t\t'superscript': 'note-icon-superscript',\n\t\t\t\t'table': 'note-icon-table',\n\t\t\t\t'textHeight': 'note-icon-text-height',\n\t\t\t\t'trash': 'note-icon-trash',\n\t\t\t\t'underline': 'note-icon-underline',\n\t\t\t\t'undo': 'note-icon-undo',\n\t\t\t\t'unorderedlist': 'note-icon-unorderedlist',\n\t\t\t\t'video': 'note-icon-video'\n\t\t\t}\n\t\t}\n\t});\n\n}));"],"sourceRoot":""}