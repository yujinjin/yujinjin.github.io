"use strict";(self["webpackChunkvue_manager_system"]=self["webpackChunkvue_manager_system"]||[]).push([[560],{3157:function(e,t,a){var s=a(4803),l=a(141);t.A={login(e,t){return(0,s.A)(Object.assign({url:"/system/login",data:e},t||{}))},sendValidateCode(e,t){return(0,s.A)(Object.assign({url:"/system/sendValidateCode",data:e,method:"POST"},t||{}))},queryUnreadMessages(e){return(0,s.A)(Object.assign({url:"/system/queryUnreadMessages",method:"GET"},e||{}))},queryLoginUserMenus(e){return(0,s.A)(Object.assign({url:"/system/queryLoginUserMenus",method:"GET"},e||{}))},updateLoginPassword(e,t){return(0,s.A)(Object.assign({url:"/system/updateLoginPassword",data:e},t||{}))},updateLoginUserInfo(e,t){return(0,s.A)(Object.assign({url:"/system/updateLoginUserInfo",data:e},t||{}))},queryPageModuleList(e,t){return(0,s.A)(Object.assign({url:"/system/queryPageModuleList",params:e,method:"GET"},t||{}))},queryModuleList(e,t){return(0,s.A)(Object.assign({url:"/system/queryModuleList",params:e,method:"GET"},t||{}))},addOrUpdateModule(e,t){return(0,s.A)(Object.assign({url:"/system/addOrUpdateModule",data:e},t||{}))},deleteModuleById(e,t){return(0,s.A)(Object.assign({url:"/system/deleteModuleById",data:{id:e}},t||{}))},queryPageMenuList(e,t){return(0,s.A)(Object.assign({url:"/system/queryPageMenuList",params:e,method:"GET"},t||{}))},queryMenuList(e,t){return(0,s.A)(Object.assign({url:"/system/queryMenuList",params:e,method:"GET"},t||{}))},addOrUpdateMenu(e,t){return(0,s.A)(Object.assign({url:"/system/addOrUpdateMenu",data:e},t||{}))},toggleMenuLockStatus(e,t){return(0,s.A)(Object.assign({url:"/system/updateMenuLockStatus",data:e},t||{}))},queryRoleListByMenuId(e,t){return(0,s.A)(Object.assign({url:"/system/queryRoleListByMenuId",params:e,method:"GET"},t||{}))},deleteMenu(e,t){return(0,s.A)(Object.assign({url:"/system/deleteMenu",data:e},t||{}))},uploadMenusExcel(e,t){return l.A.upload({file:e},"/system/uploadMenusExcel",t)},batchInsertMenus(e,t){return(0,s.A)(Object.assign({url:"/system/batchInsertMenus",data:e},t||{}))},queryPageRoleList(e,t){return(0,s.A)(Object.assign({url:"/system/queryPageRoleList",params:e,method:"GET"},t||{}))},queryRoleList(e,t){return(0,s.A)(Object.assign({url:"/system/queryRoleList",params:e,method:"GET"},t||{}))},queryMenuListByRoleId(e,t){return(0,s.A)(Object.assign({url:"/system/queryMenuListByRoleId",params:e,method:"GET"},t||{}))},addOrUpdateRole(e,t){return(0,s.A)(Object.assign({url:"/system/addOrUpdateRole",data:e},t||{}))},toggleRoleLockStatus(e,t){return(0,s.A)(Object.assign({url:"/system/updateRoleLockStatus",data:e},t||{}))},updateMenusByRoleId(e,t){return(0,s.A)(Object.assign({url:"/system/updateMenusByRoleId",data:e},t||{}))},deleteRole(e,t){return(0,s.A)(Object.assign({url:"/system/deleteRole",data:e},t||{}))},uploadRolesExcel(e,t){return l.A.upload({file:e},"/system/uploadRolesExcel",t)},batchInsertRoles(e,t){return(0,s.A)(Object.assign({url:"/system/batchInsertRoles",data:e},t||{}))},queryPageUserList(e,t){return(0,s.A)(Object.assign({url:"/system/queryPageUserList",method:"GET",params:e},t||{}))},queryRoleListByUserId(e,t){return(0,s.A)(Object.assign({url:"/system/queryRoleListByUserId",params:e,method:"GET"},t||{}))},addOrUpdateUser(e,t){return(0,s.A)(Object.assign({url:"/system/addOrUpdateUser",data:e},t||{}))},updateRoleListByUserId(e,t){return(0,s.A)(Object.assign({url:"/system/updateRoleListByUserId",data:e},t||{}))},deleteUser(e,t){return(0,s.A)(Object.assign({url:"/system/deleteUser",data:e},t||{}))},toggleUserLockStatus(e,t){return(0,s.A)(Object.assign({url:"/system/updateUserLockStatus",data:e},t||{}))},resetUerPassword(e,t){return(0,s.A)(Object.assign({url:"/system/resetUerPassword",data:e},t||{}))},uploadUsersExcel(e,t){return l.A.upload({file:e},"/system/uploadUsersExcel",t)},batchInsertUers(e,t){return(0,s.A)(Object.assign({url:"/system/batchInsertUers",data:e},t||{}))},queryPageMessageList(e,t){return(0,s.A)(Object.assign({url:"/system/queryPageMessageList",params:e,method:"GET"},t||{}))},insertMessage(e,t){return(0,s.A)(Object.assign({url:"/system/sendMessage",data:e},t||{}))}}},4094:function(e,t,a){a.d(t,{A:function(){return d}});var s=a(641),l=a(953);const o={class:"virtually-progress"},n={class:"tips-text"};var r=(0,s.pM)({__name:"virtually-progress",props:{finished:{type:Boolean,default:!1},ratio:{type:Number,default:.1,validator:function(e){return e<1&&e>0}},time:{type:Number,default:500},progress:{type:Object,default:function(){return{}}}},emits:["afterFinished"],setup(e,{emit:t}){const a=e,r=t,u=(0,l.KR)(0);let i=0;(0,s.wB)((()=>a.finished),(e=>{e||c()}));const d=(0,s.EW)((()=>Object.assign({textInside:!0,strokeWidth:26},a.progress))),c=function(){u.value=0,i&&window.clearInterval(i);let e=a.ratio,t=0;i=window.setInterval((()=>{if(++t,100===u.value)return window.clearInterval(i),i=0,void r("afterFinished");u.value>95&&a.finished?u.value=100:(e=a.finished?1:u.value>80?2*a.ratio:a.ratio*(t%10),u.value=parseInt((u.value+(99-u.value)*e*Math.random()).toFixed(4),10))}),a.time)};return(0,s.sV)((()=>{c()})),(0,s.hi)((()=>{i&&window.clearInterval(i)})),(e,t)=>{const a=(0,s.g2)("el-progress");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(a,(0,s.v6)(d.value,{percentage:u.value}),null,16,["percentage"]),(0,s.Lk)("div",n,[(0,s.RG)(e.$slots,"default")])])}}}),u=a(6262);const i=(0,u.A)(r,[["__scopeId","data-v-97ea7fae"]]);var d=i},6560:function(e,t,a){a.r(t),a.d(t,{default:function(){return re}});var s=a(641),l=a(33),o=a(953),n=a(7918),r=a(163),u=a(3157),i=a(5747);function d({showDialogHandle:e,toggleRoleLockStatusHandle:t,deleteHandle:a}){return{searchFormProps:{fields:[{name:"name",type:"input",label:"角色编码/名称"},{name:"module",type:"select",label:"模块",data:[]},{name:"status",type:"select",label:"状态",data:[{label:"正常",value:"0"},{label:"锁定",value:"1"}]}],isShowCollapse:!1},actionBarProps:{buttons:[{text:"新增",handleCode:i.Cj.CREATE,click:e,props:{type:"primary"}},{text:"批量新增",handleCode:i.Cj.BATCHCREATE,click:e}]},dataTableProps:{query:u.A.queryPageRoleList,columns:[{label:"角色编码",prop:"code",minWidth:120},{label:"角色名称",prop:"name",minWidth:120},{label:"所属模块",prop:"moduleCode",minWidth:150,type:"enum",data:[]},{label:"状态",prop:"status",minWidth:100,slot:"dataTable_status"},{type:"action",width:180,buttons:[{text:"编辑",handleCode:i.Cj.UPDATE,click:e},{text:"绑定菜单",handleCode:i.Cj.AUTH,click:e},{text:"锁定",handleCode:i.Cj.DISABLE,display:e=>"0"===e.status,click:t},{text:"解锁",handleCode:i.Cj.ENABLE,display:e=>"1"===e.status,click:t},{text:"删除",handleCode:i.Cj.DELETE,click:a}]}]}}}var c=(0,s.pM)({__name:"info-form-dialog",props:{isShow:{type:Boolean,default:!1},row:{type:Object},moduleList:{type:Array,default:function(){return[]}}},emits:["update:isShow","refresh"],setup(e,{emit:t}){const a=e,l=t,n=(0,o.KR)(),i=(0,o.Kh)({value:a.row&&JSON.parse(JSON.stringify(a.row)),fields:[{name:"moduleCode",label:"所属模块",type:"select",data:a.moduleList.map((e=>({label:e.name,value:e.code}))),rules:[{required:!0,message:"请填写"}]},{name:"code",label:"编码",type:"input",props:{disabled:!!a.row,maxlength:20},rules:[{required:!0,message:"请填写"}]},{name:"name",label:"名称",type:"input",formItemProps:{rules:[{required:!0,message:"请填写"}]}},{name:"status",label:"状态",type:"radio",value:"0",data:[{value:"0",label:"正常"},{value:"1",label:"锁定"}]}]}),d=(0,o.KR)([{text:"取消"},{text:"保存",props:{type:"primary"},click:async function(e){await(n.value?.validate()),await u.A.addOrUpdateRole(e),r.nk.success("操作成功"),l("refresh")}}]);return(t,a)=>{const o=(0,s.g2)("dialog-form");return(0,s.uX)(),(0,s.Wv)(o,{ref_key:"dialogFormRef",ref:n,isShow:e.isShow,buttons:d.value,inputFormProps:i,dialogProps:{title:e.row?"编辑角色信息":"新增角色信息",width:"600px"},onClose:a[0]||(a[0]=e=>l("update:isShow",!1))},null,8,["isShow","buttons","inputFormProps","dialogProps"])}}});const p=c;var m=p,g=a(8548),v=a(1132),y=a(4590),f=a(7419),b=a(5639)["A"];const h={class:"search-panel"},k={class:"data-list-panel"},L={class:"left-contents"},w={class:"right-contents"},C={class:"header-row"},R={class:"label-text"},A={class:"inner-row"},E=["title"],_={class:"dialog-footer"};var x=(0,s.pM)({__name:"bind-menus-dialog",props:{isShow:{type:Boolean},row:{type:Object,required:!0},moduleList:{type:Array,default:function(){return[]}}},emits:["update:isShow"],setup(e,{emit:t}){const a=e,n=t,i=(0,o.KR)(!1),d=(0,o.KR)(""),c=(0,o.KR)([]),p=(0,o.KR)(),m=(0,o.KR)([]),x=(0,o.KR)([]),M=(0,o.KR)(!1),j=function(){n("update:isShow",!1)},O=function(e){x.value=e},I=function(){p.value.clearSelection(),x.value=[]},S=function(e){p.value.toggleRowSelection(e,-1===x.value.findIndex((t=>t.id===e.id)))},F=function(e){p.value.toggleRowSelection(x.value[e],!1),x.value.splice(e,1)},U=(0,f.sg)((function(){const e=d.value&&new RegExp(d.value.replace(/([,.+?:()*[\]^$|{}\\-])/g,"\\$1"),"i");m.value=c.value.filter((t=>!(e&&!e.test(t.name)&&!e.test(t.code)&&!e.test(t.url))))}),200),W=async function(){const e=await u.A.queryMenuListByRoleId({roleId:a.row.id});e&&e.length>0&&e.forEach((e=>{const t=c.value.find((t=>t.id===e.menuId));t&&x.value.push(t)}))},q=async function(){const e=await u.A.queryMenuList({moduleCode:a.row.moduleCode});e&&e.length>0&&(c.value=e.filter((t=>-1===e.findIndex((e=>e.parentId===t.id)))))},T=async function(){if(!M.value){M.value=!0;try{await u.A.updateMenusByRoleId({roleId:a.row.id,menus:x.value.map((e=>e.id))}),r.nk.success("操作成功"),i.value=!1}catch(e){b.error(e)}M.value=!1}};(0,s.wB)((()=>d.value),U);const B=async function(){const e=v.Ks.service();try{await q(),await W(),i.value=!0,m.value=c.value,await(0,s.dY)(),x.value.forEach((e=>{p.value?.toggleRowSelection(e,!0)}))}catch(t){j(),b.error(t)}e.close()};return B(),(t,a)=>{const n=(0,s.g2)("el-input"),r=(0,s.g2)("el-option"),u=(0,s.g2)("el-select"),v=(0,s.g2)("el-icon"),f=(0,s.g2)("el-tooltip"),b=(0,s.g2)("el-table-column"),U=(0,s.g2)("el-button"),W=(0,s.g2)("el-dialog");return(0,s.uX)(),(0,s.Wv)(W,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),title:"绑定角色【"+e.row.name+"】的菜单",class:"common-dialog",width:"800px",onClosed:j},{footer:(0,s.k6)((()=>[(0,s.Lk)("div",_,[(0,s.bF)(U,{onClick:a[1]||(a[1]=e=>i.value=!1)},{default:(0,s.k6)((()=>[(0,s.eW)("取消")])),_:1}),(0,s.bF)(U,{loading:M.value,type:"primary",onClick:T},{default:(0,s.k6)((()=>[(0,s.eW)("确定")])),_:1},8,["loading"])])])),default:(0,s.k6)((()=>[(0,s.Lk)("div",h,[(0,s.bF)(n,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),modelModifiers:{trim:!0},placeholder:"搜索菜单名称/编码/地址",style:{width:"250px","margin-right":"12px"},clearable:"","prefix-icon":(0,o.R1)(g.vji)},null,8,["modelValue","prefix-icon"]),(0,s.bF)(u,{"model-value":e.row.moduleCode,disabled:"",placeholder:"搜索角色模块",style:{width:"150px"}},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.moduleList,(e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["model-value"]),(0,s.bF)(f,{content:"只能绑定相同系统模块的菜单"},{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,o.R1)(g.N_H))])),_:1})])),_:1})]),(0,s.Lk)("div",k,[(0,s.Lk)("div",L,[(0,s.bF)((0,o.R1)(y.Up),{ref_key:"dataTableRef",ref:p,data:m.value,height:"250","row-key":"id",stripe:"",border:"","empty-text":c.value&&c.value.length>0?"未搜索到菜单相关数据":"没有数据",style:{width:"100%"},onSelectionChange:O,onRowClick:S},{default:(0,s.k6)((()=>[(0,s.bF)(b,{"reserve-selection":"",type:"selection",label:"选择",width:"40",align:"center"}),(0,s.bF)(b,{label:"菜单名称(编码)","min-width":"120","show-overflow-tooltip":""},{default:(0,s.k6)((e=>[(0,s.eW)((0,l.v_)(e.row.name)+"("+(0,l.v_)(e.row.code)+")",1)])),_:1}),(0,s.bF)(b,{label:"菜单地址",prop:"url","min-width":"150","show-overflow-tooltip":""})])),_:1},8,["data","empty-text"])]),(0,s.Lk)("div",w,[(0,s.Lk)("div",C,[(0,s.Lk)("div",R,"已选菜单("+(0,l.v_)(x.value.length)+")",1),(0,s.Lk)("div",{class:"label-text active",onClick:I},"清空")]),(0,s.Lk)("div",A,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(x.value,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{class:"row-info",key:e.code},[(0,s.Lk)("div",{class:"name-text",title:e.name+"("+e.code+")"},(0,l.v_)(e.name)+"("+(0,l.v_)(e.code)+")",9,E),(0,s.bF)(v,{onClick:e=>F(t)},{default:(0,s.k6)((()=>[(0,s.bF)((0,o.R1)(g.epd))])),_:2},1032,["onClick"])])))),128))])])])])),_:1},8,["modelValue","title"])}}}),M=a(6262);const j=(0,M.A)(x,[["__scopeId","data-v-5a86131f"]]);var O=j,I=a(2229),S=a(5249),F=a(141),U=a(4094);const W=e=>((0,s.Qi)("data-v-bdef3bac"),e=e(),(0,s.jt)(),e),q={key:0,class:"upload-excel-panel"},T=W((()=>(0,s.Lk)("div",{class:"state-text"},"正在导入数据...",-1))),B={key:1,class:"upload-box"},P={class:"tips-list"},K=W((()=>(0,s.Lk)("li",null,"支持5MB以内的xls、xlsx格式文件",-1))),X=W((()=>(0,s.Lk)("li",null,"文件中的数据不能超过10000行，100列",-1))),G=["innerHTML"],H={key:1,class:"preview-data-panel"},V={class:"import-tips-box"},N={class:"tips-text"},D={key:2,class:"import-result-panel"},Q={key:0,class:"error-box"},$={class:"fail-tips"},J=W((()=>(0,s.Lk)("div",{class:"title-text"},"异常提示",-1))),Y=["innerHTML"],Z={key:1,class:"succes-box"},z=W((()=>(0,s.Lk)("div",{class:"title-text"},"批量导入完成",-1))),ee={class:"subtitle-text"},te={class:"dialog-footer"};var ae=(0,s.pM)({__name:"batch-insert-dialog",props:{isShow:{type:Boolean},moduleList:{type:Array,default:function(){return[]}}},emits:["update:isShow"],setup(e,{emit:t}){const n=e,i=t,d=(0,o.KR)(!0),c=(0,o.KR)(),p=(0,o.Kh)({step:1,isLoading:!1,isShowProgress:!1,fileList:[],uploadErrorMessage:"",dataList:[],selectColumns:["code","name","moduleName"],tableColumnList:[{label:"角色编码",prop:"code",minWidth:120},{label:"角色名称",prop:"name",minWidth:120},{label:"模块",prop:"moduleName",minWidth:120}],batchInsertErrorMessage:""});(0,s.wB)((()=>p.fileList[0]?.uid),(()=>{m()}));const m=function(){p.step=1,p.uploadErrorMessage="",p.dataList=[],p.batchInsertErrorMessage="",p.isShowProgress=!1},v=function(){i("update:isShow",!1)},y=function(){F.A.download({type:"a",url:a(748),fileName:"批量新增角色模板.xlsx"})},f=async function(e){try{p.isLoading=!0,p.isShowProgress=!0;const t=await u.A.uploadRolesExcel(e.file,{isShowError:!1});p.dataList=t.map((e=>Object.assign({},e,{moduleName:n.moduleList.find((t=>t.code===e.moduleCode))?.name||""})))}catch(t){p.uploadErrorMessage=t.error.message}p.isLoading=!1},b=function(){p.isShowProgress=!1,p.uploadErrorMessage?r.nk.error(p.uploadErrorMessage):p.step=2},h=function(e){c.value.clearFiles();const t=e[0];t.uid=(0,I.G$)(),c.value.handleStart(t)},k=function(e,t){t?p.selectColumns.push(e):p.selectColumns.splice(p.selectColumns.indexOf(e),1)},L=function(e){p.dataList.splice(e,1)},w=function(){p.dataList.length>0?p.step=2:c.value.submit()},C=async function(){if(!p.isLoading){try{p.batchInsertErrorMessage="",p.isLoading=!0,await u.A.batchInsertRoles(p.dataList.map((e=>{const t={};return p.selectColumns.forEach((a=>t[a]=e[a])),t})))}catch(e){p.batchInsertErrorMessage=e.error.message}p.step=3,p.isLoading=!1}},R=function(){p.fileList=[]};return(e,t)=>{const a=(0,s.g2)("el-step"),n=(0,s.g2)("el-steps"),r=(0,s.g2)("el-link"),u=(0,s.g2)("el-button"),i=(0,s.g2)("el-alert"),m=(0,s.g2)("el-icon"),A=(0,s.g2)("el-checkbox"),E=(0,s.g2)("el-table-column"),_=(0,s.g2)("el-table"),x=(0,s.g2)("el-dialog");return(0,s.uX)(),(0,s.Wv)(x,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=e=>d.value=e),title:"批量导入角色",class:"common-dialog",width:"800px",onClosed:v},{footer:(0,s.k6)((()=>[(0,s.Lk)("div",te,[(0,s.bF)(u,{onClick:t[1]||(t[1]=e=>d.value=!1)},{default:(0,s.k6)((()=>[(0,s.eW)("取消")])),_:1}),2===p.step||3===p.step&&p.batchInsertErrorMessage?((0,s.uX)(),(0,s.Wv)(u,{key:0,onClick:t[2]||(t[2]=e=>p.step=p.step-1)},{default:(0,s.k6)((()=>[(0,s.eW)("上一步")])),_:1})):(0,s.Q3)("",!0),1===p.step?((0,s.uX)(),(0,s.Wv)(u,{key:1,type:"primary",loading:p.isShowProgress,disabled:0===p.fileList.length||!!p.uploadErrorMessage,onClick:w},{default:(0,s.k6)((()=>[(0,s.eW)(" 提交 ")])),_:1},8,["loading","disabled"])):2===p.step?((0,s.uX)(),(0,s.Wv)(u,{key:2,type:"primary",loading:p.isLoading,disabled:0===p.dataList.length||0===p.selectColumns.length,onClick:C},{default:(0,s.k6)((()=>[(0,s.eW)(" 确定 ")])),_:1},8,["loading","disabled"])):3===p.step?((0,s.uX)(),(0,s.Wv)(u,{key:3,type:"primary",onClick:R},{default:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(p.batchInsertErrorMessage?"重新":"再次")+"上传",1)])),_:1})):(0,s.Q3)("",!0)])])),default:(0,s.k6)((()=>[(0,s.bF)(n,{active:p.step,simple:""},{default:(0,s.k6)((()=>[(0,s.bF)(a,{title:"上传文件",icon:(0,o.R1)(g._OO)},null,8,["icon"]),(0,s.bF)(a,{title:"预览数据",icon:(0,o.R1)(g.dqr)},null,8,["icon"]),(0,s.bF)(a,{title:"导入数据",icon:(0,o.R1)(g.d57)},null,8,["icon"])])),_:1},8,["active"]),1===p.step?((0,s.uX)(),(0,s.CE)("div",q,[p.isShowProgress?((0,s.uX)(),(0,s.Wv)(U.A,{key:0,finished:!p.isLoading,onAfterFinished:b},{default:(0,s.k6)((()=>[T])),_:1},8,["finished"])):((0,s.uX)(),(0,s.CE)("div",B,[(0,s.Lk)("ul",P,[K,X,(0,s.Lk)("li",null,[(0,s.eW)(" 请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除。 "),(0,s.bF)(r,{type:"primary",onClick:y},{default:(0,s.k6)((()=>[(0,s.eW)("模板下载")])),_:1})])]),(0,s.bF)((0,o.R1)(S.j5),{class:"upload-excel",ref_key:"uploadExcelRef",ref:c,"file-list":p.fileList,"onUpdate:fileList":t[0]||(t[0]=e=>p.fileList=e),action:"#",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel","auto-upload":!1,limit:1,"http-request":f,"on-exceed":h},{trigger:(0,s.k6)((()=>[(0,s.bF)(u,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)("选择文件")])),_:1})])),_:1},8,["file-list"]),p.uploadErrorMessage?((0,s.uX)(),(0,s.Wv)(i,{key:0,title:"异常提示",type:"error","show-icon":""},{default:(0,s.k6)((()=>[(0,s.Lk)("div",{class:"content",innerHTML:p.uploadErrorMessage},null,8,G)])),_:1})):(0,s.Q3)("",!0)]))])):2===p.step?((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",V,[(0,s.bF)(m,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,o.R1)(g.N5l))])),_:1}),(0,s.Lk)("div",N,[(0,s.eW)(" 共 "),(0,s.Lk)("span",null,(0,l.v_)(p.dataList.length),1),(0,s.eW)(" 条数据，导入 "),(0,s.Lk)("span",null,(0,l.v_)(p.selectColumns.length),1),(0,s.eW)(" 列 / 共 "),(0,s.Lk)("span",null,(0,l.v_)(p.tableColumnList.length),1),(0,s.eW)(" 列 ")])]),(0,s.bF)(_,{data:p.dataList,border:"",stripe:"",style:{width:"100%"},"max-height":"300"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.tableColumnList,((e,t)=>((0,s.uX)(),(0,s.Wv)(E,(0,s.v6)(e,{key:t}),{header:(0,s.k6)((()=>[(0,s.eW)((0,l.v_)(e.label)+" ",1),(0,s.bF)(A,{checked:p.selectColumns.includes(e.prop),onChange:t=>k(e.prop,t)},null,8,["checked","onChange"])])),_:2},1040)))),128)),(0,s.bF)(E,{label:"操作",fixed:"right",width:"60",align:"center"},{default:(0,s.k6)((({$index:e})=>[(0,s.bF)(u,{link:"",type:"primary",onClick:t=>L(e)},{default:(0,s.k6)((()=>[(0,s.eW)("移除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])):3===p.step?((0,s.uX)(),(0,s.CE)("div",D,[p.batchInsertErrorMessage?((0,s.uX)(),(0,s.CE)("div",Q,[(0,s.bF)(m,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,o.R1)(g.BZj))])),_:1}),(0,s.Lk)("div",$,[J,(0,s.Lk)("div",{class:"subtitle-text",innerHTML:p.batchInsertErrorMessage},null,8,Y)])])):((0,s.uX)(),(0,s.CE)("div",Z,[(0,s.bF)(m,null,{default:(0,s.k6)((()=>[(0,s.bF)((0,o.R1)(g.m6F))])),_:1}),z,(0,s.Lk)("div",ee,[(0,s.eW)(" 您已成功导入 "),(0,s.Lk)("span",null,(0,l.v_)(p.dataList.length),1),(0,s.eW)(" 条， "),(0,s.Lk)("span",null,(0,l.v_)(p.selectColumns.length),1),(0,s.eW)(" 列数据 ")])]))])):(0,s.Q3)("",!0)])),_:1},8,["modelValue"])}}});const se=(0,M.A)(ae,[["__scopeId","data-v-bdef3bac"]]);var le=se,oe=(0,s.pM)({__name:"index",setup(e){const t=(0,o.KR)(),a=(0,o.KR)(!1),c=(0,o.KR)(!1),p=(0,o.KR)(!1),g=(0,o.KR)(),v=(0,o.KR)([]),y=(0,o.KR)([]),f=function(e){return e?"0"===e?"正常":"1"===e?"锁定":"未知":"-"},b=async function(){await t.value.query()},h=function(e,{handleCode:t}){t===i.Cj.CREATE?g.value=null:g.value=e,[i.Cj.CREATE,i.Cj.UPDATE].includes(t)?a.value=!0:t===i.Cj.AUTH?c.value=!0:t===i.Cj.BATCHCREATE&&(p.value=!0)},k=async function(e,{handleCode:t}){await n.s.confirm("确定"+(t===i.Cj.DISABLE?"锁定":"解锁")+"当前角色信息吗?","信息确认",{customClass:"custom-confirm",confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await u.A.toggleRoleLockStatus({id:e.id,status:t===i.Cj.DISABLE?"1":"0"}),(0,r.nk)({customClass:"custom-message",message:"操作成功",type:"success"}),b()},L=async function(e){await n.s.confirm("确定删除当前角色信息吗?","信息确认",{customClass:"custom-confirm",confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await u.A.deleteRole({id:e.id}),(0,r.nk)({customClass:"custom-message",message:"操作成功",type:"success"}),b()},w=(0,o.Kh)(d({showDialogHandle:h,toggleRoleLockStatusHandle:k,deleteHandle:L})),C=async function(){y.value=await u.A.queryModuleList({})||[],v.value=await u.A.queryMenuList({})||[],y.value.length>0&&(t.value?.changeFormFields((e=>{e.find((e=>"module"===e.name&&(e.data=y.value.map((e=>({label:e.name,value:e.code}))),!0)))})),w.dataTableProps.columns.find((e=>"moduleCode"===e.prop&&(e.data=y.value.map((e=>({label:e.name,value:e.code}))),!0))))};return C(),(e,o)=>{const n=(0,s.g2)("search-page");return(0,s.uX)(),(0,s.Wv)(n,(0,s.v6)(w,{ref_key:"searchPageRef",ref:t}),{dataTable_status:(0,s.k6)((e=>[(0,s.Lk)("div",{class:(0,l.C4)(["state-text",{disable:"1"===e.row.status,enable:"0"===e.row.status}])},(0,l.v_)(f(e.row.status)),3)])),default:(0,s.k6)((()=>[a.value?((0,s.uX)(),(0,s.Wv)(m,{key:0,isShow:a.value,"onUpdate:isShow":o[0]||(o[0]=e=>a.value=e),moduleList:y.value,onRefresh:b,row:g.value},null,8,["isShow","moduleList","row"])):(0,s.Q3)("",!0),c.value?((0,s.uX)(),(0,s.Wv)(O,{key:1,isShow:c.value,"onUpdate:isShow":o[1]||(o[1]=e=>c.value=e),row:g.value,moduleList:y.value},null,8,["isShow","row","moduleList"])):(0,s.Q3)("",!0),p.value?((0,s.uX)(),(0,s.Wv)(le,{key:2,isShow:p.value,"onUpdate:isShow":o[2]||(o[2]=e=>p.value=e),moduleList:y.value},null,8,["isShow","moduleList"])):(0,s.Q3)("",!0)])),_:1},16)}}});const ne=(0,M.A)(oe,[["__scopeId","data-v-0fc8d0df"]]);var re=ne},748:function(e,t,a){e.exports=a.p+"build/file/批量新增角色模板.c434bf1e.xlsx"}}]);
//# sourceMappingURL=560.3ca2c40e.js.map