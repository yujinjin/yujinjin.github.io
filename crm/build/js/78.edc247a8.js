"use strict";(self["webpackChunkvue_manager_system"]=self["webpackChunkvue_manager_system"]||[]).push([[78],{3157:function(e,t,s){var a=s(4803),r=s(141);t.A={login(e,t){return(0,a.A)(Object.assign({url:"/system/login",data:e},t||{}))},sendValidateCode(e,t){return(0,a.A)(Object.assign({url:"/system/sendValidateCode",data:e,method:"POST"},t||{}))},queryUnreadMessages(e){return(0,a.A)(Object.assign({url:"/system/queryUnreadMessages",method:"GET"},e||{}))},queryLoginUserMenus(e){return(0,a.A)(Object.assign({url:"/system/queryLoginUserMenus",method:"GET"},e||{}))},updateLoginPassword(e,t){return(0,a.A)(Object.assign({url:"/system/updateLoginPassword",data:e},t||{}))},updateLoginUserInfo(e,t){return(0,a.A)(Object.assign({url:"/system/updateLoginUserInfo",data:e},t||{}))},queryPageModuleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageModuleList",params:e,method:"GET"},t||{}))},queryModuleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryModuleList",params:e,method:"GET"},t||{}))},addOrUpdateModule(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateModule",data:e},t||{}))},deleteModuleById(e,t){return(0,a.A)(Object.assign({url:"/system/deleteModuleById",data:{id:e}},t||{}))},queryPageMenuList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageMenuList",params:e,method:"GET"},t||{}))},queryMenuList(e,t){return(0,a.A)(Object.assign({url:"/system/queryMenuList",params:e,method:"GET"},t||{}))},addOrUpdateMenu(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateMenu",data:e},t||{}))},toggleMenuLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateMenuLockStatus",data:e},t||{}))},queryRoleListByMenuId(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleListByMenuId",params:e,method:"GET"},t||{}))},deleteMenu(e,t){return(0,a.A)(Object.assign({url:"/system/deleteMenu",data:e},t||{}))},uploadMenusExcel(e,t){return r.A.upload({file:e},"/system/uploadMenusExcel",t)},batchInsertMenus(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertMenus",data:e},t||{}))},queryPageRoleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageRoleList",params:e,method:"GET"},t||{}))},queryRoleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleList",params:e,method:"GET"},t||{}))},queryMenuListByRoleId(e,t){return(0,a.A)(Object.assign({url:"/system/queryMenuListByRoleId",params:e,method:"GET"},t||{}))},addOrUpdateRole(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateRole",data:e},t||{}))},toggleRoleLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateRoleLockStatus",data:e},t||{}))},updateMenusByRoleId(e,t){return(0,a.A)(Object.assign({url:"/system/updateMenusByRoleId",data:e},t||{}))},deleteRole(e,t){return(0,a.A)(Object.assign({url:"/system/deleteRole",data:e},t||{}))},uploadRolesExcel(e,t){return r.A.upload({file:e},"/system/uploadRolesExcel",t)},batchInsertRoles(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertRoles",data:e},t||{}))},queryPageUserList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageUserList",method:"GET",params:e},t||{}))},queryRoleListByUserId(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleListByUserId",params:e,method:"GET"},t||{}))},addOrUpdateUser(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateUser",data:e},t||{}))},updateRoleListByUserId(e,t){return(0,a.A)(Object.assign({url:"/system/updateRoleListByUserId",data:e},t||{}))},deleteUser(e,t){return(0,a.A)(Object.assign({url:"/system/deleteUser",data:e},t||{}))},toggleUserLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateUserLockStatus",data:e},t||{}))},resetUerPassword(e,t){return(0,a.A)(Object.assign({url:"/system/resetUerPassword",data:e},t||{}))},uploadUsersExcel(e,t){return r.A.upload({file:e},"/system/uploadUsersExcel",t)},batchInsertUers(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertUers",data:e},t||{}))},queryPageMessageList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageMessageList",params:e,method:"GET"},t||{}))},insertMessage(e,t){return(0,a.A)(Object.assign({url:"/system/sendMessage",data:e},t||{}))}}},9078:function(e,t,s){s.r(t),s.d(t,{default:function(){return f}});var a=s(641),r=s(953),l=s(3157),u=s(33),n=(0,a.pM)({__name:"tooltip-dynamics-text",props:{content:String,lineNumber:{type:Number,default:1}},setup(e){const t=(0,r.KR)(!0),s=function(e){t.value=e.currentTarget.scrollHeight<=e.currentTarget.clientHeight};return(r,l)=>{const n=(0,a.g2)("el-tooltip");return e.content&&e.content.length>1?((0,a.uX)(),(0,a.Wv)(n,{key:0,"popper-class":"ellipsis-tooltip-popover",effect:"light",content:e.content,disabled:t.value},{default:(0,a.k6)((()=>[(0,a.Lk)("div",{class:"text",style:(0,u.Tr)({"-webkit-line-clamp":e.lineNumber}),onMouseenter:s},(0,u.v_)(e.content),37)])),_:1},8,["content","disabled"])):((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.eW)((0,u.v_)(e.content),1)],64))}}}),o=s(6262);const d=(0,o.A)(n,[["__scopeId","data-v-95ae9366"]]);var i=d,p=s(5747);function m({showDialogHandle:e}){return{searchFormProps:{isShowCollapse:!1,fields:[{name:"keyword",type:"input",label:"站内信标题/内容"},{name:"module",type:"select",label:"模块",data:[]}]},actionBarProps:{buttons:[{text:"新增",handleCode:p.Cj.CREATE,click:e,props:{type:"primary"}}]},dataTableProps:{query:l.A.queryPageMessageList,columns:[{label:"标题",prop:"title",minWidth:100,slot:"dataTable_title"},{label:"内容",prop:"content",minWidth:150,showOverflowTooltip:!0},{label:"所属模块",prop:"moduleCode",minWidth:100,type:"enum",data:[]},{label:"所选角色",prop:"roles",minWidth:150,type:"enum",data:[]},{label:"状态",prop:"status",width:100,slot:"dataTable_status"},{label:"预计发送数量",prop:"estimateSendNumber",type:"number",width:100},{label:"实际发送数量",prop:"realSendNumber",width:100},{label:"更新人",prop:"created",minWidth:100},{label:"创建时间",prop:"createTime",type:"date",formate:"YYYY-MM-DD HH:mm:ss",minWidth:150}]}}}var c=s(163),y=(0,a.pM)({__name:"add-form-dialog",props:{isShow:{type:Boolean,default:!1},moduleList:{type:Array,default:function(){return[]}},roleList:{type:Array,default:function(){return[]}},actionType:{type:String},row:{type:Object}},emits:["update:isShow","refresh"],setup(e,{emit:t}){const s=e,u=t,n=(0,r.KR)(),o=(0,r.Kh)({value:Object.assign({},s.row,{roles:s.row?.roles?s.row?.roles.split(","):[]}),props:{disabled:s.actionType===p.Cj.VIEW},fields:[{name:"moduleCode",label:"所属模块",type:"select",data:s.moduleList.map((e=>({label:e.name+"("+e.code+")",value:e.code})))},{name:"roles",label:"角色",type:"select",props:{multiple:!0},data:s.roleList.map((e=>({label:e.name+"("+e.code+")",value:e.code})))},{name:"title",label:"标题",type:"input",props:{maxlength:20},rules:[{required:!0,message:"请填写"}]},{name:"content",label:"内容",type:"input",props:{rows:4,type:"textarea"},rules:[{required:!0,message:"请填写"}]}]}),d=(0,r.KR)([{text:"取消"},{text:"保存",props:{type:"primary"},click:async function(e){await(n.value?.validate()),e.roles&&(e.roles=e.roles.join(",")),await l.A.insertMessage(e),c.nk.success("操作成功"),u("refresh")}}]),i=async function(e,t,a,r){"moduleCode"===e.name&&(r.roles=[],a.find((e=>"roles"===e.name)).data=t?s.roleList.filter((e=>e.moduleCode===t)).map((e=>({label:e.name+"("+e.code+")",value:e.code}))):[])};return(t,s)=>{const r=(0,a.g2)("dialog-form");return(0,a.uX)(),(0,a.Wv)(r,{ref_key:"dialogFormRef",ref:n,isShow:e.isShow,buttons:d.value,inputFormProps:o,dialogProps:{title:"发送站内信",width:"600px"},onFieldValueChange:i,onClose:s[0]||(s[0]=e=>u("update:isShow",!1))},null,8,["isShow","buttons","inputFormProps"])}}});const g=y;var b=g,h=(0,a.pM)({__name:"index",setup(e){const t=(0,r.KR)(),s=(0,r.KR)(!1),u=(0,r.KR)([]),n=(0,r.KR)([]),o=(0,r.KR)(),d=(0,r.KR)(),c=async function(){await t.value.query()},y=function(e,{handleCode:t}){d.value=t,t===p.Cj.CREATE?o.value=null:o.value=e,s.value=!0},g=(0,r.Kh)(m({showDialogHandle:y})),h=async function(){u.value=await l.A.queryModuleList({})||[],n.value=await l.A.queryRoleList({})||[],u.value.length>0&&(t.value?.changeFormFields((e=>{e.find((e=>"module"===e.name&&(e.data=u.value.map((e=>({label:e.name,value:e.code}))),!0)))})),g.dataTableProps.columns.find((e=>"moduleCode"===e.prop&&(e.data=u.value.map((e=>({label:e.name,value:e.code}))),!0)))),n.value.length>0&&g.dataTableProps.columns.find((e=>"roles"===e.prop&&(e.data=n.value.map((e=>({label:e.name,value:e.code}))),!0)))};return h(),(e,l)=>{const m=(0,a.g2)("el-tag"),h=(0,a.g2)("el-link"),v=(0,a.g2)("search-page");return(0,a.uX)(),(0,a.Wv)(v,(0,a.v6)(g,{ref_key:"searchPageRef",ref:t}),{dataTable_status:(0,a.k6)((e=>["0"===e.row.status?((0,a.uX)(),(0,a.Wv)(m,{key:0,type:"info"},{default:(0,a.k6)((()=>[(0,a.eW)("发送中")])),_:1})):"1"===e.row.status?((0,a.uX)(),(0,a.Wv)(m,{key:1,type:"success"},{default:(0,a.k6)((()=>[(0,a.eW)("发送完成")])),_:1})):"2"===e.row.status?((0,a.uX)(),(0,a.Wv)(m,{key:2,type:"danger"},{default:(0,a.k6)((()=>[(0,a.eW)("发送失败")])),_:1})):(0,a.Q3)("",!0)])),dataTable_title:(0,a.k6)((e=>[(0,a.bF)(h,{type:"primary",onClick:t=>y(e.row,{handleCode:(0,r.R1)(p.Cj).VIEW})},{default:(0,a.k6)((()=>[(0,a.bF)(i,{content:e.row.title},null,8,["content"])])),_:2},1032,["onClick"])])),default:(0,a.k6)((()=>[s.value?((0,a.uX)(),(0,a.Wv)(b,{key:0,isShow:s.value,"onUpdate:isShow":l[0]||(l[0]=e=>s.value=e),actionType:d.value,row:o.value,moduleList:u.value,roleList:n.value,onRefresh:c},null,8,["isShow","actionType","row","moduleList","roleList"])):(0,a.Q3)("",!0)])),_:1},16)}}});const v=h;var f=v}}]);
//# sourceMappingURL=78.edc247a8.js.map