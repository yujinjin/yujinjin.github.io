"use strict";(self["webpackChunkvue_manager_system"]=self["webpackChunkvue_manager_system"]||[]).push([[454],{3157:function(e,t,s){var a=s(4803),r=s(141);t.A={login(e,t){return(0,a.A)(Object.assign({url:"/system/login",data:e},t||{}))},sendValidateCode(e,t){return(0,a.A)(Object.assign({url:"/system/sendValidateCode",data:e,method:"POST"},t||{}))},queryUnreadMessages(e){return(0,a.A)(Object.assign({url:"/system/queryUnreadMessages",method:"GET"},e||{}))},queryLoginUserMenus(e){return(0,a.A)(Object.assign({url:"/system/queryLoginUserMenus",method:"GET"},e||{}))},updateLoginPassword(e,t){return(0,a.A)(Object.assign({url:"/system/updateLoginPassword",data:e},t||{}))},updateLoginUserInfo(e,t){return(0,a.A)(Object.assign({url:"/system/updateLoginUserInfo",data:e},t||{}))},queryPageModuleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageModuleList",params:e,method:"GET"},t||{}))},queryModuleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryModuleList",params:e,method:"GET"},t||{}))},addOrUpdateModule(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateModule",data:e},t||{}))},deleteModuleById(e,t){return(0,a.A)(Object.assign({url:"/system/deleteModuleById",data:{id:e}},t||{}))},queryPageMenuList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageMenuList",params:e,method:"GET"},t||{}))},queryMenuList(e,t){return(0,a.A)(Object.assign({url:"/system/queryMenuList",params:e,method:"GET"},t||{}))},addOrUpdateMenu(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateMenu",data:e},t||{}))},toggleMenuLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateMenuLockStatus",data:e},t||{}))},queryRoleListByMenuId(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleListByMenuId",params:e,method:"GET"},t||{}))},deleteMenu(e,t){return(0,a.A)(Object.assign({url:"/system/deleteMenu",data:e},t||{}))},uploadMenusExcel(e,t){return r.A.upload({file:e},"/system/uploadMenusExcel",t)},batchInsertMenus(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertMenus",data:e},t||{}))},queryPageRoleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageRoleList",params:e,method:"GET"},t||{}))},queryRoleList(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleList",params:e,method:"GET"},t||{}))},queryMenuListByRoleId(e,t){return(0,a.A)(Object.assign({url:"/system/queryMenuListByRoleId",params:e,method:"GET"},t||{}))},addOrUpdateRole(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateRole",data:e},t||{}))},toggleRoleLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateRoleLockStatus",data:e},t||{}))},updateMenusByRoleId(e,t){return(0,a.A)(Object.assign({url:"/system/updateMenusByRoleId",data:e},t||{}))},deleteRole(e,t){return(0,a.A)(Object.assign({url:"/system/deleteRole",data:e},t||{}))},uploadRolesExcel(e,t){return r.A.upload({file:e},"/system/uploadRolesExcel",t)},batchInsertRoles(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertRoles",data:e},t||{}))},queryPageUserList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageUserList",method:"GET",params:e},t||{}))},queryRoleListByUserId(e,t){return(0,a.A)(Object.assign({url:"/system/queryRoleListByUserId",params:e,method:"GET"},t||{}))},addOrUpdateUser(e,t){return(0,a.A)(Object.assign({url:"/system/addOrUpdateUser",data:e},t||{}))},updateRoleListByUserId(e,t){return(0,a.A)(Object.assign({url:"/system/updateRoleListByUserId",data:e},t||{}))},deleteUser(e,t){return(0,a.A)(Object.assign({url:"/system/deleteUser",data:e},t||{}))},toggleUserLockStatus(e,t){return(0,a.A)(Object.assign({url:"/system/updateUserLockStatus",data:e},t||{}))},resetUerPassword(e,t){return(0,a.A)(Object.assign({url:"/system/resetUerPassword",data:e},t||{}))},uploadUsersExcel(e,t){return r.A.upload({file:e},"/system/uploadUsersExcel",t)},batchInsertUers(e,t){return(0,a.A)(Object.assign({url:"/system/batchInsertUers",data:e},t||{}))},queryPageMessageList(e,t){return(0,a.A)(Object.assign({url:"/system/queryPageMessageList",params:e,method:"GET"},t||{}))},insertMessage(e,t){return(0,a.A)(Object.assign({url:"/system/sendMessage",data:e},t||{}))}}},9454:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var a=s(641),r=s(953),u=s(3157),l=s(5747);function n({showDialogHandle:e}){return{searchFormProps:{isShowCollapse:!1,fields:[{name:"keyword",type:"input",label:"站内信标题/内容"},{name:"module",type:"select",label:"模块",data:[]}]},actionBarProps:{buttons:[{text:"新增",handleCode:l.Cj.CREATE,click:e,props:{type:"primary"}}]},dataTableProps:{query:u.A.queryPageMessageList,columns:[{label:"标题",prop:"title",minWidth:150},{label:"内容",prop:"content",minWidth:150,showOverflowTooltip:!0},{label:"所属模块",prop:"moduleCode",minWidth:100,type:"enum",data:[]},{label:"所选角色",prop:"roles",minWidth:150,type:"enum",data:[]},{label:"状态",prop:"status",width:100,slot:"dataTable_status"},{label:"预计发送数量",prop:"estimateSendNumber",type:"number",width:100},{label:"实际发送数量",prop:"realSendNumber",width:100},{label:"更新人",prop:"created",minWidth:100},{label:"创建时间",prop:"createTime",type:"date",formate:"YYYY-MM-DD HH:mm:ss",minWidth:150}]}}}var o=s(163),d=(0,a.pM)({__name:"add-form-dialog",props:{isShow:{type:Boolean,default:!1},moduleList:{type:Array,default:function(){return[]}},roleList:{type:Array,default:function(){return[]}}},emits:["update:isShow","refresh"],setup(e,{emit:t}){const s=e,l=t,n=(0,r.KR)(),d=(0,r.Kh)({fields:[{name:"moduleCode",label:"所属模块",type:"select",data:s.moduleList.map((e=>({label:e.name+"("+e.code+")",value:e.code})))},{name:"roles",label:"角色",type:"select",props:{multiple:!0},data:[]},{name:"title",label:"名称",type:"input",props:{maxlength:20},rules:[{required:!0,message:"请填写"}]},{name:"content",label:"内容",type:"input",props:{rows:4,type:"textarea"},rules:[{required:!0,message:"请填写"}]}]}),i=(0,r.KR)([{text:"取消"},{text:"保存",props:{type:"primary"},click:async function(e){await(n.value?.validate()),e.roles&&(e.roles=e.roles.join(",")),await u.A.insertMessage(e),o.nk.success("操作成功"),l("refresh")}}]),m=async function(e,t,a,r){"moduleCode"===e.name&&(r.roles=[],a.find((e=>"roles"===e.name)).data=t?s.roleList.filter((e=>e.moduleCode===t)).map((e=>({label:e.name+"("+e.code+")",value:e.code}))):[])};return(t,s)=>{const r=(0,a.g2)("dialog-form");return(0,a.uX)(),(0,a.Wv)(r,{ref_key:"dialogFormRef",ref:n,class:"menu-info-form",isShow:e.isShow,buttons:i.value,inputFormProps:d,dialogProps:{title:"发送站内信",width:"600px"},onFieldValueChange:m,onClose:s[0]||(s[0]=e=>l("update:isShow",!1))},null,8,["isShow","buttons","inputFormProps"])}}});const i=d;var m=i,p=(0,a.pM)({__name:"index",setup(e){const t=(0,r.KR)(),s=(0,r.KR)(!1),l=(0,r.KR)([]),o=(0,r.KR)([]),d=async function(){await t.value.query()},i=function(){s.value=!0},p=(0,r.Kh)(n({showDialogHandle:i})),y=async function(){l.value=await u.A.queryModuleList({})||[],o.value=await u.A.queryRoleList({})||[],l.value.length>0&&(t.value?.changeFormFields((e=>{e.find((e=>"module"===e.name&&(e.data=l.value.map((e=>({label:e.name,value:e.code}))),!0)))})),p.dataTableProps.columns.find((e=>"moduleCode"===e.prop&&(e.data=l.value.map((e=>({label:e.name,value:e.code}))),!0)))),o.value.length>0&&p.dataTableProps.columns.find((e=>"roles"===e.prop&&(e.data=o.value.map((e=>({label:e.name,value:e.code}))),!0)))};return y(),(e,r)=>{const u=(0,a.g2)("el-tag"),n=(0,a.g2)("search-page");return(0,a.uX)(),(0,a.Wv)(n,(0,a.v6)(p,{ref_key:"searchPageRef",ref:t}),{dataTable_status:(0,a.k6)((e=>["0"===e.row.status?((0,a.uX)(),(0,a.Wv)(u,{key:0,type:"info"},{default:(0,a.k6)((()=>[(0,a.eW)("发送中")])),_:1})):"1"===e.row.status?((0,a.uX)(),(0,a.Wv)(u,{key:1,type:"success"},{default:(0,a.k6)((()=>[(0,a.eW)("发送完成")])),_:1})):"2"===e.row.status?((0,a.uX)(),(0,a.Wv)(u,{key:2,type:"danger"},{default:(0,a.k6)((()=>[(0,a.eW)("发送失败")])),_:1})):(0,a.Q3)("",!0)])),default:(0,a.k6)((()=>[s.value?((0,a.uX)(),(0,a.Wv)(m,{key:0,isShow:s.value,"onUpdate:isShow":r[0]||(r[0]=e=>s.value=e),moduleList:l.value,roleList:o.value,onRefresh:d},null,8,["isShow","moduleList","roleList"])):(0,a.Q3)("",!0)])),_:1},16)}}});const y=p;var c=y}}]);
//# sourceMappingURL=454.b77646b8.js.map